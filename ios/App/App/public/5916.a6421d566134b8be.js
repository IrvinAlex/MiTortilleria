"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5916],{5916:(y,S,m)=>{m.r(S),m.d(S,{GestionPageModule:()=>ce});var d=m(177),s=m(9417),l=m(5933),G=m(8265),p=m(467),e=m(4438),v=m(7517),g=m(2723),P=m(8461),h=m(8827);function k(n,c){if(1&n&&(e.j41(0,"ion-avatar"),e.nrm(1,"img",12),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("src",r.form.value.imagen,e.B4B)}}function f(n,c){1&n&&e.nrm(0,"ion-icon",13)}function w(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function T(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," El nombre debe tener al menos 4 caracteres "),e.k0s())}function M(n,c){if(1&n&&(e.j41(0,"div",14),e.DNE(1,w,2,0,"div",2)(2,T,2,0,"div",2),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.nombre.errors?null:r.form.controls.nombre.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.nombre.errors?null:r.form.controls.nombre.errors.min)}}function E(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function j(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," La descripci\xf3n debe tener al menos 4 caracteres "),e.k0s())}function D(n,c){if(1&n&&(e.j41(0,"div",14),e.DNE(1,E,2,0,"div",2)(2,j,2,0,"div",2),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.descripcion.errors?null:r.form.controls.descripcion.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.descripcion.errors?null:r.form.controls.descripcion.errors.min)}}function $(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function R(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," La cantidad m\xednima debe ser 0"),e.k0s())}function A(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Solo se permiten n\xfameros enteros (0-9)"),e.k0s())}function x(n,c){if(1&n&&(e.j41(0,"div",14),e.DNE(1,$,2,0,"div",2)(2,R,2,0,"div",2)(3,A,2,0,"div",2),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.stock.errors?null:r.form.controls.stock.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.stock.errors?null:r.form.controls.stock.errors.min),e.R7$(),e.Y8G("ngIf",null==r.form.controls.stock.errors?null:r.form.controls.stock.errors.pattern)}}let I=(()=>{var n;class c{constructor(){this.producto=null,this.form=new s.gE({uid:new s.MJ(""),imagen:new s.MJ("",[s.k0.required]),nombre:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),descripcion:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),stock:new s.MJ(null,[s.k0.required,s.k0.min(0),s.k0.pattern(/^\d+$/)]),disponible:new s.MJ(!1,[s.k0.required])}),this.firebaseSvc=(0,e.WQX)(v.f),this.utilSvc=(0,e.WQX)(g.T)}ngOnInit(){this.producto&&this.form.patchValue({...this.producto}),this.setNumberInputs()}setNumberInputs(){const o=this.form.controls.stock;o.valueChanges.subscribe(t=>{if(null==t)return;const a=String(t).replace(/[^\d]/g,"");if(""===a)return void o.setValue(null,{emitEvent:!1});const u=Math.max(0,parseInt(a,10));u!==t&&o.setValue(u,{emitEvent:!1})})}takePicture(){var o=this;return(0,p.A)(function*(){const t=(yield o.utilSvc.takePicture("Imagen del producto")).dataUrl;o.form.controls.imagen.setValue(t)})()}submit(){var o=this;return(0,p.A)(function*(){o.form.valid&&(o.producto?yield o.updateProduct():yield o.createProduct())})()}createProduct(){var o=this;return(0,p.A)(function*(){const t=yield o.utilSvc.loading();yield t.present();try{const i="productos";let a="";if(o.form.value.imagen){const C=`productos/${Date.now()}`;a=yield o.firebaseSvc.uploadImage(C,o.form.value.imagen),o.form.controls.imagen.setValue(a)}const u=o.form.value.stock,_="number"==typeof u?u:parseInt(String(null!=u?u:""),10);o.form.controls.stock.setValue(Number.isFinite(_)?Math.max(0,_):0);const b={...o.form.value,imagen:a};yield o.firebaseSvc.addDocumentWithUid(i,b),o.utilSvc.presentToast({message:"Producto creado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),o.utilSvc.dismissModal({success:!0})}catch(i){o.utilSvc.presentToast({message:i.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}finally{t.dismiss()}})()}updateProduct(){var o=this;return(0,p.A)(function*(){let t=`productos/${o.producto.uid}`;const i=yield o.utilSvc.loading();if(yield i.present(),o.form.value.imagen!==o.producto.imagen){let _=o.form.value.imagen,b=yield o.firebaseSvc.getFilePath(o.producto.imagen),C=yield o.firebaseSvc.uploadImage(b,_);o.form.controls.imagen.setValue(C)}const a=o.form.value.stock,u="number"==typeof a?a:parseInt(String(null!=a?a:""),10);o.form.controls.stock.setValue(Number.isFinite(u)?Math.max(0,u):0),delete o.form.value.uid,o.firebaseSvc.updateDocumet(t,o.form.value).then(function(){var _=(0,p.A)(function*(b){o.utilSvc.dismissModal({success:!0}),o.utilSvc.presentToast({message:"Producto actualizado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(b){return _.apply(this,arguments)}}()).catch(_=>{o.utilSvc.presentToast({message:_.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{i.dismiss()})})()}}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-add-update-gestion"]],inputs:{producto:"producto"},decls:21,vars:14,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],[4,"ngIf"],["class","image-icon","name","image-outline",4,"ngIf"],["size","small","shape","round",3,"click"],["autocomplete","nombre","type","text","label","Nombre",3,"control"],["class","validators",4,"ngIf"],["autocomplete","descripcion","type","text","label","Descripci\xf3n",3,"control"],["autocomplete","cantidad","type","number","label","Cantidad",3,"control"],["slot","start",3,"ionChange","checked"],["mode","ios","type","submit",1,"submit",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[3,"src"],["name","image-outline",1,"image-icon"],[1,"validators"]],template:function(o,t){1&o&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"form",1),e.bIt("ngSubmit",function(){return t.submit()})("keypress.enter",function(){return t.submit()}),e.DNE(3,k,2,1,"ion-avatar",2)(4,f,1,0,"ion-icon",3),e.nrm(5,"br"),e.j41(6,"ion-button",4),e.bIt("click",function(){return t.takePicture()}),e.EFF(7," Tomar/Seleccionar "),e.k0s(),e.nrm(8,"app-custom-input",5),e.DNE(9,M,3,2,"div",6),e.nrm(10,"app-custom-input",7),e.DNE(11,D,3,2,"div",6),e.nrm(12,"app-custom-input",8),e.DNE(13,x,4,3,"div",6),e.j41(14,"ion-item")(15,"ion-label"),e.EFF(16,"Disponible"),e.k0s(),e.j41(17,"ion-checkbox",9),e.bIt("ionChange",function(a){return t.form.controls.disponible.setValue(a.detail.checked)}),e.k0s()(),e.j41(18,"ion-button",10),e.EFF(19),e.nrm(20,"ion-icon",11),e.k0s()()()),2&o&&(e.Y8G("isModal",!0)("title",t.producto?"Actualizar producto":"Agregar producto"),e.R7$(2),e.Y8G("formGroup",t.form),e.R7$(),e.Y8G("ngIf",t.form.value.imagen),e.R7$(),e.Y8G("ngIf",!t.form.value.imagen),e.R7$(4),e.Y8G("control",t.form.controls.nombre),e.R7$(),e.Y8G("ngIf",t.form.controls.nombre.errors&&t.form.controls.nombre.touched),e.R7$(),e.Y8G("control",t.form.controls.descripcion),e.R7$(),e.Y8G("ngIf",t.form.controls.descripcion.errors&&t.form.controls.descripcion.touched),e.R7$(),e.Y8G("control",t.form.controls.stock),e.R7$(),e.Y8G("ngIf",t.form.controls.stock.errors&&t.form.controls.stock.touched),e.R7$(4),e.Y8G("checked",t.form.controls.disponible.value),e.R7$(),e.Y8G("disabled",t.form.invalid),e.R7$(),e.SpI(" ",t.producto?"Actualizar producto":"Agregar producto"," "))},dependencies:[d.bT,l.mC,l.Jm,l.eY,l.W9,l.iq,l.uz,l.he,l.hB,s.qT,s.cb,s.j4,P.l,h.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),c})();function Y(n,c){if(1&n&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&n){const r=c.$implicit;e.Y8G("value",r.uidProducto),e.R7$(),e.SpI(" ",r.nombreProducto," ")}}function U(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function N(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," La descripci\xf3n debe tener al menos 4 caracteres "),e.k0s())}function O(n,c){if(1&n&&(e.j41(0,"div",11),e.DNE(1,U,2,0,"div",12)(2,N,2,0,"div",12),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.nombre.errors?null:r.form.controls.nombre.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.nombre.errors?null:r.form.controls.nombre.errors.min)}}function X(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function V(n,c){1&n&&(e.j41(0,"div"),e.EFF(1," La cantidad m\xednima debe ser 0"),e.k0s())}function B(n,c){if(1&n&&(e.j41(0,"div",11),e.DNE(1,X,2,0,"div",12)(2,V,2,0,"div",12),e.k0s()),2&n){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.precio.errors?null:r.form.controls.precio.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.precio.errors?null:r.form.controls.precio.errors.min)}}let F=(()=>{var n;class c{constructor(){this.dataSelect=[],this.producto=null,this.form=new s.gE({uid:new s.MJ(""),uidProducto:new s.MJ(""),nombreProducto:new s.MJ("",[s.k0.required]),nombre:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),precio:new s.MJ(null,[s.k0.required,s.k0.min(0)]),granel:new s.MJ(!1,[s.k0.required])}),this.firebaseSvc=(0,e.WQX)(v.f),this.utilSvc=(0,e.WQX)(g.T)}ngOnInit(){this.producto&&this.form.patchValue({...this.producto}),this.getInventario()}setNumberInputs(){}submit(){var o=this;return(0,p.A)(function*(){o.form.valid&&(o.producto?yield o.updateProduct():yield o.createProduct(o.form.value))})()}onProductChange(o){const t=this.dataSelect.find(i=>i.uidProducto===o.detail.value);t&&this.form.patchValue({uidProducto:t.uidProducto,nombreProducto:t.nombreProducto})}createProduct(o){var t=this;return(0,p.A)(function*(){const i=yield t.utilSvc.loading();yield i.present();try{const u={...o},_=`productos/${u.uidProducto}/opciones`,b={nombre:u.nombre,precio:u.precio,granel:u.granel};yield t.firebaseSvc.addDocumentWithUid(_,b),t.utilSvc.presentToast({message:"Producto y opciones creados exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),t.utilSvc.dismissModal({success:!0})}catch(a){t.utilSvc.presentToast({message:a.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}finally{i.dismiss()}})()}updateProduct(){var o=this;return(0,p.A)(function*(){let t=`productos/${o.producto.uidProducto}/opciones/${o.form.value.uid}`;const i=yield o.utilSvc.loading();yield i.present(),o.firebaseSvc.updateDocumet(t,o.form.value).then(function(){var a=(0,p.A)(function*(u){o.utilSvc.dismissModal({success:!0}),o.utilSvc.presentToast({message:"Producto actualizado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(u){return a.apply(this,arguments)}}()).catch(a=>{o.utilSvc.presentToast({message:a.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{i.dismiss()})})()}getInventario(){this.firebaseSvc.getCollectionData("productos",[]).subscribe(t=>{this.dataSelect=t.map(i=>({nombreProducto:i.nombre,uidProducto:i.uid}))})}}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-add-update-precios"]],inputs:{producto:"producto"},decls:16,vars:11,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],["justify","space-between","fill","outline","formControlName","uidProducto","label","Tipo de producto","placeholder","Selecciona un producto",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["autocomplete","nombre","type","text","label","Tipo de venta",3,"control"],["class","validators",4,"ngIf"],["type","number","label","Precio",3,"ionInput","control"],["slot","start",3,"ionChange","checked"],["mode","ios","type","submit",1,"submit",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[3,"value"],[1,"validators"],[4,"ngIf"]],template:function(o,t){1&o&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"form",1),e.bIt("ngSubmit",function(){return t.submit()})("keypress.enter",function(){return t.submit()}),e.j41(3,"ion-select",2),e.bIt("ionChange",function(a){return t.onProductChange(a)}),e.DNE(4,Y,2,2,"ion-select-option",3),e.k0s(),e.nrm(5,"app-custom-input",4),e.DNE(6,O,3,2,"div",5),e.j41(7,"app-custom-input",6),e.bIt("ionInput",function(){return t.setNumberInputs()}),e.k0s(),e.DNE(8,B,3,2,"div",5),e.j41(9,"ion-item")(10,"ion-label"),e.EFF(11,"Granel"),e.k0s(),e.j41(12,"ion-checkbox",7),e.bIt("ionChange",function(a){return t.form.controls.granel.setValue(a.detail.checked)}),e.k0s()(),e.j41(13,"ion-button",8),e.EFF(14),e.nrm(15,"ion-icon",9),e.k0s()()()),2&o&&(e.Y8G("isModal",!0)("title",t.producto?"Actualizar tipo de venta":"Agregar tipo de venta"),e.R7$(2),e.Y8G("formGroup",t.form),e.R7$(2),e.Y8G("ngForOf",t.dataSelect),e.R7$(),e.Y8G("control",t.form.controls.nombre),e.R7$(),e.Y8G("ngIf",t.form.controls.nombre.errors&&t.form.controls.nombre.touched),e.R7$(),e.Y8G("control",t.form.controls.precio),e.R7$(),e.Y8G("ngIf",t.form.controls.precio.errors&&t.form.controls.precio.touched),e.R7$(4),e.Y8G("checked",t.form.controls.granel.value),e.R7$(),e.Y8G("disabled",t.form.invalid),e.R7$(),e.SpI(" ",t.producto?"Actualizar tipo de venta":"Agregar tipo de venta"," "))},dependencies:[d.Sq,d.bT,l.Jm,l.eY,l.W9,l.iq,l.uz,l.he,l.Nm,l.Ip,l.hB,l.Je,s.qT,s.BC,s.cb,s.j4,s.JD,P.l,h.H]}),c})();function J(n,c){if(1&n){const r=e.RV6();e.j41(0,"ion-input",32),e.mxI("ngModelChange",function(t){e.eBV(r);const i=e.XpG(2).$implicit,a=e.XpG().$implicit;return e.DH7(a[i.key],t)||(a[i.key]=t),e.Njj(t)}),e.bIt("keyup.enter",function(){e.eBV(r);const t=e.XpG(4);return e.Njj(t.finishEditing())})("blur",function(){e.eBV(r);const t=e.XpG(4);return e.Njj(t.finishEditing())}),e.k0s()}if(2&n){const r=e.XpG(2).$implicit,o=e.XpG().$implicit;e.R50("ngModel",o[r.key])}}function z(n,c){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const r=e.XpG(2).$implicit,o=e.XpG().$implicit;e.R7$(),e.SpI(" ",o[r.key]," ")}}function q(n,c){if(1&n&&(e.j41(0,"ion-col",29),e.DNE(1,J,1,1,"ion-input",30)(2,z,2,1,"span",31),e.k0s()),2&n){const r=e.XpG().$implicit,o=e.XpG().$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",t.editingFieldKey===r.key&&t.editingField===o),e.R7$(),e.Y8G("ngIf",!(t.editingFieldKey===r.key&&t.editingField===o))}}function L(n,c){if(1&n&&(e.qex(0),e.DNE(1,q,3,2,"ion-col",28),e.bVm()),2&n){const r=c.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.shouldShowField(r.key)&&"imagen"!==r.key&&"disponible"!==r.key)}}function W(n,c){1&n&&e.nrm(0,"ion-icon",33)}function K(n,c){1&n&&e.nrm(0,"ion-icon",34)}function H(n,c){if(1&n){const r=e.RV6();e.j41(0,"ion-row",18),e.DNE(1,L,2,1,"ng-container",19),e.j41(2,"ion-col",20),e.DNE(3,W,1,0,"ion-icon",21)(4,K,1,0,"ion-icon",22),e.k0s(),e.j41(5,"ion-col",20),e.nrm(6,"ion-img",23),e.k0s(),e.j41(7,"ion-col")(8,"ion-button",24),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.editItem(t))}),e.nrm(9,"ion-icon",25),e.k0s(),e.j41(10,"ion-button",26),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.deleteItem(t))}),e.nrm(11,"ion-icon",27),e.k0s()()()}if(2&n){const r=c.$implicit,o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.fields),e.R7$(2),e.Y8G("ngIf",!0===r.disponible),e.R7$(),e.Y8G("ngIf",!1===r.disponible),e.R7$(2),e.Y8G("src",r.imagen)}}function Q(n,c){if(1&n){const r=e.RV6();e.j41(0,"ion-input",32),e.mxI("ngModelChange",function(t){e.eBV(r);const i=e.XpG(2).$implicit,a=e.XpG().$implicit;return e.DH7(a[i.key],t)||(a[i.key]=t),e.Njj(t)}),e.bIt("keyup.enter",function(){e.eBV(r);const t=e.XpG(4);return e.Njj(t.finishEditing())})("blur",function(){e.eBV(r);const t=e.XpG(4);return e.Njj(t.finishEditing())}),e.k0s()}if(2&n){const r=e.XpG(2).$implicit,o=e.XpG().$implicit;e.R50("ngModel",o[r.key])}}function Z(n,c){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const r=e.XpG(2).$implicit,o=e.XpG().$implicit;e.R7$(),e.SpI(" ",o[r.key]," ")}}function ee(n,c){if(1&n&&(e.j41(0,"ion-col",29),e.DNE(1,Q,1,1,"ion-input",30)(2,Z,2,1,"span",31),e.k0s()),2&n){const r=e.XpG().$implicit,o=e.XpG().$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",t.editingFieldKey===r.key&&t.editingField===o),e.R7$(),e.Y8G("ngIf",!(t.editingFieldKey===r.key&&t.editingField===o))}}function te(n,c){if(1&n&&(e.qex(0),e.DNE(1,ee,3,2,"ion-col",28),e.bVm()),2&n){const r=c.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.shouldShowFieldSub(r.key)&&"imagen"!==r.key&&"granel"!==r.key)}}function oe(n,c){1&n&&e.nrm(0,"ion-icon",37)}function ne(n,c){1&n&&e.nrm(0,"ion-icon",38)}function ie(n,c){if(1&n){const r=e.RV6();e.j41(0,"ion-row",18),e.DNE(1,te,2,1,"ng-container",19),e.j41(2,"ion-col",20),e.DNE(3,oe,1,0,"ion-icon",35)(4,ne,1,0,"ion-icon",36),e.k0s(),e.j41(5,"ion-col")(6,"ion-button",24),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.editItemSub(t))}),e.nrm(7,"ion-icon",25),e.k0s(),e.j41(8,"ion-button",26),e.bIt("click",function(){const t=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.deleteItemSub(t))}),e.nrm(9,"ion-icon",27),e.k0s()()()}if(2&n){const r=c.$implicit,o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.fieldsSub),e.R7$(2),e.Y8G("ngIf",!0===r.granel),e.R7$(),e.Y8G("ngIf",!1===r.granel)}}const re=[{path:"",component:(()=>{var n;class c{constructor(o,t,i,a,u){this.modalCtrl=o,this.formBuilder=t,this.cdr=i,this.firebaseService=a,this.alertController=u,this.data=[],this.dataSub=[],this.form=new s.gE({uid:new s.MJ(""),imagen:new s.MJ("",[s.k0.required]),nombre:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),descripcion:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),unidad:new s.MJ(null,[s.k0.required,s.k0.min(0)]),disponible:new s.MJ(!1,[s.k0.required])}),this.formSub=new s.gE({uid:new s.MJ(""),uidProducto:new s.MJ(""),nombreProducto:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),nombre:new s.MJ("",[s.k0.required,s.k0.minLength(4)]),precio:new s.MJ(null,[s.k0.required,s.k0.min(0)]),granel:new s.MJ(!1,[s.k0.required])}),this.isModalOpen=!1,this.filteredData=[...this.data],this.filteredDataSub=[...this.dataSub],this.editingField=null,this.editingFieldKey="",this.searchTerm="",this.utilsSvc=(0,e.WQX)(g.T),this.areColumnsVisible=!1,this.paginatedData=[],this.paginatedDataSub=[],this.currentPage=1,this.currentPageSub=1,this.itemsPerPage=10,this.itemsPerPageSub=10,this.totalPages=0,this.totalPagesSub=0,this.showDescripcion=!1,this.showImagen=!1,this.showDisponible=!1,this.showNombre=!1,this.showStock=!1,this.showPrecio=!1,this.showGranel=!1,this.showTipoVenta=!1,this.firebaseSvc=(0,e.WQX)(v.f),this.fields=[{key:"nombre",label:"Nombre"},{key:"descripcion",label:"Descripcion"},{key:"disponible",label:"Disponibilidad"},{key:"stock",label:"Cantidad"},{key:"imagen",label:"Imagen"}],this.fieldsSub=[{key:"nombreProducto",label:"Nombre"},{key:"nombre",label:"Tipo de venta"},{key:"precio",label:"Precio"},{key:"granel",label:"Granel"}],this.setPage(1),this.productForm=this.formBuilder.group({nombre:[""],imagen:[""],descripcion:[""],stock:[""],disponible:[""]}),this.productFormSub=this.formBuilder.group({nombreProducto:[""],nombre:[""],granel:[""],precio:[""]})}ngOnInit(){this.getProducts(),this.getProductsSub()}doRefresh(o){setTimeout(()=>{o.target.complete()},1e3)}filterItems(o){const t=o.target.value.toLowerCase();this.paginatedData=this.data.filter(i=>Object.values(i).some(a=>a.toString().toLowerCase().includes(t))),this.cdr.detectChanges()}filterItemsSub(o){const t=o.target.value.toLowerCase();this.paginatedDataSub=this.dataSub.filter(i=>Object.values(i).some(a=>a.toString().toLowerCase().includes(t))),this.cdr.detectChanges()}sortTable(o){this.paginatedData.sort((t,i)=>t[o]<i[o]?-1:t[o]>i[o]?1:0),this.cdr.detectChanges()}sortTableSub(o){this.paginatedDataSub.sort((t,i)=>t[o]<i[o]?-1:t[o]>i[o]?1:0),this.cdr.detectChanges()}editField(o,t){this.editingField=o,this.editingFieldKey=t}finishEditing(){this.editingField=null,this.editingFieldKey=null}deleteItem(o){this.presentConfirmDeleteAlert(o)}presentConfirmDeleteAlert(o){var t=this;return(0,p.A)(function*(){yield(yield t.alertController.create({header:"Confirmaci\xf3n",message:`\xbfEst\xe1s seguro de que deseas eliminar el producto ${o.nombre}?`,buttons:[{text:"Cancelar",role:"cancel",handler:()=>{t.utilsSvc.presentToast({message:"Eliminaci\xf3n cancelada.",duration:1500,color:"warning",position:"middle",icon:"alert-circle-outline"})}},{text:"Eliminar",role:"destructive",handler:()=>{t.confirmDeleteItem(o)}}]})).present()})()}confirmDeleteItem(o){const t=this.data.findIndex(i=>i.uid===o.uid);t>-1?(this.data.splice(t,1),this.paginatedData=[...this.data],this.setPage(1),this.cdr.detectChanges(),this.firebaseSvc.deleteDocumet(`productos/${o.uid}`).then(()=>{this.utilsSvc.presentToast({message:"Porducto eliminado exitosamente.",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})}).catch(a=>{this.utilsSvc.presentToast({message:"Error al eliminar el producto.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})})):this.utilsSvc.presentToast({message:"Producto no encontrado en la lista.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}editItem(o){var t=this;return(0,p.A)(function*(){try{const i=yield t.modalCtrl.create({component:I,componentProps:{producto:o}});i.onDidDismiss().then(a=>{if(a.data){const u=t.data.findIndex(_=>_.uid===a.data.uid);u>-1&&(t.data[u]=a.data),t.paginatedData=[...t.data],t.cdr.detectChanges()}}),yield i.present()}catch{}})()}openAddProductModal(){var o=this;return(0,p.A)(function*(){const t=yield o.modalCtrl.create({component:I,componentProps:{productForm:o.productForm}});return t.onDidDismiss().then(i=>{i.data&&(o.paginatedData=[...o.data],o.cdr.detectChanges())}),yield t.present()})()}closeModal(){this.modalCtrl.dismiss()}submitProduct(){this.productForm.valid&&(this.data.push(this.productForm.value),this.paginatedData=[...this.data],this.productForm.reset(),this.closeModal(),this.cdr.detectChanges())}addProduct(){this.productForm.valid&&(this.paginatedData=[...this.data],this.productForm.reset(),this.closeModal(),this.cdr.detectChanges())}setPage(o){this.currentPage=o;const t=(o-1)*this.itemsPerPage;this.paginatedData=this.data.slice(t,t+this.itemsPerPage),this.totalPages=Math.ceil(this.data.length/this.itemsPerPage)}previousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}toggleColumns(){this.showDisponible=!this.showDisponible,this.showImagen=!this.showImagen,this.showDescripcion=!this.showDescripcion,this.showNombre=!this.showNombre}shouldShowField(o){return!0}getProducts(){this.firebaseService.obtenerColeccion("productos").subscribe(o=>{this.data=o.map(t=>({uid:t.uid,nombre:t.nombre,stock:t.stock,precio:t.precio_mostrador,imagen:t.imagen,descripcion:t.descripcion,disponible:t.disponible})),this.paginatedData=[...this.data],this.setPage(1)})}deleteItemSub(o){this.presentConfirmDeleteAlertSub(o)}presentConfirmDeleteAlertSub(o){var t=this;return(0,p.A)(function*(){yield(yield t.alertController.create({header:"Confirmaci\xf3n",message:`\xbfEst\xe1s seguro de que deseas eliminar el producto ${o.nombre}?`,buttons:[{text:"Cancelar",role:"cancel",handler:()=>{t.utilsSvc.presentToast({message:"Eliminaci\xf3n cancelada.",duration:1500,color:"warning",position:"middle",icon:"alert-circle-outline"})}},{text:"Eliminar",role:"destructive",handler:()=>{t.confirmDeleteItemSub(o)}}]})).present()})()}confirmDeleteItemSub(o){const t=this.dataSub.findIndex(i=>i.uid===o.uid);t>-1?(this.dataSub.splice(t,1),this.paginatedDataSub=[...this.dataSub],this.setPage(1),this.cdr.detectChanges(),this.firebaseSvc.deleteDocumet(`productos/${o.uidProducto}/opciones/${o.uid}`).then(()=>{this.utilsSvc.presentToast({message:"Porducto eliminado exitosamente.",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})}).catch(a=>{this.utilsSvc.presentToast({message:"Error al eliminar el producto.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})})):this.utilsSvc.presentToast({message:"Producto no encontrado en la lista.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}editItemSub(o){var t=this;return(0,p.A)(function*(){console.log(o);try{const i=yield t.modalCtrl.create({component:F,componentProps:{producto:o}});i.onDidDismiss().then(a=>{if(a.data){const u=t.dataSub.findIndex(_=>_.uid===a.data.uid);u>-1&&(t.dataSub[u]=a.data),t.paginatedDataSub=[...t.dataSub],t.cdr.detectChanges(),t.getProductsSub()}}),yield i.present()}catch{}})()}openAddProductModalSub(){var o=this;return(0,p.A)(function*(){const t=yield o.modalCtrl.create({component:F,componentProps:{productFormSub:o.productFormSub}});return t.onDidDismiss().then(i=>{if(i.data){const a=o.dataSub.findIndex(u=>u.uid===i.data.uid);a>-1?o.dataSub[a]=i.data:o.dataSub.push(i.data),o.paginatedDataSub=[...o.dataSub],o.cdr.detectChanges(),o.getProductsSub()}}),yield t.present()})()}submitProductSub(){this.productFormSub.valid&&(this.dataSub.push(this.productFormSub.value),this.paginatedData=[...this.dataSub],this.productFormSub.reset(),this.closeModal(),this.cdr.detectChanges())}addProductSub(){this.productFormSub.valid&&(this.paginatedData=[...this.dataSub],this.productFormSub.reset(),this.closeModal(),this.cdr.detectChanges())}setPageSub(o){this.currentPageSub=o;const t=(o-1)*this.itemsPerPageSub;this.paginatedDataSub=this.dataSub.slice(t,t+this.itemsPerPageSub),this.totalPagesSub=Math.ceil(this.dataSub.length/this.itemsPerPageSub)}previousPageSub(){this.currentPageSub>1&&this.setPageSub(this.currentPageSub-1)}nextPageSub(){this.currentPageSub<this.totalPagesSub&&this.setPageSub(this.currentPageSub+1)}toggleColumnsSub(){this.showPrecio=!this.showPrecio,this.showStock=!this.showStock,this.showGranel=!this.showGranel,this.showNombre=!this.showNombre,this.showTipoVenta=!this.showTipoVenta}shouldShowFieldSub(o){return!0}getProductsSub(){this.firebaseService.obtenerColeccion("productos").subscribe(o=>{const t=[];o.forEach(i=>{const a=i.nombre,u=i.uid;this.firebaseService.obtenerSubColeccion(`productos/${i.uid}/opciones`).subscribe(_=>{_.forEach(b=>{t.push({uid:i.uid,uidProducto:u,nombre:i.nombre,nombreProducto:a,granel:i.granel,precio:i.precio_mostrador,...b})}),this.dataSub=t,this.paginatedDataSub=[...this.dataSub],this.setPageSub(1)})})})}}return(n=c).\u0275fac=function(o){return new(o||n)(e.rXU(l.W3),e.rXU(s.ok),e.rXU(e.gRc),e.rXU(v.f),e.rXU(l.hG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-gestion"]],decls:77,vars:13,consts:[["title","Gesti\xf3n de productos",3,"showMenu"],[1,"ion-padding-top","ion-text-center"],["slot","fixed",3,"ionRefresh"],["size","8"],["placeholder","Buscar productos...",3,"ngModelChange","ionInput","ngModel"],["size","4",1,"ion-text-right"],["color","success",3,"click"],["name","add-circle-outline"],[1,"table-header"],[1,"header-row"],[3,"click"],["class","data-row",4,"ngFor","ngForOf"],[1,"pagination"],["color","light","expand","full",1,"pagination-button",3,"click","disabled"],["slot","start","name","arrow-back"],[1,"pagination-info"],["slot","end","name","arrow-forward"],[1,"ion-padding-top","ion-text-center",2,"margin-top","60px"],[1,"data-row"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","flex-start"],["name","checkmark-circle","color","success","size","large","aria-label","Disponible",4,"ngIf"],["name","close-circle","color","danger","size","large","aria-label","No disponible",4,"ngIf"],[2,"width","50px","height","auto",3,"src"],["color","warning",3,"click"],["name","create"],["color","danger",3,"click"],["name","trash"],["class","pointer-on",4,"ngIf"],[1,"pointer-on"],["class","cololetra",3,"ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[4,"ngIf"],[1,"cololetra",3,"ngModelChange","keyup.enter","blur","ngModel"],["name","checkmark-circle","color","success","size","large","aria-label","Disponible"],["name","close-circle","color","danger","size","large","aria-label","No disponible"],["name","checkmark-circle","color","success","size","large","aria-label","Granel",4,"ngIf"],["name","close-circle","color","danger","size","large","aria-label","No granel",4,"ngIf"],["name","checkmark-circle","color","success","size","large","aria-label","Granel"],["name","close-circle","color","danger","size","large","aria-label","No granel"]],template:function(o,t){1&o&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"div",1)(3,"ion-refresher",2),e.bIt("ionRefresh",function(a){return t.doRefresh(a)}),e.nrm(4,"ion-refresher-content"),e.k0s(),e.j41(5,"h2"),e.EFF(6,"Gesti\xf3n de productos"),e.k0s(),e.j41(7,"ion-grid")(8,"ion-row")(9,"ion-col",3)(10,"ion-searchbar",4),e.mxI("ngModelChange",function(a){return e.DH7(t.searchTerm,a)||(t.searchTerm=a),a}),e.bIt("ionInput",function(a){return t.filterItems(a)}),e.k0s()(),e.j41(11,"ion-col",5)(12,"ion-button",6),e.bIt("click",function(){return t.openAddProductModal()}),e.nrm(13,"ion-icon",7),e.EFF(14," Agregar producto "),e.k0s()()()(),e.nrm(15,"div",8),e.j41(16,"ion-grid")(17,"ion-row",9)(18,"ion-col",10),e.bIt("click",function(){return t.sortTable("nombre")}),e.EFF(19,"Nombre"),e.k0s(),e.j41(20,"ion-col",10),e.bIt("click",function(){return t.sortTable("descripcion")}),e.EFF(21,"Descripcion"),e.k0s(),e.j41(22,"ion-col",10),e.bIt("click",function(){return t.sortTableSub("stock")}),e.EFF(23,"Cantidad disponible"),e.k0s(),e.j41(24,"ion-col",10),e.bIt("click",function(){return t.sortTable("disponible")}),e.EFF(25,"Disponibilidad"),e.k0s(),e.j41(26,"ion-col",10),e.bIt("click",function(){return t.sortTable("imagen")}),e.EFF(27,"Imagen"),e.k0s(),e.j41(28,"ion-col"),e.EFF(29,"Acciones"),e.k0s()(),e.DNE(30,H,12,4,"ion-row",11),e.k0s(),e.j41(31,"div",12)(32,"ion-button",13),e.bIt("click",function(){return t.previousPage()}),e.nrm(33,"ion-icon",14),e.EFF(34," Anterior "),e.k0s(),e.j41(35,"span",15),e.EFF(36),e.k0s(),e.j41(37,"ion-button",13),e.bIt("click",function(){return t.nextPage()}),e.EFF(38," Siguiente "),e.nrm(39,"ion-icon",16),e.k0s()()(),e.nrm(40,"hr"),e.j41(41,"div",17)(42,"ion-refresher",2),e.bIt("ionRefresh",function(a){return t.doRefresh(a)}),e.nrm(43,"ion-refresher-content"),e.k0s(),e.j41(44,"h2"),e.EFF(45,"Gesti\xf3n de categorias de venta para los productos"),e.k0s(),e.j41(46,"ion-grid")(47,"ion-row")(48,"ion-col",3)(49,"ion-searchbar",4),e.mxI("ngModelChange",function(a){return e.DH7(t.searchTerm,a)||(t.searchTerm=a),a}),e.bIt("ionInput",function(a){return t.filterItemsSub(a)}),e.k0s()(),e.j41(50,"ion-col",5)(51,"ion-button",6),e.bIt("click",function(){return t.openAddProductModalSub()}),e.nrm(52,"ion-icon",7),e.EFF(53," Agregar producto "),e.k0s()()()(),e.nrm(54,"div",8),e.j41(55,"ion-grid")(56,"ion-row",9)(57,"ion-col",10),e.bIt("click",function(){return t.sortTableSub("nombreProducto")}),e.EFF(58,"Producto"),e.k0s(),e.j41(59,"ion-col",10),e.bIt("click",function(){return t.sortTableSub("nombre")}),e.EFF(60,"Tipo de venta"),e.k0s(),e.j41(61,"ion-col",10),e.bIt("click",function(){return t.sortTableSub("precio")}),e.EFF(62,"Precio"),e.k0s(),e.j41(63,"ion-col",10),e.bIt("click",function(){return t.sortTableSub("granel")}),e.EFF(64,"Venta a granel"),e.k0s(),e.j41(65,"ion-col"),e.EFF(66,"Acciones"),e.k0s()(),e.DNE(67,ie,10,3,"ion-row",11),e.k0s(),e.j41(68,"div",12)(69,"ion-button",13),e.bIt("click",function(){return t.previousPageSub()}),e.nrm(70,"ion-icon",14),e.EFF(71," Anterior "),e.k0s(),e.j41(72,"span",15),e.EFF(73),e.k0s(),e.j41(74,"ion-button",13),e.bIt("click",function(){return t.nextPageSub()}),e.EFF(75," Siguiente "),e.nrm(76,"ion-icon",16),e.k0s()()()()),2&o&&(e.Y8G("showMenu",!0),e.R7$(10),e.R50("ngModel",t.searchTerm),e.R7$(20),e.Y8G("ngForOf",t.paginatedData),e.R7$(2),e.Y8G("disabled",1===t.currentPage),e.R7$(4),e.Lme("P\xe1gina ",t.currentPage," de ",t.totalPages,""),e.R7$(),e.Y8G("disabled",t.currentPage===t.totalPages),e.R7$(12),e.R50("ngModel",t.searchTerm),e.R7$(18),e.Y8G("ngForOf",t.paginatedDataSub),e.R7$(2),e.Y8G("disabled",1===t.currentPageSub),e.R7$(4),e.Lme("P\xe1gina ",t.currentPageSub," de ",t.totalPagesSub,""),e.R7$(),e.Y8G("disabled",t.currentPageSub===t.totalPagesSub))},dependencies:[d.Sq,d.bT,s.BC,s.vS,l.Jm,l.hU,l.W9,l.lO,l.iq,l.KW,l.$w,l.To,l.Ki,l.ln,l.S1,l.Gw,P.l],styles:['@charset "UTF-8";ion-grid[_ngcontent-%COMP%]{border-radius:15px;overflow:hidden;margin-top:20px;padding-left:3rem;padding-right:3rem}.header-row[_ngcontent-%COMP%]{background-color:#1ad436;color:#fff;font-weight:700;text-align:center;border-top-left-radius:15px;border-top-right-radius:15px;cursor:pointer}.data-row[_ngcontent-%COMP%]{background-color:#f9f9f9;border-bottom:1px solid #1ad436;text-align:center}.data-row[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:15px;border-bottom-right-radius:15px}ion-col[_ngcontent-%COMP%]{padding:10px}ion-button[_ngcontent-%COMP%]{margin-top:10px}ion-searchbar[_ngcontent-%COMP%]{margin-top:10px}.cololetra[_ngcontent-%COMP%]{background-color:#d4fcd8;border-radius:5px;padding:8px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;margin-bottom:3rem;flex-wrap:wrap}.pagination-button[_ngcontent-%COMP%]{margin:0 5px;flex:1;max-width:150px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;margin-right:4rem}.toggle-columns-button[_ngcontent-%COMP%]{font-size:14px;padding:0}.toggle-columns-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}@media (max-width: 768px){ion-grid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}ion-col[_ngcontent-%COMP%]{font-size:12px;padding:5px}.header-row[_ngcontent-%COMP%]{font-size:14px}.data-row[_ngcontent-%COMP%]{font-size:12px}ion-searchbar[_ngcontent-%COMP%]{width:100%}.pagination[_ngcontent-%COMP%]{flex-direction:column}}@media (max-width: 480px){.header-row[_ngcontent-%COMP%], .data-row[_ngcontent-%COMP%]{font-size:10px}ion-button[_ngcontent-%COMP%]{font-size:10px;padding:5px}ion-searchbar[_ngcontent-%COMP%]{width:100%;margin-top:5px}}ion-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}ion-card-header[_ngcontent-%COMP%], ion-card-content[_ngcontent-%COMP%]{flex-grow:1}.tittle-today[_ngcontent-%COMP%]{margin-top:4%}.chart[_ngcontent-%COMP%]{margin:2%}']}),c})()}];let se=(()=>{var n;class c{}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[G.iI.forChild(re),G.iI]}),c})();var ae=m(7383);let ce=(()=>{var n;class c{}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.MD,s.YN,l.bv,se,ae.G]}),c})()},8827:(y,S,m)=>{m.d(S,{H:()=>v});var d=m(4438),s=m(177),l=m(5933),G=m(9417);function p(g,P){if(1&g&&d.nrm(0,"ion-icon",4),2&g){const h=d.XpG();d.Y8G("name",h.icon)}}function e(g,P){if(1&g){const h=d.RV6();d.j41(0,"ion-button",5),d.bIt("click",function(){d.eBV(h);const f=d.XpG();return d.Njj(f.showOrHidePassword())}),d.nrm(1,"ion-icon",6),d.k0s()}if(2&g){const h=d.XpG();d.R7$(),d.Y8G("name",h.hide?"eye-outline":"eye-off-outline")}}let v=(()=>{var g;class P{constructor(){this.hide=!0}ngOnInit(){"password"==this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(g=P).\u0275fac=function(k){return new(k||g)},g.\u0275cmp=d.VBU({type:g,selectors:[["app-custom-input"]],inputs:{control:"control",type:"type",label:"label",autocomplete:"autocomplete",icon:"icon"},decls:4,vars:6,consts:[["lines","none",1,"custom-input"],["color","primary","slot","start",3,"name",4,"ngIf"],["label-placement","floating",3,"type","autocomplete","label","formControl"],["slot","end","fill","clear","shape","round",3,"click",4,"ngIf"],["color","primary","slot","start",3,"name"],["slot","end","fill","clear","shape","round",3,"click"],["slot","icon-only",3,"name"]],template:function(k,f){1&k&&(d.j41(0,"ion-item",0),d.DNE(1,p,1,1,"ion-icon",1),d.nrm(2,"ion-input",2),d.DNE(3,e,2,1,"ion-button",3),d.k0s()),2&k&&(d.R7$(),d.Y8G("ngIf",f.icon),d.R7$(),d.Y8G("type",f.type)("autocomplete",f.autocomplete)("label",f.label)("formControl",f.control),d.R7$(),d.Y8G("ngIf",f.isPassword))},dependencies:[s.bT,l.Jm,l.iq,l.$w,l.uz,l.Gw,G.BC,G.l_]}),P})()}}]);