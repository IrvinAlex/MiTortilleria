"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[791],{791:(y,b,u)=>{u.r(b),u.d(b,{CuponesPageModule:()=>Y});var s=u(177),l=u(9417),c=u(5933),C=u(8265),_=u(467),e=u(4438),P=u(8663),p=u(2723),f=u(8461),m=u(8827);function h(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function g(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"El nombre debe tener al menos 4 caracteres"),e.k0s())}function M(t,a){if(1&t&&(e.j41(0,"div",9),e.DNE(1,h,2,0,"div",10)(2,g,2,0,"div",10),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.descripcion.errors?null:r.form.controls.descripcion.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.descripcion.errors?null:r.form.controls.descripcion.errors.minlength)}}function I(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function w(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"El nombre debe tener al menos 4 caracteres"),e.k0s())}function T(t,a){if(1&t&&(e.j41(0,"div",9),e.DNE(1,I,2,0,"div",10)(2,w,2,0,"div",10),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.codigo.errors?null:r.form.controls.codigo.errors.required),e.R7$(),e.Y8G("ngIf",null==r.form.controls.descripcion.errors?null:r.form.controls.descripcion.errors.minlength)}}function j(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function E(t,a){if(1&t&&(e.j41(0,"div",9),e.DNE(1,j,2,0,"div",10),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.numero_compras.errors?null:r.form.controls.numero_compras.errors.required)}}function G(t,a){1&t&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function D(t,a){if(1&t&&(e.j41(0,"div",9),e.DNE(1,G,2,0,"div",10),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.Y8G("ngIf",null==r.form.controls.porcentaje.errors?null:r.form.controls.porcentaje.errors.required)}}let k=(()=>{var t;class a{constructor(){this.cupon=null,this.form=new l.gE({uid:new l.MJ(""),descripcion:new l.MJ("",[l.k0.required,l.k0.minLength(4)]),codigo:new l.MJ("",[l.k0.required,l.k0.minLength(4)]),porcentaje:new l.MJ(null,[l.k0.required]),numero_compras:new l.MJ(null,[l.k0.required])}),this.firebaseSvc=(0,e.WQX)(P.f),this.utilSvc=(0,e.WQX)(p.T)}ngOnInit(){this.cupon&&this.form.patchValue({...this.cupon})}submit(){var n=this;return(0,_.A)(function*(){n.form.valid?n.cupon?yield n.updateCupon():yield n.createCupon():n.utilSvc.presentToast({message:"Por favor, completa todos los campos requeridos.",duration:2e3,color:"warning",position:"top"})})()}createCupon(){var n=this;return(0,_.A)(function*(){const o=yield n.utilSvc.loading();yield o.present();try{const i={...n.form.value};yield n.firebaseSvc.addDocumentWithUid("cupones",i),n.utilSvc.presentToast({message:"Cup\xf3n creado exitosamente.",duration:1500,color:"success"}),n.utilSvc.dismissModal({success:!0})}catch(i){n.utilSvc.presentToast({message:"Error al crear cup\xf3n.",duration:2e3,color:"danger"}),console.error(i)}finally{o.dismiss()}})()}updateCupon(){var n=this;return(0,_.A)(function*(){const o=yield n.utilSvc.loading();yield o.present();try{var i;const v=`cupones/${null===(i=n.form.get("uid"))||void 0===i?void 0:i.value}`,F={...n.form.value};delete F.uid,yield n.firebaseSvc.updateDocumet(v,F),n.utilSvc.presentToast({message:"Cup\xf3n actualizado exitosamente.",duration:1500,color:"success"}),n.utilSvc.dismissModal({success:!0})}catch(d){n.utilSvc.presentToast({message:"Error al actualizar cup\xf3n.",duration:2e3,color:"danger"}),console.error(d)}finally{o.dismiss()}})()}}return(t=a).\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.VBU({type:t,selectors:[["app-add-update-cupon"]],inputs:{cupon:"cupon"},decls:14,vars:13,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],["autocomplete","descripcion","type","text","label","Descripci\xf3n",3,"control"],["class","validators",4,"ngIf"],["autocomplete","codigo","type","text","label","Cod\xedgo",3,"control"],["autocomplete","numero_compras","type","number","label","N\xfamero de compras minimas",3,"control"],["autocomplete","off","autocorrect","off","type","number","label","Porcentaje",3,"control"],["mode","ios","type","submit",1,"submit",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[1,"validators"],[4,"ngIf"]],template:function(n,o){1&n&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"form",1),e.bIt("ngSubmit",function(){return o.submit()})("keypress.enter",function(){return o.submit()}),e.nrm(3,"app-custom-input",2),e.DNE(4,M,3,2,"div",3),e.nrm(5,"app-custom-input",4),e.DNE(6,T,3,2,"div",3),e.nrm(7,"app-custom-input",5),e.DNE(8,E,2,1,"div",3),e.nrm(9,"app-custom-input",6),e.DNE(10,D,2,1,"div",3),e.j41(11,"ion-button",7),e.EFF(12),e.nrm(13,"ion-icon",8),e.k0s()()()),2&n&&(e.Y8G("isModal",!0)("title",o.cupon?"Actualizar cup\xf3n":"Agregar cup\xf3n"),e.R7$(2),e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("control",o.form.controls.descripcion),e.R7$(),e.Y8G("ngIf",o.form.controls.descripcion.errors&&o.form.controls.descripcion.touched),e.R7$(),e.Y8G("control",o.form.controls.codigo),e.R7$(),e.Y8G("ngIf",o.form.controls.codigo.errors&&o.form.controls.codigo.touched),e.R7$(),e.Y8G("control",o.form.controls.numero_compras),e.R7$(),e.Y8G("ngIf",o.form.controls.numero_compras.errors&&o.form.controls.numero_compras.touched),e.R7$(),e.Y8G("control",o.form.controls.porcentaje),e.R7$(),e.Y8G("ngIf",o.form.controls.porcentaje.errors&&o.form.controls.porcentaje.touched),e.R7$(),e.Y8G("disabled",o.form.invalid),e.R7$(),e.SpI(" ",o.cupon?"Actualizar cup\xf3n":"Agregar cup\xf3n"," "))},dependencies:[s.bT,c.Jm,c.W9,c.iq,l.qT,l.cb,l.j4,f.l,m.H]}),a})();function x(t,a){if(1&t){const r=e.RV6();e.j41(0,"ion-input",27),e.mxI("ngModelChange",function(o){e.eBV(r);const i=e.XpG(2).$implicit,d=e.XpG().$implicit;return e.DH7(d[i.key],o)||(d[i.key]=o),e.Njj(o)}),e.bIt("keyup.enter",function(){e.eBV(r);const o=e.XpG(4);return e.Njj(o.finishEditing())})("blur",function(){e.eBV(r);const o=e.XpG(4);return e.Njj(o.finishEditing())}),e.k0s()}if(2&t){const r=e.XpG(2).$implicit,n=e.XpG().$implicit;e.R50("ngModel",n[r.key])}}function R(t,a){if(1&t&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&t){const r=e.XpG(2).$implicit,n=e.XpG().$implicit;e.R7$(),e.SpI(" ",n[r.key]," ")}}function O(t,a){if(1&t&&(e.j41(0,"ion-col",24),e.DNE(1,x,1,1,"ion-input",25)(2,R,2,1,"span",26),e.k0s()),2&t){const r=e.XpG().$implicit,n=e.XpG().$implicit,o=e.XpG();e.R7$(),e.Y8G("ngIf",o.editingFieldKey===r.key&&o.editingField===n),e.R7$(),e.Y8G("ngIf",!(o.editingFieldKey===r.key&&o.editingField===n))}}function A(t,a){if(1&t&&(e.qex(0),e.DNE(1,O,3,2,"ion-col",23),e.bVm()),2&t){const r=a.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngIf",n.shouldShowField(r.key))}}function $(t,a){if(1&t){const r=e.RV6();e.j41(0,"ion-row",17),e.DNE(1,A,2,1,"ng-container",18),e.j41(2,"ion-col")(3,"ion-button",19),e.bIt("click",function(){const o=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.editItem(o))}),e.nrm(4,"ion-icon",20),e.k0s(),e.j41(5,"ion-button",21),e.bIt("click",function(){const o=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.deleteItem(o))}),e.nrm(6,"ion-icon",22),e.k0s()()()}if(2&t){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.fields)}}const S=[{path:"",component:(()=>{var t;class a{constructor(n,o,i,d,v){this.modalCtrl=n,this.formBuilder=o,this.cdr=i,this.firebaseService=d,this.alertController=v,this.data=[],this.isModalOpen=!1,this.filteredData=[...this.data],this.editingField=null,this.editingFieldKey="",this.searchTerm="",this.utilsSvc=(0,e.WQX)(p.T),this.areColumnsVisible=!1,this.paginatedData=[],this.currentPage=1,this.itemsPerPage=10,this.totalPages=0,this.showDescripcion=!1,this.showPorcentaje=!1,this.showNumeroCompras=!1,this.showCodigo=!1,this.firebaseSvc=(0,e.WQX)(P.f),this.fields=[{key:"descripcion",label:"Descripcion"},{key:"numero_compras",label:"N\xfamero de compras minimas"},{key:"porcentaje",label:"Porcentaje"},{key:"codigo",label:"Cod\xedgo"}],this.setPage(1),this.cuponForm=this.formBuilder.group({uid:[""],descripcion:[""],numero_compras:[""],porcentaje:[""],codigo:[""]})}ngOnInit(){this.getCupones()}doRefresh(n){setTimeout(()=>{n.target.complete()},1e3)}filterItems(n){const o=n.target.value.toLowerCase();this.paginatedData=this.data.filter(i=>Object.values(i).some(d=>d.toString().toLowerCase().includes(o))),this.cdr.detectChanges()}sortTable(n){this.paginatedData.sort((o,i)=>o[n]<i[n]?-1:o[n]>i[n]?1:0),this.cdr.detectChanges()}editField(n,o){this.editingField=n,this.editingFieldKey=o}finishEditing(){this.editingField=null,this.editingFieldKey=null}deleteItem(n){this.presentConfirmDeleteAlert(n)}presentConfirmDeleteAlert(n){var o=this;return(0,_.A)(function*(){yield(yield o.alertController.create({header:"Confirmaci\xf3n",message:`\xbfEst\xe1s seguro de que deseas eliminar el ${n.descripcion}?`,buttons:[{text:"Cancelar",role:"cancel",handler:()=>{o.utilsSvc.presentToast({message:"Eliminaci\xf3n cancelada.",duration:1500,color:"warning",position:"middle",icon:"alert-circle-outline"})}},{text:"Eliminar",role:"destructive",handler:()=>{o.confirmDeleteItem(n)}}]})).present()})()}confirmDeleteItem(n){const o=this.data.findIndex(i=>i.uid===n.uid);o>-1?(this.data.splice(o,1),this.paginatedData=[...this.data],this.setPage(1),this.cdr.detectChanges(),this.firebaseSvc.deleteDocumet(`cupones/${n.uid}`).then(()=>{this.utilsSvc.presentToast({message:"Cup\xf3n eliminado exitosamente.",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),console.log("Documento eliminado de Firestore")}).catch(d=>{this.utilsSvc.presentToast({message:"Error al eliminar el cup\xf3n.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"}),console.error("Error al eliminar el documento: ",d)})):this.utilsSvc.presentToast({message:"Cup\xf3n no encontrado en la lista.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}editItem(n){var o=this;return(0,_.A)(function*(){try{const i=yield o.modalCtrl.create({component:k,componentProps:{cupon:n}});i.onDidDismiss().then(d=>{d.data&&o.getCupones()}),yield i.present()}catch(i){console.error("Error al editar el cup\xf3n:",i)}})()}openAddCuponModal(){var n=this;return(0,_.A)(function*(){const o=yield n.modalCtrl.create({component:k,componentProps:{cuponForm:n.cuponForm}});return o.onDidDismiss().then(i=>{i.data&&(n.paginatedData=[...n.data],n.cdr.detectChanges())}),yield o.present()})()}closeModal(){this.modalCtrl.dismiss()}submitProduct(){this.cuponForm.valid&&(this.paginatedData=[...this.data],this.cuponForm.reset(),this.closeModal(),this.cdr.detectChanges())}addProduct(){this.cuponForm.valid&&(this.paginatedData=[...this.data],this.cuponForm.reset(),this.closeModal(),this.cdr.detectChanges())}setPage(n){this.currentPage=n;const o=(n-1)*this.itemsPerPage;this.paginatedData=this.data.slice(o,o+this.itemsPerPage),this.totalPages=Math.ceil(this.data.length/this.itemsPerPage)}previousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}toggleColumns(){this.showDescripcion=!this.showDescripcion,this.showNumeroCompras=!this.showNumeroCompras,this.showPorcentaje=!this.showPorcentaje,this.showCodigo=!this.showCodigo,this.areColumnsVisible=!this.areColumnsVisible}shouldShowField(n){return!0}getCupones(){this.firebaseService.obtenerColeccion("cupones").subscribe(n=>{this.data=n.map(o=>({uid:o.uid,descripcion:o.descripcion,numero_compras:o.numero_compras,porcentaje:o.porcentaje,codigo:o.codigo})),this.paginatedData=[...this.data],this.setPage(1)})}}return(t=a).\u0275fac=function(n){return new(n||t)(e.rXU(c.W3),e.rXU(l.ok),e.rXU(e.gRc),e.rXU(P.f),e.rXU(c.hG))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-cupones"]],decls:38,vars:7,consts:[["title","Administraci\xf3n de cupones",3,"showMenu"],[1,"ion-padding-top","ion-text-center"],["slot","fixed",3,"ionRefresh"],["size","8"],["placeholder","Buscar cupones...",3,"ngModelChange","ionInput","ngModel"],["size","4",1,"ion-text-right"],["color","success",3,"click"],["name","add-circle-outline"],[1,"table-header"],[1,"header-row"],[3,"click"],["class","data-row",4,"ngFor","ngForOf"],[1,"pagination"],["color","light","expand","full",1,"pagination-button",3,"click","disabled"],["slot","start","name","arrow-back"],[1,"pagination-info"],["slot","end","name","arrow-forward"],[1,"data-row"],[4,"ngFor","ngForOf"],["color","warning",3,"click"],["name","create"],["color","danger",3,"click"],["name","trash"],["class","pointer-on",4,"ngIf"],[1,"pointer-on"],["class","cololetra",3,"ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[4,"ngIf"],[1,"cololetra",3,"ngModelChange","keyup.enter","blur","ngModel"]],template:function(n,o){1&n&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"ion-refresher",2),e.bIt("ionRefresh",function(d){return o.doRefresh(d)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"h2"),e.EFF(5,"Administraci\xf3n de cupones"),e.k0s(),e.j41(6,"ion-grid")(7,"ion-row")(8,"ion-col",3)(9,"ion-searchbar",4),e.mxI("ngModelChange",function(d){return e.DH7(o.searchTerm,d)||(o.searchTerm=d),d}),e.bIt("ionInput",function(d){return o.filterItems(d)}),e.k0s()(),e.j41(10,"ion-col",5)(11,"ion-button",6),e.bIt("click",function(){return o.openAddCuponModal()}),e.nrm(12,"ion-icon",7),e.EFF(13," Agregar cup\xf3n "),e.k0s()()()(),e.j41(14,"div",8),e.nrm(15,"h2"),e.k0s(),e.j41(16,"ion-grid")(17,"ion-row",9)(18,"ion-col",10),e.bIt("click",function(){return o.sortTable("descripcion")}),e.EFF(19,"Descripci\xf3n"),e.k0s(),e.j41(20,"ion-col",10),e.bIt("click",function(){return o.sortTable("numero_compras")}),e.EFF(21,"N\xfamero de compras minimas"),e.k0s(),e.j41(22,"ion-col",10),e.bIt("click",function(){return o.sortTable("porcentaje")}),e.EFF(23,"Descuento"),e.k0s(),e.j41(24,"ion-col",10),e.bIt("click",function(){return o.sortTable("codigo")}),e.EFF(25,"Cod\xedgo"),e.k0s(),e.j41(26,"ion-col"),e.EFF(27,"Acciones"),e.k0s()(),e.DNE(28,$,7,1,"ion-row",11),e.k0s(),e.j41(29,"div",12)(30,"ion-button",13),e.bIt("click",function(){return o.previousPage()}),e.nrm(31,"ion-icon",14),e.EFF(32," Anterior "),e.k0s(),e.j41(33,"span",15),e.EFF(34),e.k0s(),e.j41(35,"ion-button",13),e.bIt("click",function(){return o.nextPage()}),e.EFF(36," Siguiente "),e.nrm(37,"ion-icon",16),e.k0s()()()),2&n&&(e.Y8G("showMenu",!0),e.R7$(9),e.R50("ngModel",o.searchTerm),e.R7$(19),e.Y8G("ngForOf",o.paginatedData),e.R7$(2),e.Y8G("disabled",1===o.currentPage),e.R7$(4),e.Lme("P\xe1gina ",o.currentPage," de ",o.totalPages,""),e.R7$(),e.Y8G("disabled",o.currentPage===o.totalPages))},dependencies:[s.Sq,s.bT,l.BC,l.vS,c.Jm,c.hU,c.W9,c.lO,c.iq,c.$w,c.To,c.Ki,c.ln,c.S1,c.Gw,f.l],styles:['@charset "UTF-8";ion-grid[_ngcontent-%COMP%]{border-radius:15px;overflow:hidden;margin-top:20px;padding-left:3rem;padding-right:3rem}.header-row[_ngcontent-%COMP%]{background-color:#1ad436;color:#fff;font-weight:700;text-align:center;border-top-left-radius:15px;border-top-right-radius:15px;cursor:pointer}.data-row[_ngcontent-%COMP%]{background-color:#f9f9f9;border-bottom:1px solid #1ad436;text-align:center}.data-row[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:15px;border-bottom-right-radius:15px}ion-col[_ngcontent-%COMP%]{padding:10px}ion-button[_ngcontent-%COMP%]{margin-top:10px}ion-searchbar[_ngcontent-%COMP%]{margin-top:10px}.cololetra[_ngcontent-%COMP%]{background-color:#d4fcd8;border-radius:5px;padding:8px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;margin-bottom:3rem;flex-wrap:wrap}.pagination-button[_ngcontent-%COMP%]{margin:0 5px;flex:1;max-width:150px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;margin-right:4rem}.toggle-columns-button[_ngcontent-%COMP%]{font-size:14px;padding:0}.toggle-columns-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}@media (max-width: 768px){ion-grid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}ion-col[_ngcontent-%COMP%]{font-size:12px;padding:5px}.header-row[_ngcontent-%COMP%]{font-size:14px}.data-row[_ngcontent-%COMP%]{font-size:12px}ion-searchbar[_ngcontent-%COMP%]{width:100%}.pagination[_ngcontent-%COMP%]{flex-direction:column}}@media (max-width: 480px){.header-row[_ngcontent-%COMP%], .data-row[_ngcontent-%COMP%]{font-size:10px}ion-button[_ngcontent-%COMP%]{font-size:10px;padding:5px}ion-searchbar[_ngcontent-%COMP%]{width:100%;margin-top:5px}}']}),a})()}];let U=(()=>{var t;class a{}return(t=a).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[C.iI.forChild(S),C.iI]}),a})();var X=u(7383);let Y=(()=>{var t;class a{}return(t=a).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[s.MD,l.YN,c.bv,U,X.G]}),a})()},8827:(y,b,u)=>{u.d(b,{H:()=>P});var s=u(4438),l=u(177),c=u(5933),C=u(9417);function _(p,f){if(1&p&&s.nrm(0,"ion-icon",4),2&p){const m=s.XpG();s.Y8G("name",m.icon)}}function e(p,f){if(1&p){const m=s.RV6();s.j41(0,"ion-button",5),s.bIt("click",function(){s.eBV(m);const g=s.XpG();return s.Njj(g.showOrHidePassword())}),s.nrm(1,"ion-icon",6),s.k0s()}if(2&p){const m=s.XpG();s.R7$(),s.Y8G("name",m.hide?"eye-outline":"eye-off-outline")}}let P=(()=>{var p;class f{constructor(){this.hide=!0}ngOnInit(){"password"==this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(p=f).\u0275fac=function(h){return new(h||p)},p.\u0275cmp=s.VBU({type:p,selectors:[["app-custom-input"]],inputs:{control:"control",type:"type",label:"label",autocomplete:"autocomplete",icon:"icon"},decls:4,vars:6,consts:[["lines","none",1,"custom-input"],["color","primary","slot","start",3,"name",4,"ngIf"],["label-placement","floating",3,"type","autocomplete","label","formControl"],["slot","end","fill","clear","shape","round",3,"click",4,"ngIf"],["color","primary","slot","start",3,"name"],["slot","end","fill","clear","shape","round",3,"click"],["slot","icon-only",3,"name"]],template:function(h,g){1&h&&(s.j41(0,"ion-item",0),s.DNE(1,_,1,1,"ion-icon",1),s.nrm(2,"ion-input",2),s.DNE(3,e,2,1,"ion-button",3),s.k0s()),2&h&&(s.R7$(),s.Y8G("ngIf",g.icon),s.R7$(),s.Y8G("type",g.type)("autocomplete",g.autocomplete)("label",g.label)("formControl",g.control),s.R7$(),s.Y8G("ngIf",g.isPassword))},dependencies:[l.bT,c.Jm,c.iq,c.$w,c.uz,c.Gw,C.BC,C.l_]}),f})()}}]);