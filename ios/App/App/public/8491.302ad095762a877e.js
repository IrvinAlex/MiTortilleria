"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8491],{8491:(S,w,u)=>{u.r(w),u.d(w,{InventarioPageModule:()=>it});var l=u(177),a=u(9417),c=u(5933),T=u(8265),I=u(467),t=u(4438),F=u(6697),p=u(7517),C=u(2723),_=u(8461),y=u(8827);function P(o,s){if(1&o&&(t.j41(0,"ion-select-option",8),t.EFF(1),t.k0s()),2&o){const r=s.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r," ")}}function D(o,s){1&o&&(t.j41(0,"div"),t.EFF(1," Este campo es requerido "),t.k0s())}function $(o,s){1&o&&(t.j41(0,"div"),t.EFF(1," La cantidad m\xednima debe ser 0"),t.k0s())}function j(o,s){if(1&o&&(t.j41(0,"div",9),t.DNE(1,D,2,0,"div",10)(2,$,2,0,"div",10),t.k0s()),2&o){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.form.controls.soldUnits.errors?null:r.form.controls.soldUnits.errors.required),t.R7$(),t.Y8G("ngIf",null==r.form.controls.soldUnits.errors?null:r.form.controls.soldUnits.errors.min)}}let A=(()=>{var o;class s{constructor(){this.dataSelect=[],this.form=new a.gE({id:new a.MJ(""),name:new a.MJ("",[a.k0.required]),soldUnits:new a.MJ(null,[a.k0.required,a.k0.min(0)])}),this.firebaseSvc=(0,t.WQX)(p.f),this.utilSvc=(0,t.WQX)(C.T)}ngOnInit(){this.user=this.utilSvc.getFromLocalStorage("user"),this.getInventario()}submit(){this.form.valid&&this.updateProduct()}setNumberInputs(){let{soldUnits:e}=this.form.controls;e.value&&e.setValue(parseFloat(e.value))}createProduct(){var e=this;return(0,I.A)(function*(){let n=`users/${e.user.uid}/products`;const i=yield e.utilSvc.loading();yield i.present(),delete e.form.value.id,e.firebaseSvc.addDocument(n,e.form.value).then(function(){var d=(0,I.A)(function*(m){e.utilSvc.dismissModal({success:!0}),e.utilSvc.presentToast({message:"Producto creado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(m){return d.apply(this,arguments)}}()).catch(d=>{e.utilSvc.presentToast({message:d.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{i.dismiss()})})()}updateProduct(){var e=this;return(0,I.A)(function*(){const{name:n,soldUnits:i}=e.form.value,d="inventario_bodega",m=yield e.utilSvc.loading();yield m.present(),e.firebaseSvc.getCollectionData(d,[]).pipe((0,F.s)(1)).subscribe(h=>{const g=h.find(k=>{var f;return(null===(f=k.name)||void 0===f?void 0:f.toLowerCase().trim())===(null==n?void 0:n.toLowerCase().trim())});g?e.firebaseSvc.updateDocumet(`${d}/${g.id}`,{stock:g.stock+i}).then(()=>{e.utilSvc.presentToast({message:`El inventario de ${n} se actualiz\xf3 exitosamente`,duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),e.utilSvc.dismissModal({success:!0})}).catch(f=>{e.utilSvc.presentToast({message:f.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>m.dismiss()):(e.utilSvc.presentToast({message:`Producto ${n} no encontrado`,duration:2500,color:"warning",position:"middle",icon:"alert-circle-outline"}),m.dismiss())})})()}getInventario(){this.firebaseSvc.getCollectionData("inventario_bodega",[]).subscribe(n=>{this.dataSelect=n.map(i=>i.name)})}}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-add-update-inventario"]],inputs:{user:"user"},decls:11,vars:9,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],["justify","space-between","label","Nombre del producto","fill","outline","placeholder","Selecciona el producto",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["type","number","label","Cantidad de bultos(50kg/unidad)",3,"ionInput","control"],["class","validators",4,"ngIf"],["type","submit",1,"ion-margin","submit",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[3,"value"],[1,"validators"],[4,"ngIf"]],template:function(e,n){1&e&&(t.j41(0,"app-header",0),t.EFF(1,"Agregar productos"),t.k0s(),t.j41(2,"ion-content")(3,"form",1),t.bIt("ngSubmit",function(){return n.submit()})("keypress.enter",function(){return n.submit()}),t.j41(4,"ion-select",2),t.DNE(5,P,2,2,"ion-select-option",3),t.k0s(),t.j41(6,"app-custom-input",4),t.bIt("ionInput",function(){return n.setNumberInputs()}),t.k0s(),t.DNE(7,j,3,2,"div",5),t.j41(8,"ion-button",6),t.EFF(9),t.nrm(10,"ion-icon",7),t.k0s()()()),2&e&&(t.Y8G("isModal",!0)("title","Agregar producto"),t.R7$(3),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("formControl",n.form.controls.name),t.R7$(),t.Y8G("ngForOf",n.dataSelect),t.R7$(),t.Y8G("control",n.form.controls.soldUnits),t.R7$(),t.Y8G("ngIf",n.form.controls.soldUnits.errors&&n.form.controls.soldUnits.touched),t.R7$(),t.Y8G("disabled",n.form.invalid),t.R7$(),t.SpI(" ","Agregar producto"," "))},dependencies:[l.Sq,l.bT,c.Jm,c.W9,c.iq,c.Nm,c.Ip,c.Je,a.qT,a.BC,a.cb,a.l_,a.j4,_.l,y.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),s})();var U=u(9834);function R(o,s){1&o&&(t.j41(0,"div"),t.EFF(1," Este campo es requerido "),t.k0s())}function x(o,s){if(1&o&&(t.j41(0,"div",7),t.DNE(1,R,2,0,"div",8),t.k0s()),2&o){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.form.controls.name.errors?null:r.form.controls.name.errors.required)}}function O(o,s){1&o&&(t.j41(0,"div"),t.EFF(1," Este campo es requerido "),t.k0s())}function Y(o,s){1&o&&(t.j41(0,"div"),t.EFF(1," La cantidad m\xednima debe ser 0"),t.k0s())}function z(o,s){if(1&o&&(t.j41(0,"div",7),t.DNE(1,O,2,0,"div",8)(2,Y,2,0,"div",8),t.k0s()),2&o){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.form.controls.soldUnits.errors?null:r.form.controls.soldUnits.errors.required),t.R7$(),t.Y8G("ngIf",null==r.form.controls.soldUnits.errors?null:r.form.controls.soldUnits.errors.min)}}let N=(()=>{var o;class s{constructor(){this.dataSelect=[],this.form=new a.gE({id:new a.MJ(""),name:new a.MJ("",[a.k0.required]),soldUnits:new a.MJ(null,[a.k0.required,a.k0.min(0)])}),this.firebaseSvc=(0,t.WQX)(p.f),this.utilSvc=(0,t.WQX)(C.T)}ngOnInit(){this.user=this.utilSvc.getFromLocalStorage("user"),this.getInventario(),this.getProduct(this.nombre)}submit(){this.nombre&&this.updateProduct()}setNumberInputs(){let{soldUnits:e}=this.form.controls;e.value&&e.setValue(parseFloat(e.value))}updateProduct(){var e=this;return(0,I.A)(function*(){const{name:n,soldUnits:i}=e.form.value,d="inventario_bodega",m=e.nombre,h=yield e.utilSvc.loading();yield h.present(),e.firebaseSvc.getCollectionData(d,[]).pipe((0,F.s)(1)).subscribe(g=>{const k=g.find(f=>{var M;return(null===(M=f.name)||void 0===M?void 0:M.toLowerCase().trim())===(null==m?void 0:m.toLowerCase().trim())});if(k){const f={};n&&(f.name=n),null!=i&&(f.stock=i),e.firebaseSvc.updateDocumet(`${d}/${k.id}`,f).then(()=>{e.utilSvc.presentToast({message:`El inventario de ${k.name} se actualiz\xf3 exitosamente`,duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),e.utilSvc.dismissModal({success:!0})}).catch(M=>{e.utilSvc.presentToast({message:M.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>h.dismiss())}else e.utilSvc.presentToast({message:`Producto ${m} no encontrado`,duration:2500,color:"warning",position:"middle",icon:"alert-circle-outline"}),h.dismiss()})})()}getInventario(){this.firebaseSvc.getCollectionData("inventario_bodega",[]).subscribe(n=>{this.dataSelect=n.map(i=>i.name)})}getProduct(e){this.utilSvc.loading().then(i=>{i.present(),this.firebaseSvc.getCollectionData("inventario_bodega",[]).pipe((0,F.s)(1)).subscribe({next:d=>{const m=d.find(h=>{var g;return(null===(g=h.name)||void 0===g?void 0:g.toLowerCase().trim())===(null==e?void 0:e.toLowerCase().trim())});m?this.form.patchValue({id:m.id||"",name:m.name||"",soldUnits:m.stock||0}):this.utilSvc.presentToast({message:`Producto ${e} no encontrado`,duration:2500,color:"warning",position:"middle",icon:"alert-circle-outline"})},error:d=>{this.utilSvc.presentToast({message:"Error al obtener el producto",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})},complete:()=>i.dismiss()})})}}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-update-inventario"]],inputs:{user:"user",nombre:"nombre"},decls:11,vars:9,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],["autocomplete","nombre","type","text","label","Nombre del insumo",3,"control"],["class","validators",4,"ngIf"],["type","number","label","Cantidad en almacen",3,"ionInput","control"],["type","submit",1,"ion-margin","submit",3,"disabled"],["slot","end","name","create-outline"],[1,"validators"],[4,"ngIf"]],template:function(e,n){1&e&&(t.j41(0,"app-header",0),t.EFF(1,"Editar producto"),t.k0s(),t.j41(2,"ion-content")(3,"form",1),t.bIt("ngSubmit",function(){return n.submit()})("keypress.enter",function(){return n.submit()}),t.nrm(4,"app-custom-input",2),t.DNE(5,x,2,1,"div",3),t.j41(6,"app-custom-input",4),t.bIt("ionInput",function(){return n.setNumberInputs()}),t.k0s(),t.DNE(7,z,3,2,"div",3),t.j41(8,"ion-button",5),t.EFF(9),t.nrm(10,"ion-icon",6),t.k0s()()()),2&e&&(t.Y8G("isModal",!0)("title","Editar producto"),t.R7$(3),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("control",n.form.controls.name),t.R7$(),t.Y8G("ngIf",n.form.controls.name.errors&&n.form.controls.name.touched),t.R7$(),t.Y8G("control",n.form.controls.soldUnits),t.R7$(),t.Y8G("ngIf",n.form.controls.soldUnits.errors&&n.form.controls.soldUnits.touched),t.R7$(),t.Y8G("disabled",n.form.invalid),t.R7$(),t.SpI(" ","Actualizar producto"," "))},dependencies:[l.bT,c.Jm,c.W9,c.iq,a.qT,a.cb,a.j4,_.l,y.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),s})();var G=u(2784);function X(o,s){1&o&&(t.j41(0,"div"),t.EFF(1,"Este campo es requerido"),t.k0s())}function L(o,s){1&o&&(t.j41(0,"div"),t.EFF(1,"La cantidad m\xednima debe ser 0"),t.k0s())}function B(o,s){if(1&o&&(t.j41(0,"div",8),t.DNE(1,X,2,0,"div",9)(2,L,2,0,"div",9),t.k0s()),2&o){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.form.controls.cal.errors?null:r.form.controls.cal.errors.required),t.R7$(),t.Y8G("ngIf",null==r.form.controls.cal.errors?null:r.form.controls.cal.errors.min)}}function W(o,s){1&o&&(t.j41(0,"div"),t.EFF(1,"Este campo es requerido"),t.k0s())}function V(o,s){1&o&&(t.j41(0,"div"),t.EFF(1,"La cantidad m\xednima debe ser 0"),t.k0s())}function q(o,s){if(1&o&&(t.j41(0,"div",8),t.DNE(1,W,2,0,"div",9)(2,V,2,0,"div",9),t.k0s()),2&o){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.form.controls.maiz.errors?null:r.form.controls.maiz.errors.required),t.R7$(),t.Y8G("ngIf",null==r.form.controls.maiz.errors?null:r.form.controls.maiz.errors.min)}}let J=(()=>{var o;class s{constructor(){this.dataSelect=[],this.form=new a.gE({id:new a.MJ(""),cal:new a.MJ(0,[a.k0.required,a.k0.min(0)]),maiz:new a.MJ(0,[a.k0.required,a.k0.min(0)])}),this.firebaseSvc=(0,t.WQX)(p.f),this.utilSvc=(0,t.WQX)(C.T)}ngOnInit(){this.user=this.utilSvc.getFromLocalStorage("user"),this.getInventario()}submit(){this.form.valid&&this.updateProduct()}updateProduct(){var e=this;return(0,I.A)(function*(){const{cal:n,maiz:i}=e.form.value,d="inventario_bodega",m="registro_asignacion",h=G.Dc.now(),g=yield e.utilSvc.loading();yield g.present(),e.firebaseSvc.getCollectionData(d,[]).pipe((0,F.s)(1)).subscribe(k=>{const f=k.find(v=>{var b;return"cal"===(null===(b=v.name)||void 0===b?void 0:b.toLowerCase().trim())}),M=k.find(v=>{var b;return"ma\xedz"===(null===(b=v.name)||void 0===b?void 0:b.toLowerCase().trim())});if(f&&n>0){const v=f.stock-n;v>=0&&(e.firebaseSvc.updateDocumet(`${d}/${f.id}`,{stock:v}).then(()=>{e.utilSvc.presentToast({message:"El inventario de cal se actualiz\xf3 exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),e.firebaseSvc.addDocument(m,{producto:"cal",cantidadAsignada:n,fechaAsignacion:h,usuario:e.user.name})}).catch(b=>{e.utilSvc.presentToast({message:b.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}),v<20&&e.utilSvc.presentToast({message:"\xa1Alerta! El stock de cal es inferior a 20 costales. Necesitas abastecerte.",duration:3e3,color:"danger",position:"bottom",icon:"alert-circle-outline"}))}if(M&&i>0){const v=M.stock-i;v>=0&&(e.firebaseSvc.updateDocumet(`${d}/${M.id}`,{stock:v}).then(()=>{e.utilSvc.presentToast({message:"El inventario de ma\xedz se actualiz\xf3 exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),e.firebaseSvc.addDocument(m,{producto:"ma\xedz",cantidadAsignada:i,fechaAsignacion:h,usuario:e.user.name})}).catch(b=>{e.utilSvc.presentToast({message:b.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}),v<20&&e.utilSvc.presentToast({message:"\xa1Alerta! El stock de ma\xedz es inferior a 20 costales. Necesitas abastecerte.",duration:3e3,color:"danger",position:"bottom",icon:"alert-circle-outline"}))}g.dismiss(),e.utilSvc.dismissModal({success:!0})})})()}getInventario(){this.firebaseSvc.getCollectionData("inventario_bodega",[]).subscribe(n=>{this.dataSelect=n.map(i=>i.name)})}}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-asignar-producto"]],inputs:{user:"user"},decls:12,vars:8,consts:[[3,"isModal","title"],[1,"ion-text-center"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],["type","number","label","Cantidad de costales de cal (50kg/unidad)",3,"control"],["class","validators",4,"ngIf"],["type","number","label","Cantidad de costales de ma\xedz (50kg/unidad)",3,"control"],["type","submit",1,"ion-margin","submit",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[1,"validators"],[4,"ngIf"]],template:function(e,n){1&e&&(t.nrm(0,"app-header",0),t.j41(1,"ion-content")(2,"h4",1),t.EFF(3,"Asignaci\xf3n de insumos para el d\xeda de hoy"),t.k0s(),t.j41(4,"form",2),t.bIt("ngSubmit",function(){return n.submit()})("keypress.enter",function(){return n.submit()}),t.nrm(5,"app-custom-input",3),t.DNE(6,B,3,2,"div",4),t.nrm(7,"app-custom-input",5),t.DNE(8,q,3,2,"div",4),t.j41(9,"ion-button",6),t.EFF(10," Asignar insumos "),t.nrm(11,"ion-icon",7),t.k0s()()()),2&e&&(t.Y8G("isModal",!0)("title","Asignar insumos del d\xeda"),t.R7$(4),t.Y8G("formGroup",n.form),t.R7$(),t.Y8G("control",n.form.controls.cal),t.R7$(),t.Y8G("ngIf",n.form.controls.cal.errors&&n.form.controls.cal.touched),t.R7$(),t.Y8G("control",n.form.controls.maiz),t.R7$(),t.Y8G("ngIf",n.form.controls.maiz.errors&&n.form.controls.maiz.touched),t.R7$(),t.Y8G("disabled",n.form.invalid))},dependencies:[l.bT,c.Jm,c.W9,c.iq,a.qT,a.cb,a.j4,_.l,y.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}.custom-toast[_ngcontent-%COMP%]{margin-bottom:10px}"]}),s})();var E=u(3703);function H(o,s){if(1&o){const r=t.RV6();t.j41(0,"ion-input",35),t.mxI("ngModelChange",function(n){t.eBV(r);const i=t.XpG(2).$implicit,d=t.XpG().$implicit;return t.DH7(d[i.key],n)||(d[i.key]=n),t.Njj(n)}),t.bIt("keyup.enter",function(){t.eBV(r);const n=t.XpG(4);return t.Njj(n.finishEditing())})("blur",function(){t.eBV(r);const n=t.XpG(4);return t.Njj(n.finishEditing())}),t.k0s()}if(2&o){const r=t.XpG(2).$implicit,e=t.XpG().$implicit;t.R50("ngModel",e[r.key])}}function K(o,s){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&o){const r=t.XpG(2).$implicit,e=t.XpG().$implicit;t.R7$(),t.SpI(" ",e[r.key]," ")}}function Q(o,s){if(1&o&&(t.j41(0,"ion-col",29),t.DNE(1,H,1,1,"ion-input",33)(2,K,2,1,"span",34),t.k0s()),2&o){const r=t.XpG().$implicit,e=t.XpG().$implicit,n=t.XpG();t.R7$(),t.Y8G("ngIf",n.editingFieldKey===r.key&&n.editingField===e),t.R7$(),t.Y8G("ngIf",!(n.editingFieldKey===r.key&&n.editingField===e))}}function Z(o,s){if(1&o&&(t.qex(0),t.DNE(1,Q,3,2,"ion-col",32),t.bVm()),2&o){const r=s.$implicit,e=t.XpG(2);t.R7$(),t.Y8G("ngIf",e.shouldShowField(r.key)&&"image"!==r.key)}}function tt(o,s){if(1&o){const r=t.RV6();t.j41(0,"ion-row",25),t.DNE(1,Z,2,1,"ng-container",26),t.j41(2,"ion-col",27),t.nrm(3,"ion-img",28),t.k0s(),t.j41(4,"ion-col",29)(5,"ion-button",30),t.bIt("click",function(){const n=t.eBV(r).$implicit,i=t.XpG();return t.Njj(i.openUpdateInventarioModal(n.nombre))}),t.nrm(6,"ion-icon",31),t.k0s()()()}if(2&o){const r=s.$implicit,e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.fields),t.R7$(2),t.Y8G("src",r.image)}}const et=[{path:"",component:(()=>{var o;class s{constructor(e,n,i){this.modalCtrl=e,this.formBuilder=n,this.cdr=i,this.data=[],this.dataGraficaLabels=[],this.dataGrafica=[],this.dataSelect=[],this.form=new a.gE({id:new a.MJ(""),name:new a.MJ("",[a.k0.required]),soldUnits:new a.MJ(null,[a.k0.required,a.k0.min(0)])}),this.isModalOpen=!1,this.filteredData=[...this.data],this.editingField=null,this.editingFieldKey="",this.searchTerm="",this.utilsSvc=(0,t.WQX)(C.T),this.areColumnsVisible=!1,this.isAsignarDisabled=!1,this.paginatedData=[],this.currentPage=1,this.itemsPerPage=10,this.totalPages=0,this.showStock=!1,this.showNombre=!1,this.showImagen=!1,this.firebaseSvc=(0,t.WQX)(p.f),this.utilSvc=(0,t.WQX)(C.T),this.fields=[{key:"nombre",label:"Nombre"},{key:"stock",label:"Stock"},{key:"image",label:"Imagen"}],this.setPage(1),this.inventarioForm=this.formBuilder.group({nombre:[""],stock:[""],imagen:[""]})}ngOnInit(){this.getDataGrafica(),this.getUsers(),this.getRegistroHoy()}doRefresh(e){setTimeout(()=>{e.target.complete()},1e3)}filterItems(e){const n=e.target.value.toLowerCase();this.paginatedData=this.data.filter(i=>Object.values(i).some(d=>d.toString().toLowerCase().includes(n))),this.cdr.detectChanges()}sortTable(e){this.paginatedData.sort((n,i)=>n[e]<i[e]?-1:n[e]>i[e]?1:0),this.cdr.detectChanges()}editField(e,n){this.editingField=e,this.editingFieldKey=n}finishEditing(){this.editingField=null,this.editingFieldKey=null}deleteItem(e){const n=this.data.findIndex(i=>i.nombre===e);n>-1&&(this.data.splice(n,1),this.paginatedData=[...this.data],this.setPage(1),this.cdr.detectChanges())}openAddInventarioModal(){var e=this;return(0,I.A)(function*(){const n=yield e.modalCtrl.create({component:A,componentProps:{inventarioForm:e.inventarioForm}});return n.onDidDismiss().then(i=>{i.data&&(e.paginatedData=[...e.data],e.cdr.detectChanges(),e.getDataGrafica(),e.chart&&(e.chart.data.labels=e.dataGraficaLabels,e.chart.data.datasets[0].data=e.dataGrafica,e.chart.update()),e.getUsers())}),yield n.present()})()}openAsignarProductoModal(){var e=this;return(0,I.A)(function*(){const n=yield e.modalCtrl.create({component:J,componentProps:{inventarioForm:e.inventarioForm}});return n.onDidDismiss().then(i=>{i.data&&i.data.success&&(e.paginatedData=[...e.data],e.cdr.detectChanges(),e.getDataGrafica(),e.chart&&(e.chart.data.labels=e.dataGraficaLabels,e.chart.data.datasets[0].data=e.dataGrafica,e.chart.update()),e.getUsers())}),yield n.present()})()}openUpdateInventarioModal(e){var n=this;return(0,I.A)(function*(){const i=yield n.modalCtrl.create({component:N,componentProps:{inventarioForm:n.inventarioForm,nombre:e}});return i.onDidDismiss().then(d=>{d.data&&(n.paginatedData=[...n.data],n.cdr.detectChanges(),n.getDataGrafica(),n.chart&&(n.chart.data.labels=n.dataGraficaLabels,n.chart.data.datasets[0].data=n.dataGrafica,n.chart.update()),n.getUsers())}),yield i.present()})()}closeModal(){this.modalCtrl.dismiss()}setPage(e){this.currentPage=e;const n=(e-1)*this.itemsPerPage;this.paginatedData=this.data.slice(n,n+this.itemsPerPage),this.totalPages=Math.ceil(this.data.length/this.itemsPerPage)}previousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}toggleColumns(){this.showStock=!this.showStock,this.showNombre=!this.showNombre,this.showImagen=!this.showImagen,this.areColumnsVisible=!this.areColumnsVisible}shouldShowField(e){return!0}renderChartInventario(){const e=document.getElementById("ChartInventario");this.chart=new U.t1(e,{type:"bar",data:{labels:this.dataGraficaLabels,datasets:[{label:"Reporte diario",data:this.dataGrafica,backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{callback:function(n){return n+" Toneladas"}}},x:{beginAtZero:!0}}}})}getUsers(){this.firebaseSvc.getCollectionData("inventario_bodega",[]).subscribe(n=>{this.data=n.map(i=>({id:i.id,nombre:i.name,stock:50*i.stock/1e3,image:i.image})),this.paginatedData=[...this.data],this.setPage(1)})}getDataGrafica(){this.firebaseSvc.getCollectionData("inventario_bodega",[]).subscribe(n=>{this.dataGraficaLabels=n.map(i=>i.name),this.dataGrafica=n.map(i=>50*i.stock/1e3),this.renderChartInventario()})}getRegistroHoy(){const e=new Date,n=new Date(e.setHours(0,0,0,0)),i=new Date(e.setHours(23,59,59,999)),d=G.Dc.fromDate(n),m=G.Dc.fromDate(i),h=[(0,E._M)("fechaAsignacion",">=",d),(0,E._M)("fechaAsignacion","<=",m)];this.firebaseSvc.getCollectionData("registro_asignacion",h).subscribe({next:g=>{this.isAsignarDisabled=g.length>0,console.log(this.isAsignarDisabled?"El bot\xf3n est\xe1 deshabilitado porque hay registros hoy.":"El bot\xf3n est\xe1 habilitado porque no hay registros hoy.")},error:g=>{console.error("Error obteniendo registros:",g),this.isAsignarDisabled=!1}})}}return(o=s).\u0275fac=function(e){return new(e||o)(t.rXU(c.W3),t.rXU(a.ok),t.rXU(t.gRc))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-inventario"]],decls:53,vars:8,consts:[["title","Inventario",3,"showMenu"],[1,"ion-padding-top","ion-text-center"],["slot","fixed",3,"ionRefresh"],["size","8"],["placeholder","Buscar productos...",3,"ngModelChange","ionInput","ngModel"],["size","4",1,"ion-text-right"],["color","success",3,"click"],["name","add-circle-outline"],[1,"table-header"],[1,"header-row"],[3,"click"],["class","data-row",4,"ngFor","ngForOf"],[1,"pagination"],["color","light","expand","full",1,"pagination-button",3,"click","disabled"],["slot","start","name","arrow-back"],[1,"pagination-info"],["slot","end","name","arrow-forward"],[1,"chart"],[1,"tittle-today"],[1,"card-container-today"],["size","3",1,"ion-text-right"],["color","success",3,"click","disabled"],["name","play-forward-circle-outline",2,"margin-right","5px"],["size","12","size-md","7","size-lg","7"],["id","ChartInventario"],[1,"data-row"],[4,"ngFor","ngForOf"],[1,"pointer-on",2,"display","flex","justify-content","center","align-items","center"],[2,"width","50px","height","auto",3,"src"],[1,"pointer-on"],["color","warning",3,"click"],["name","create-outline"],["class","pointer-on",4,"ngIf"],["class","cololetra",3,"ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[4,"ngIf"],[1,"cololetra",3,"ngModelChange","keyup.enter","blur","ngModel"]],template:function(e,n){1&e&&(t.nrm(0,"app-header",0),t.j41(1,"ion-content",1)(2,"ion-refresher",2),t.bIt("ionRefresh",function(d){return n.doRefresh(d)}),t.nrm(3,"ion-refresher-content"),t.k0s(),t.j41(4,"h2"),t.EFF(5,"Administrar inventario"),t.k0s(),t.j41(6,"ion-grid")(7,"ion-row")(8,"ion-col",3)(9,"ion-searchbar",4),t.mxI("ngModelChange",function(d){return t.DH7(n.searchTerm,d)||(n.searchTerm=d),d}),t.bIt("ionInput",function(d){return n.filterItems(d)}),t.k0s()(),t.j41(10,"ion-col",5)(11,"ion-button",6),t.bIt("click",function(){return n.openAddInventarioModal()}),t.nrm(12,"ion-icon",7),t.EFF(13," Agregar Producto "),t.k0s()()()(),t.nrm(14,"div",8),t.j41(15,"ion-grid")(16,"ion-row",9)(17,"ion-col",10),t.bIt("click",function(){return n.sortTable("nombre")}),t.EFF(18,"Nombre"),t.k0s(),t.j41(19,"ion-col",10),t.bIt("click",function(){return n.sortTable("stock")}),t.EFF(20,"Cantidad (Toneladas)"),t.k0s(),t.j41(21,"ion-col",10),t.bIt("click",function(){return n.sortTable("costoUnidad")}),t.EFF(22,"Imagen"),t.k0s(),t.j41(23,"ion-col"),t.EFF(24,"Acciones"),t.k0s()(),t.DNE(25,tt,7,2,"ion-row",11),t.k0s(),t.j41(26,"div",12)(27,"ion-button",13),t.bIt("click",function(){return n.previousPage()}),t.nrm(28,"ion-icon",14),t.EFF(29," Anterior "),t.k0s(),t.j41(30,"span",15),t.EFF(31),t.k0s(),t.j41(32,"ion-button",13),t.bIt("click",function(){return n.nextPage()}),t.EFF(33," Siguiente "),t.nrm(34,"ion-icon",16),t.k0s()(),t.j41(35,"div",17)(36,"h1",18),t.EFF(37,"Inventario de bodega"),t.k0s(),t.j41(38,"div",19)(39,"ion-row")(40,"ion-col",20)(41,"ion-button",21),t.bIt("click",function(){return n.openAsignarProductoModal()}),t.nrm(42,"ion-icon",22),t.EFF(43," Asignar producto "),t.k0s()(),t.j41(44,"ion-col",23)(45,"ion-card")(46,"ion-card-header")(47,"ion-card-title"),t.EFF(48,"Cantidad disponible actual de ma\xedz y cal"),t.k0s(),t.j41(49,"ion-card-subtitle"),t.EFF(50,"Inventario en cantidad de kilogramos."),t.k0s()(),t.j41(51,"ion-card-content"),t.nrm(52,"canvas",24),t.k0s()()()()()()()),2&e&&(t.Y8G("showMenu",!0),t.R7$(9),t.R50("ngModel",n.searchTerm),t.R7$(16),t.Y8G("ngForOf",n.paginatedData),t.R7$(2),t.Y8G("disabled",1===n.currentPage),t.R7$(4),t.Lme("P\xe1gina ",n.currentPage," de ",n.totalPages,""),t.R7$(),t.Y8G("disabled",n.currentPage===n.totalPages),t.R7$(9),t.Y8G("disabled",n.isAsignarDisabled))},dependencies:[l.Sq,l.bT,a.BC,a.vS,c.Jm,c.b_,c.I9,c.ME,c.HW,c.tN,c.hU,c.W9,c.lO,c.iq,c.KW,c.$w,c.To,c.Ki,c.ln,c.S1,c.Gw,_.l],styles:['@charset "UTF-8";ion-grid[_ngcontent-%COMP%]{border-radius:15px;overflow:hidden;margin-top:20px;padding-left:3rem;padding-right:3rem}.header-row[_ngcontent-%COMP%]{background-color:#1ad436;color:#fff;font-weight:700;text-align:center;border-top-left-radius:15px;border-top-right-radius:15px;cursor:pointer}.data-row[_ngcontent-%COMP%]{background-color:#f9f9f9;border-bottom:1px solid #1ad436;text-align:center}.data-row[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:15px;border-bottom-right-radius:15px}ion-col[_ngcontent-%COMP%]{padding:10px}ion-button[_ngcontent-%COMP%]{margin-top:10px}ion-searchbar[_ngcontent-%COMP%]{margin-top:10px}.cololetra[_ngcontent-%COMP%]{background-color:#d4fcd8;border-radius:5px;padding:8px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;margin-bottom:3rem;flex-wrap:wrap}.pagination-button[_ngcontent-%COMP%]{margin:0 5px;flex:1;max-width:150px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;margin-right:4rem}.toggle-columns-button[_ngcontent-%COMP%]{font-size:14px;padding:0}.toggle-columns-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}@media (max-width: 768px){ion-grid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}ion-col[_ngcontent-%COMP%]{font-size:12px;padding:5px}.header-row[_ngcontent-%COMP%]{font-size:14px}.data-row[_ngcontent-%COMP%]{font-size:12px}ion-searchbar[_ngcontent-%COMP%]{width:100%}.pagination[_ngcontent-%COMP%]{flex-direction:column}}@media (max-width: 480px){.header-row[_ngcontent-%COMP%], .data-row[_ngcontent-%COMP%]{font-size:10px}ion-button[_ngcontent-%COMP%]{font-size:10px;padding:5px}ion-searchbar[_ngcontent-%COMP%]{width:100%;margin-top:5px}}ion-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}ion-card-header[_ngcontent-%COMP%], ion-card-content[_ngcontent-%COMP%]{flex-grow:1}.tittle-today[_ngcontent-%COMP%]{margin-top:4%}.chart[_ngcontent-%COMP%]{margin:2%}']}),s})()}];let nt=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[T.iI.forChild(et),T.iI]}),s})();var ot=u(7383);let it=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[l.MD,a.YN,c.bv,nt,ot.G]}),s})()},8827:(S,w,u)=>{u.d(w,{H:()=>F});var l=u(4438),a=u(177),c=u(5933),T=u(9417);function I(p,C){if(1&p&&l.nrm(0,"ion-icon",4),2&p){const _=l.XpG();l.Y8G("name",_.icon)}}function t(p,C){if(1&p){const _=l.RV6();l.j41(0,"ion-button",5),l.bIt("click",function(){l.eBV(_);const P=l.XpG();return l.Njj(P.showOrHidePassword())}),l.nrm(1,"ion-icon",6),l.k0s()}if(2&p){const _=l.XpG();l.R7$(),l.Y8G("name",_.hide?"eye-outline":"eye-off-outline")}}let F=(()=>{var p;class C{constructor(){this.hide=!0}ngOnInit(){"password"==this.type&&(this.isPassword=!0)}showOrHidePassword(){this.hide=!this.hide,this.type=this.hide?"password":"text"}}return(p=C).\u0275fac=function(y){return new(y||p)},p.\u0275cmp=l.VBU({type:p,selectors:[["app-custom-input"]],inputs:{control:"control",type:"type",label:"label",autocomplete:"autocomplete",icon:"icon"},decls:4,vars:6,consts:[["lines","none",1,"custom-input"],["color","primary","slot","start",3,"name",4,"ngIf"],["label-placement","floating",3,"type","autocomplete","label","formControl"],["slot","end","fill","clear","shape","round",3,"click",4,"ngIf"],["color","primary","slot","start",3,"name"],["slot","end","fill","clear","shape","round",3,"click"],["slot","icon-only",3,"name"]],template:function(y,P){1&y&&(l.j41(0,"ion-item",0),l.DNE(1,I,1,1,"ion-icon",1),l.nrm(2,"ion-input",2),l.DNE(3,t,2,1,"ion-button",3),l.k0s()),2&y&&(l.R7$(),l.Y8G("ngIf",P.icon),l.R7$(),l.Y8G("type",P.type)("autocomplete",P.autocomplete)("label",P.label)("formControl",P.control),l.R7$(),l.Y8G("ngIf",P.isPassword))},dependencies:[a.bT,c.Jm,c.iq,c.$w,c.uz,c.Gw,T.BC,T.l_]}),C})()}}]);