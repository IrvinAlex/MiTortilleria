"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7303],{7303:(re,_,u)=>{u.r(_),u.d(_,{EscanerQrPageModule:()=>ne});var y=u(177),P=u(9417),m=u(5933),A=u(8265),s=u(467),e=u(4438),h=u(5083),x=function(t){return t.Front="FRONT",t.Back="BACK",t}(x||{});const v=(0,h.F3)("BarcodeScanner",{web:()=>u.e(870).then(u.bind(u,870)).then(t=>new t.BarcodeScannerWeb)});var O=u(7239),F=u.n(O),E=u(2739),M=u(2233);const k=["square"];function Q(t,r){if(1&t){const o=e.RV6();e.j41(0,"ion-fab",8)(1,"ion-fab-button",4),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.toggleTorch())}),e.nrm(2,"ion-icon",9),e.k0s()()}}let L=(()=>{var t;class r{constructor(n,i){this.ngZone=n,this.modalController=i,this.formats=[],this.lensFacing=x.Back,this.isTorchAvailable=!1}ngOnInit(){var n=this;return(0,s.A)(function*(){v.isTorchAvailable().then(i=>{n.isTorchAvailable=i.available})})()}ngAfterViewInit(){setTimeout(()=>{this.startScan()},250)}ngOnDestroy(){this.stopScan()}closeModal(n){var i=this;return(0,s.A)(function*(){i.modalController.dismiss({barcode:n})})()}toggleTorch(){return(0,s.A)(function*(){yield v.toggleTorch()})()}startScan(){var n=this;return(0,s.A)(function*(){var i,a;null===(i=document.querySelector("body"))||void 0===i||i.classList.add("barcode-scanning-active");const l={formats:n.formats,lensFacing:n.lensFacing},c=null===(a=n.squareElement)||void 0===a?void 0:a.nativeElement.getBoundingClientRect(),d=c?{left:c.left*window.devicePixelRatio,right:c.right*window.devicePixelRatio,top:c.top*window.devicePixelRatio,bottom:c.bottom*window.devicePixelRatio,width:c.width*window.devicePixelRatio,height:c.height*window.devicePixelRatio}:void 0,g=d?[[d.left,d.top],[d.left+d.width,d.top],[d.left+d.width,d.top+d.height],[d.left,d.top+d.height]]:void 0,f=yield v.addListener("barcodeScanned",function(){var b=(0,s.A)(function*(C){n.ngZone.run(()=>{const p=C.barcode.cornerPoints;g&&p&&(g[0][0]>p[0][0]||g[0][1]>p[0][1]||g[1][0]<p[1][0]||g[1][1]>p[1][1]||g[2][0]<p[2][0]||g[2][1]<p[2][1]||g[3][0]>p[3][0]||g[3][1]<p[3][1])||(f.remove(),n.closeModal(C.barcode))})});return function(C){return b.apply(this,arguments)}}());yield v.startScan(l)})()}stopScan(){return(0,s.A)(function*(){var n;null===(n=document.querySelector("body"))||void 0===n||n.classList.remove("barcode-scanning-active"),yield v.stopScan()})()}}return(t=r).\u0275fac=function(n){return new(n||t)(e.rXU(e.SKi),e.rXU(m.W3))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-barcode-scanning"]],viewQuery:function(n,i){if(1&n&&e.GBs(k,5),2&n){let a;e.mGM(a=e.lsd())&&(i.squareElement=a.first)}},inputs:{formats:"formats",lensFacing:"lensFacing"},decls:9,vars:1,consts:[["square",""],[1,"ion-no-border"],["color","tertiary"],["slot","end"],[3,"click"],["name","close"],[1,"square"],["slot","fixed","horizontal","end","vertical","bottom",4,"ngIf"],["slot","fixed","horizontal","end","vertical","bottom"],["name","flashlight"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),e.bIt("click",function(){return e.eBV(a),e.Njj(i.closeModal())}),e.nrm(4,"ion-icon",5),e.k0s()()()(),e.j41(5,"ion-content"),e.nrm(6,"div",6,0),e.DNE(8,Q,3,0,"ion-fab",7),e.k0s()}2&n&&(e.R7$(8),e.Y8G("ngIf",i.isTorchAvailable))},dependencies:[y.bT,m.Jm,m.QW,m.W9,m.Q8,m.YW,m.eU,m.iq,m.ai],styles:["ion-content[_ngcontent-%COMP%]{--background: transparent}.square[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:16px;width:200px;height:200px;border:6px solid white;box-shadow:0 0 0 4000px #0000004d}"]}),r})();class U extends h.E_{constructor(){super(...arguments),this.ERROR_PICK_FILE_CANCELED="pickFiles canceled."}checkPermissions(){var r=this;return(0,s.A)(function*(){throw r.unimplemented("Not implemented on web.")})()}convertHeicToJpeg(r){var o=this;return(0,s.A)(function*(){throw o.unimplemented("Not implemented on web.")})()}pickFiles(r){var o=this;return(0,s.A)(function*(){const n=yield o.openFilePicker(r);if(!n)throw new Error(o.ERROR_PICK_FILE_CANCELED);const i={files:[]};for(const a of n){const l={blob:a,modifiedAt:a.lastModified,mimeType:o.getMimeTypeFromUrl(a),name:o.getNameFromUrl(a),path:void 0,size:o.getSizeFromUrl(a)};null!=r&&r.readData&&(l.data=yield o.getDataFromFile(a)),i.files.push(l)}return i})()}pickDirectory(){var r=this;return(0,s.A)(function*(){throw r.unimplemented("Not implemented on web.")})()}pickImages(r){var o=this;return(0,s.A)(function*(){return o.pickFiles(Object.assign({types:["image/*"]},r))})()}pickMedia(r){var o=this;return(0,s.A)(function*(){return o.pickFiles(Object.assign({types:["image/*","video/*"]},r))})()}pickVideos(r){var o=this;return(0,s.A)(function*(){return o.pickFiles(Object.assign({types:["video/*"]},r))})()}requestPermissions(r){var o=this;return(0,s.A)(function*(){throw o.unimplemented("Not implemented on web.")})()}openFilePicker(r){var o=this;return(0,s.A)(function*(){var n;const i=(null===(n=null==r?void 0:r.types)||void 0===n?void 0:n.join(","))||"",a=void 0===(null==r?void 0:r.limit)?0:r.limit;return new Promise(l=>{let c=!1;const d=document.createElement("input");d.type="file",d.accept=i,d.multiple=0===a,d.addEventListener("change",()=>{c=!0;const g=Array.from(d.files||[]);l(g)},{once:!0}),window.addEventListener("focus",(0,s.A)(function*(){yield o.wait(1e3),!c&&l(void 0)}),{once:!0}),d.click()})})()}getDataFromFile(r){return(0,s.A)(function*(){return new Promise((o,n)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>{const c=("string"==typeof i.result?i.result:"").split("base64,")[1]||"";o(c)},i.onerror=a=>{n(a)}})})()}getNameFromUrl(r){return r.name}getMimeTypeFromUrl(r){return r.type}getSizeFromUrl(r){return r.size}wait(r){return(0,s.A)(function*(){return new Promise(o=>setTimeout(o,r))})()}}const j=(0,h.F3)("FilePicker",{web:()=>new U});class S extends h.E_{write(r){var o=this;return(0,s.A)(function*(){if(typeof navigator>"u"||!navigator.clipboard)throw o.unavailable("Clipboard API not available in this browser");if(void 0!==r.string)yield o.writeText(r.string);else if(r.url)yield o.writeText(r.url);else{if(!r.image)throw new Error("Nothing to write");if(!(typeof ClipboardItem<"u"))throw o.unavailable("Writing images to the clipboard is not supported in this browser");try{const n=yield(yield fetch(r.image)).blob(),i=new ClipboardItem({[n.type]:n});yield navigator.clipboard.write([i])}catch{throw new Error("Failed to write image")}}})()}read(){var r=this;return(0,s.A)(function*(){if(typeof navigator>"u"||!navigator.clipboard)throw r.unavailable("Clipboard API not available in this browser");if(!(typeof ClipboardItem<"u"))return r.readText();try{const o=yield navigator.clipboard.read(),n=o[0].types[0],i=yield o[0].getType(n);return{value:yield r._getBlobData(i,n),type:n}}catch{return r.readText()}})()}readText(){var r=this;return(0,s.A)(function*(){if(typeof navigator>"u"||!navigator.clipboard||!navigator.clipboard.readText)throw r.unavailable("Reading from clipboard not supported in this browser");return{value:yield navigator.clipboard.readText(),type:"text/plain"}})()}writeText(r){var o=this;return(0,s.A)(function*(){if(typeof navigator>"u"||!navigator.clipboard||!navigator.clipboard.writeText)throw o.unavailable("Writting to clipboard not supported in this browser");yield navigator.clipboard.writeText(r)})()}_getBlobData(r,o){return new Promise((n,i)=>{const a=new FileReader;o.includes("image")?a.readAsDataURL(r):a.readAsText(r),a.onloadend=()=>{n(a.result)},a.onerror=l=>{i(l)}})}}const W=(0,h.F3)("Clipboard",{web:()=>new S}),G=(0,h.F3)("Browser",{web:()=>u.e(4786).then(u.bind(u,4786)).then(t=>new t.BrowserWeb)});var w=u(7691),X=u(2723),$=u(7517),q=u(6141),z=u(7157),Y=u(8461),R=u(8288);function K(t,r){if(1&t){const o=e.RV6();e.j41(0,"div",5),e.nrm(1,"div",6)(2,"img",7),e.j41(3,"h6",8),e.EFF(4,"Escanea o selecciona una imagen con C\xf3digo QR para obtener su valor "),e.k0s(),e.j41(5,"ion-row")(6,"ion-col",9)(7,"ion-button",10),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.startScan())}),e.EFF(8," Esc\xe1ner "),e.nrm(9,"ion-icon",11),e.k0s()(),e.j41(10,"ion-col",9)(11,"ion-button",10),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.readBarcodeFromImage())}),e.EFF(12," Selecciona "),e.nrm(13,"ion-icon",12),e.k0s()()()()}}function V(t,r){if(1&t&&e.nrm(0,"qr-code",20),2&t){const o=e.XpG(2);e.Y8G("value",o.qrText)}}function J(t,r){1&t&&e.nrm(0,"img",21)}function Z(t,r){if(1&t){const o=e.RV6();e.j41(0,"ion-button",22),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.captureScreen())}),e.EFF(1," Compartir "),e.nrm(2,"ion-icon",23),e.k0s()}}function H(t,r){if(1&t){const o=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",13)(3,"div",14)(4,"div",15),e.DNE(5,V,1,1,"qr-code",16)(6,J,1,0,"img",17),e.k0s()()(),e.j41(7,"ion-textarea",18),e.mxI("ngModelChange",function(i){e.eBV(o);const a=e.XpG();return e.DH7(a.qrText,i)||(a.qrText=i),e.Njj(i)}),e.k0s(),e.DNE(8,Z,3,0,"ion-button",19),e.k0s()()}if(2&t){const o=e.XpG();e.R7$(5),e.Y8G("ngIf",o.qrText),e.R7$(),e.Y8G("ngIf",!o.qrText),e.R7$(),e.R50("ngModel",o.qrText),e.Y8G("autoGrow",!0),e.R7$(),e.Y8G("ngIf",o.qrText)}}const B=[{path:"",component:(()=>{var t;class r{constructor(n,i,a,l,c){this.loadingController=n,this.platform=i,this.modalController=a,this.toastController=l,this.alertController=c,this.segment="scan",this.qrText="",this.scanResult="",this.resultado=[],this.loading=!1,this.pedidos=[],this.utilsSvc=(0,e.WQX)(X.T),this.firebaseSvc=(0,e.WQX)($.f)}ngOnInit(){return(0,s.A)(function*(){"granted"!==(yield w.i7.checkPermissions()).camera&&(yield w.i7.requestPermissions())})()}startScan(){var n=this;return(0,s.A)(function*(){const i=yield n.modalController.create({cssClass:"barcode-scanning-modal",showBackdrop:!1,component:L,componentProps:{formats:[],lensFacing:x.Back}});yield i.present();const{data:a}=yield i.onWillDismiss();if(a){var l;let c=null==a||null===(l=a.barcode)||void 0===l?void 0:l.displayValue;try{const d=c.replace(/'/g,'"').replace(/([a-zA-Z0-9_]+):/g,'"$1":'),f=JSON.parse(d).uid_pedido;n.getPedido(f)}catch{}}})()}getPedido(n){var i=this;return(0,s.A)(function*(){let a=`pedidos/${n}`;const l=yield i.utilsSvc.loading();yield l.present(),i.firebaseSvc.getDocument(a).then(c=>{i.pedidos=c;let d=`users/${c.uid_cliente}`;return c.id=n,i.firebaseSvc.getDocument(d).then(g=>{c.nombre_cliente=`${g.name} ${g.mother_Last_Name} ${g.father_Last_Name}`,i.firebaseSvc.getCollectionData(`pedidos/${n}/detalle_pedido`,[]).subscribe({next:b=>{c.detalle_pedido=b,c.detalle_pedido.forEach(function(){var C=(0,s.A)(function*(p){const ie=`productos/${p.uid_producto}`;try{let N=yield i.firebaseSvc.getDocument(ie);p.producto=N}catch{}});return function(p){return C.apply(this,arguments)}}())}}),i.openAsignarEntrega(c)})}).catch(c=>{}).finally(()=>{l.dismiss()})})()}openAsignarEntrega(n){var i=this;return(0,s.A)(function*(){(yield i.utilsSvc.presentModal({component:q.L,componentProps:{pedido:n}}))&&i.utilsSvc.presentToast({message:"Pedido entregado",duration:2500,color:"primary",position:"bottom",icon:"checkmark-circle-outline"})})()}readBarcodeFromImage(){var n=this;return(0,s.A)(function*(){var i;const{files:a}=yield j.pickImages({limit:1}),l=null===(i=a[0])||void 0===i?void 0:i.path;if(!l)return;const{barcodes:c}=yield v.readBarcodesFromImage({path:l,formats:[]});if(n.scanResult=c[0].displayValue,c.length>0){let d=c[0].displayValue;try{const g=d.replace(/'/g,'"').replace(/([a-zA-Z0-9_]+):/g,'"$1":'),b=JSON.parse(g).uid_pedido;n.getPedido(b)}catch{}}})()}captureScreen(){const n=document.getElementById("qrImage");F()(n).then(i=>{this.platform.is("capacitor")?this.shareImage(i):this.dowloadImage(i)})}dowloadImage(n){const i=document.createElement("a");i.href=n.toDataURL(),i.download="qr.png",i.click()}shareImage(n){var i=this;return(0,s.A)(function*(){const a=yield i.loadingController.create({spinner:"crescent"});yield a.present();const l=n.toDataURL(),c="qr.png";yield E.YA.writeFile({path:c,data:l,directory:E.__.Cache}).then(function(){var d=(0,s.A)(function*(g){let f=g.uri;yield M.S.share({url:f}),yield E.YA.deleteFile({path:c,directory:E.__.Cache})});return function(g){return d.apply(this,arguments)}}()).finally(()=>{a.dismiss()})})()}writeToClipboard(){var n=this;return(0,s.A)(function*(){yield W.write({string:n.scanResult}),(yield n.toastController.create({message:"Copiado al portapapeles",duration:1e3,color:"tertiary",icon:"clipboard-outline",position:"middle"})).present()})()}openCapacitorSite(){var n=this;return(0,s.A)(function*(){yield(yield n.alertController.create({header:"Confirm!",message:"Quieres abrir este enlace en el navegador?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Okay",handler:()=>console.log("Confirm Okay")}]})).present();let a=n.scanResult;a.startsWith("https://")||(a="https://"+a),yield G.open({url:a})})()}isUrl(){return/\.(com|net|io|me|crypto|ai)\b/i.test(this.scanResult)}}return(t=r).\u0275fac=function(n){return new(n||t)(e.rXU(m.Xi),e.rXU(z.OD),e.rXU(m.W3),e.rXU(m.K_),e.rXU(m.hG))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-escaner-qr"]],decls:8,vars:4,consts:[["title","Escanear pedidos",3,"showMenu"],[1,"ion-padding","ion-text-center"],["mode","ios",3,"ngModelChange","ngModel"],["value","scan"],["class","segment",4,"ngIf"],[1,"segment"],[1,"segment-content"],["src","../../../../../assets/img/scan-qr.webp","alt",""],[1,"scan-label"],["size","6"],["expand","block",1,"submit",3,"click"],["slot","end","name","scan-outline"],["slot","end","name","image-outline"],["id","qrImage"],[1,"d-flex-center"],[1,"d-flex-center","qr-wrapper"],["size","190","errorCorrectionLevel","M",3,"value",4,"ngIf"],["class","qr-placeholder","src","../../../../../assets/img/qr.webp","alt","",4,"ngIf"],["label","Escribe algo para convertir a codigo QR","labelPlacement","stacked","fill","outline","rows","4",3,"ngModelChange","ngModel","autoGrow"],["class","submit ion-margin-top","expand","block",3,"click",4,"ngIf"],["size","190","errorCorrectionLevel","M",3,"value"],["src","../../../../../assets/img/qr.webp","alt","",1,"qr-placeholder"],["expand","block",1,"submit","ion-margin-top",3,"click"],["slot","end","name","share-social-outline"]],template:function(n,i){1&n&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"ion-segment",2),e.mxI("ngModelChange",function(l){return e.DH7(i.segment,l)||(i.segment=l),l}),e.j41(3,"ion-segment-button",3)(4,"ion-label"),e.EFF(5,"Scan QR"),e.k0s()()(),e.DNE(6,K,14,0,"div",4)(7,H,9,5,"div",4),e.k0s()),2&n&&(e.Y8G("showMenu",!0),e.R7$(2),e.R50("ngModel",i.segment),e.R7$(4),e.Y8G("ngIf","scan"===i.segment),e.R7$(),e.Y8G("ngIf","ssssss"===i.segment))},dependencies:[y.bT,P.BC,P.vS,m.Jm,m.hU,m.W9,m.iq,m.he,m.ln,m.Gp,m.eP,m.nc,m.Je,m.Gw,Y.l,R.Um],styles:["ion-segment[_ngcontent-%COMP%]{margin-top:20px}.segment[_ngcontent-%COMP%]{padding:30px 5px}.submit[_ngcontent-%COMP%]{height:44px;--border-radius: 10px;--background: var(--ion-color-tertiary)}.scan-label[_ngcontent-%COMP%]{margin:25px 0}img[_ngcontent-%COMP%]{width:200px}.result[_ngcontent-%COMP%]{color:#000;border:1px dashed var(--ion-color-medium);border-radius:10px;margin:30px 0}.result[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-tertiary);margin-bottom:5px;font-size:11px}.result[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:0}ion-button[_ngcontent-%COMP%]{text-transform:none}ion-textarea[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-tertiary);text-align:start}#qrImage[_ngcontent-%COMP%]{padding:20px 0}.qr-wrapper[_ngcontent-%COMP%]{width:230px;min-height:230px;background:var(--ion-color-tertiary);border-radius:20px}.qr-placeholder[_ngcontent-%COMP%]{width:60px}.d-flex-center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}"]}),r})()}];let ee=(()=>{var t;class r{}return(t=r).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[A.iI.forChild(B),A.iI]}),r})();var te=u(7383);let ne=(()=>{var t;class r{}return(t=r).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[y.MD,P.YN,m.bv,ee,te.G,R.XK]}),r})()}}]);