"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4577],{4577:(be,D,m)=>{m.r(D),m.d(D,{HistorialPedidosPageModule:()=>Pe});var _=m(177),P=m(9417),d=m(5933),O=m(8265),f=m(467),e=m(4438),I=m(7517),k=m(2723),j=(m(4511),m(7239)),S=m.n(j),b=m(2739),R=m(2233),$=m(7157),G=m(8288),E=m(8461);const H=["sliderButton"],N=["mapContainer"],A=o=>[o,"MXN","symbol-narrow","1.2-2","en-US"];function z(o,l){if(1&o&&(e.j41(0,"div",30)(1,"p"),e.nrm(2,"ion-icon",9),e.EFF(3),e.nI1(4,"date"),e.k0s()()),2&o){const i=e.XpG();e.R7$(2),e.Y8G("name",i.isBusinessPickup()?"time-outline":"truck-outline")("color",i.getDeliveryTypeColor()),e.R7$(),e.Lme(" ",i.getScheduledLabel(),": ",e.i5U(4,4,i.getScheduledDate(),"dd/MM/yyyy HH:mm")," ")}}function B(o,l){if(1&o){const i=e.RV6();e.j41(0,"ion-button",40),e.bIt("click",function(){e.eBV(i);const n=e.XpG(2);return e.Njj(n.loadMapPreview())}),e.nrm(1,"ion-icon",41),e.EFF(2," Ver mapa "),e.k0s()}}function Y(o,l){1&o&&e.nrm(0,"div",46,0)}function X(o,l){1&o&&(e.j41(0,"div",47),e.nrm(1,"ion-spinner",48),e.j41(2,"p"),e.EFF(3,"Cargando mapa..."),e.k0s()())}function U(o,l){if(1&o){const i=e.RV6();e.j41(0,"div",49),e.nrm(1,"ion-icon",50),e.j41(2,"p"),e.EFF(3,"No se pudo cargar el mapa"),e.k0s(),e.j41(4,"ion-button",51),e.bIt("click",function(){e.eBV(i);const n=e.XpG(3);return e.Njj(n.openLocationInMaps())}),e.EFF(5," Ver en Google Maps "),e.k0s()()}}function V(o,l){if(1&o&&(e.j41(0,"div",42),e.DNE(1,Y,2,0,"div",43)(2,X,4,0,"div",44)(3,U,6,0,"div",45),e.k0s()),2&o){const i=e.XpG(2);e.R7$(),e.Y8G("ngIf",!i.mapLoadError),e.R7$(),e.Y8G("ngIf",i.showMapPreview&&!i.isMapReady&&!i.mapLoadError),e.R7$(),e.Y8G("ngIf",i.mapLoadError)}}function J(o,l){if(1&o&&(e.j41(0,"p"),e.nrm(1,"ion-icon",52),e.EFF(2),e.nI1(3,"date"),e.k0s()),2&o){const i=e.XpG(2);e.R7$(2),e.SpI(" Entrega programada: ",e.i5U(3,1,i.getScheduledDate(),"EEEE, dd 'de' MMMM 'a las' HH:mm")," ")}}function q(o,l){if(1&o){const i=e.RV6();e.j41(0,"div",4)(1,"h3",13),e.nrm(2,"ion-icon",31),e.EFF(3," Ubicaci\xf3n de Entrega "),e.k0s(),e.j41(4,"div",32),e.DNE(5,B,3,0,"ion-button",33),e.j41(6,"ion-button",34),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.openLocationInMaps())}),e.nrm(7,"ion-icon",35),e.EFF(8," Abrir en Maps "),e.k0s()(),e.DNE(9,V,4,3,"div",36),e.j41(10,"div",37)(11,"p"),e.nrm(12,"ion-icon",38),e.EFF(13),e.nI1(14,"number"),e.nI1(15,"number"),e.k0s(),e.DNE(16,J,4,4,"p",39),e.k0s()()}if(2&o){const i=e.XpG();e.R7$(5),e.Y8G("ngIf",!i.showMapPreview),e.R7$(4),e.Y8G("ngIf",i.showMapPreview),e.R7$(4),e.Lme(" Coordenadas: ",e.i5U(14,5,i.pedido.geopoint_entrega.latitude,"1.6-6"),", ",e.i5U(15,8,i.pedido.geopoint_entrega.longitude,"1.6-6")," "),e.R7$(3),e.Y8G("ngIf",i.getScheduledDate())}}function Q(o,l){if(1&o&&(e.j41(0,"div",65)(1,"div",66),e.nrm(2,"ion-icon",67),e.j41(3,"div")(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"p",68),e.EFF(7),e.nI1(8,"date"),e.k0s()()()()),2&o){const i=e.XpG(2);e.R7$(5),e.JRh(i.getScheduledLabel()),e.R7$(2),e.JRh(e.i5U(8,2,i.getScheduledDate(),"EEEE, dd 'de' MMMM 'a las' HH:mm"))}}function W(o,l){1&o&&(e.j41(0,"ion-item"),e.nrm(1,"ion-icon",69),e.j41(2,"ion-label",62)(3,"p")(4,"strong"),e.EFF(5,"Pago en efectivo al recoger el pedido"),e.k0s()()()())}function Z(o,l){if(1&o&&(e.j41(0,"div",4)(1,"h3",13),e.nrm(2,"ion-icon",53),e.EFF(3," Informaci\xf3n de Recolecci\xf3n "),e.k0s(),e.DNE(4,Q,9,5,"div",54),e.j41(5,"div",55)(6,"h4"),e.EFF(7,"Datos del Negocio"),e.k0s(),e.j41(8,"p"),e.nrm(9,"ion-icon",5),e.EFF(10),e.k0s(),e.j41(11,"p"),e.nrm(12,"ion-icon",56),e.EFF(13," Avenida Benito No.103B colonia M\xe9xico 68, c\xf3digo postal o C.P: 51412"),e.k0s(),e.j41(14,"p"),e.nrm(15,"ion-icon",57),e.EFF(16," 722 366 4325 "),e.k0s(),e.j41(17,"p"),e.nrm(18,"ion-icon",58),e.EFF(19),e.k0s()(),e.j41(20,"div",59)(21,"h4"),e.EFF(22,"Instrucciones de Recolecci\xf3n"),e.k0s(),e.j41(23,"ion-list",60)(24,"ion-item"),e.nrm(25,"ion-icon",61),e.j41(26,"ion-label",62)(27,"p"),e.EFF(28,"Presenta tu identificaci\xf3n o menciona el n\xfamero de pedido"),e.k0s()()(),e.j41(29,"ion-item"),e.nrm(30,"ion-icon",63),e.j41(31,"ion-label",62)(32,"p"),e.EFF(33,"Llega puntual en el horario programado"),e.k0s()()(),e.DNE(34,W,6,0,"ion-item",39),e.j41(35,"ion-item"),e.nrm(36,"ion-icon",64),e.j41(37,"ion-label",62)(38,"p"),e.EFF(39,"Verifica tu pedido antes de retirarte"),e.k0s()()()()()()),2&o){const i=e.XpG();e.R7$(4),e.Y8G("ngIf",i.getScheduledDate()),e.R7$(6),e.SpI(" ",i.getBusinessInfo().name,""),e.R7$(9),e.SpI(" ",i.getBusinessInfo().hours,""),e.R7$(15),e.Y8G("ngIf","Efectivo"===i.pedido.tipo_pago)}}function K(o,l){if(1&o&&(e.j41(0,"p"),e.EFF(1,"Tama\xf1o de tortilla: "),e.j41(2,"span",72),e.EFF(3),e.k0s()()),2&o){const i=e.XpG().$implicit;e.R7$(3),e.JRh(i.tamano_tortilla)}}function ee(o,l){if(1&o&&(e.j41(0,"ion-item")(1,"ion-avatar",70),e.nrm(2,"img",71),e.k0s(),e.j41(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.DNE(6,K,4,1,"p",39),e.j41(7,"p"),e.EFF(8),e.k0s(),e.j41(9,"p"),e.EFF(10,"Subtotal: "),e.j41(11,"span",72),e.EFF(12),e.nI1(13,"currency"),e.k0s()()(),e.j41(14,"ion-badge",73),e.nrm(15,"ion-icon",74),e.EFF(16),e.k0s()()),2&o){const i=l.$implicit;e.R7$(2),e.FS9("alt",i.producto.nombre),e.Y8G("src",i.producto.imagen,e.B4B),e.R7$(3),e.JRh(i.producto.nombre),e.R7$(),e.Y8G("ngIf",i.tamano_tortilla),e.R7$(2),e.SpI("Cantidad: ",i.cantidad,""),e.R7$(4),e.SpI("",e.iJd(13,7,e.eq3(13,A,i.subtotal))," MXN"),e.R7$(4),e.SpI(" ",i.cantidad," ")}}function te(o,l){if(1&o&&e.nrm(0,"qr-code",75),2&o){const i=e.XpG();e.Y8G("value",i.qrText)}}function ne(o,l){1&o&&e.nrm(0,"img",76)}function oe(o,l){if(1&o){const i=e.RV6();e.j41(0,"ion-button",77),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.captureScreen())}),e.EFF(1," Compartir "),e.nrm(2,"ion-icon",78),e.k0s()}}let ie=(()=>{var o;class l{constructor(t,n,a,r){this.loadingController=t,this.platform=n,this.modalCtrl=a,this.alertCtrl=r,this.qrText="",this.sliderValue=0,this.showAnimation=!1,this.firebaseSvc=(0,e.WQX)(I.f),this.utilSvc=(0,e.WQX)(k.T),this.rating=3,this.isMapReady=!1,this.businessLocation=null,this.mapLoadError=!1,this.showMapPreview=!1,this.utilsSvc=(0,e.WQX)(k.T)}ngOnInit(){var n,t=this;console.log(this.pedido),this.qrText=JSON.stringify({uid_pedido:this.pedido.id}),this.pedido.detalle_pedido||(this.pedido.detalle_pedido=[]);const s=this.pedido.detalle_pedido.map(function(){var c=(0,f.A)(function*(g){const h=`productos/${g.uid_producto}`;try{let p=yield t.firebaseSvc.getDocument(h);g.producto=p}catch(p){console.error("Error al obtener detalles del producto:",p)}});return function(g){return c.apply(this,arguments)}}());Promise.all(s).then(()=>{console.log("Todos los detalles de productos han sido obtenidos:",this.pedido.detalle_pedido)}).catch(c=>{console.error("Error al obtener detalles de productos:",c)}),this.pedido.rating&&(this.rating=this.pedido.rating),"domicilio"===(null===(n=this.pedido.tipo_entrega)||void 0===n?void 0:n.toLowerCase())&&this.loadBusinessLocation()}ngAfterViewInit(){}loadBusinessLocation(){var t=this;return(0,f.A)(function*(){try{t.firebaseSvc.getCollectionData("direccionNegocio").subscribe(n=>{n&&n.length>0&&(t.businessLocation=n[0])})}catch(n){console.error("Error loading business location:",n)}})()}loadMapPreview(){var t=this;return(0,f.A)(function*(){t.showMapPreview||!t.pedido.geopoint_entrega||(t.showMapPreview=!0,setTimeout(()=>{t.loadLeafletMap()},100))})()}loadLeafletMap(){var t;if(null!==(t=this.mapContainer)&&void 0!==t&&t.nativeElement&&this.pedido.geopoint_entrega)try{this.loadLeafletAssets().then(()=>{this.initializeLeafletMap()}).catch(n=>{console.error("Error loading Leaflet:",n),this.mapLoadError=!0})}catch(n){console.error("Error initializing map:",n),this.mapLoadError=!0}else this.mapLoadError=!0}loadLeafletAssets(){return new Promise((t,n)=>{if(typeof L<"u")return void t();const a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(a);const r=document.createElement("script");r.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",r.onload=()=>t(),r.onerror=()=>n(new Error("Failed to load Leaflet")),document.head.appendChild(r)})}initializeLeafletMap(){try{var t;const n=[this.pedido.geopoint_entrega.latitude,this.pedido.geopoint_entrega.longitude];this.map=L.map(this.mapContainer.nativeElement,{center:n,zoom:15,zoomControl:!0,attributionControl:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map);const a=L.divIcon({html:'<ion-icon name="home" style="color: #3880ff; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});if(L.marker(n,{icon:a}).addTo(this.map).bindPopup("Direcci\xf3n de entrega"),null!==(t=this.businessLocation)&&void 0!==t&&t.geopoint){const r=[this.businessLocation.geopoint.latitude,this.businessLocation.geopoint.longitude],s=L.divIcon({html:'<ion-icon name="storefront" style="color: #10dc60; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});L.marker(r,{icon:s}).addTo(this.map).bindPopup("Tortiller\xeda Plata Jaimes");const c=L.featureGroup([L.marker(n),L.marker(r)]);this.map.fitBounds(c.getBounds().pad(.1))}setTimeout(()=>{this.map.invalidateSize(),this.isMapReady=!0},200)}catch(n){console.error("Error initializing Leaflet map:",n),this.mapLoadError=!0}}openLocationInMaps(){if(!this.pedido.geopoint_entrega)return;const a=`https://www.google.com/maps?q=${this.pedido.geopoint_entrega.latitude},${this.pedido.geopoint_entrega.longitude}`;this.platform.is("capacitor")?window.open(a,"_system"):window.open(a,"_blank")}onSliderChange(){var t=this;return(0,f.A)(function*(){if(100===t.sliderValue){const n=yield t.utilsSvc.loading();yield n.present(),t.showAnimation=!0,t.firebaseSvc.updateDocumet(`pedidos/${t.pedido.id}`,{estatus:"En preparaci\xf3n"}).then(function(){var r=(0,f.A)(function*(s){setTimeout(()=>{t.showAnimation=!1,t.sliderValue=0,t.pedido.estatus="En preparaci\xf3n",t.utilsSvc.dismissModal({success:!0})},3e3)});return function(s){return r.apply(this,arguments)}}()).catch(r=>{t.utilSvc.presentToast({message:r.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{n.dismiss()})}})()}getColorIcon(t){switch(t.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}captureScreen(){const t=document.getElementById("qrImage");S()(t).then(n=>{this.platform.is("capacitor")?this.shareImage(n):this.dowloadImage(n)})}shareImage(t){var n=this;return(0,f.A)(function*(){const a=yield n.loadingController.create({spinner:"crescent"});yield a.present();const r=t.toDataURL(),s="qr.png";yield b.YA.writeFile({path:s,data:r,directory:b.__.Cache}).then(function(){var c=(0,f.A)(function*(g){let h=g.uri;yield R.S.share({url:h}),yield b.YA.deleteFile({path:s,directory:b.__.Cache})});return function(g){return c.apply(this,arguments)}}()).finally(()=>{a.dismiss()})})()}dowloadImage(t){const n=document.createElement("a");n.href=t.toDataURL(),n.download="qr.png",n.click()}getStatusIcon(t){switch(t.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}reorderProducts(){var t=this;return(0,f.A)(function*(){var a;yield(yield t.alertCtrl.create({header:"Confirmar Pedido",message:"\xbfDeseas agregar estos productos al carrito de compras?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:(a=(0,f.A)(function*(){const r=t.utilsSvc.getFromLocalStorage("carrito")||[],s=t.utilsSvc.getFromLocalStorage("user"),c=r[0]||{uid_cliente:s.uid,detalle_carrito:[],total:0};t.pedido.detalle_pedido.forEach(p=>{const u=c.detalle_carrito.findIndex(v=>v.uid_producto===p.uid_producto&&v.uid_opcion===p.uid_opcion);u>-1?(c.detalle_carrito[u].cantidad+=p.cantidad,c.detalle_carrito[u].subtotal+=p.subtotal):c.detalle_carrito.push({uid_producto:p.uid_producto,uid_opcion:p.uid_opcion,nombre:p.producto.nombre,cantidad:p.cantidad,subtotal:p.subtotal})}),c.total+=t.pedido.detalle_pedido.reduce((p,u)=>p+u.subtotal,0),t.utilsSvc.setElementInLocalstorage("carrito",[c]);const g=s.uid,h=c.id||t.firebaseSvc.firestore.createId();c.id=h;try{yield t.firebaseSvc.setDocument(`users/${g}/carrito/${h}`,{total:c.total});for(const p of c.detalle_carrito){const u=p.id||t.firebaseSvc.firestore.createId();p.id=u,yield t.firebaseSvc.setDocument(`users/${g}/carrito/${h}/detalle_carrito/${u}`,p)}console.log("Carrito actualizado en Firebase:",c)}catch(p){console.error("Error al actualizar el carrito en Firebase:",p)}t.utilsSvc.presentToast({message:"Productos agregados al carrito",duration:2500,color:"primary",position:"bottom",icon:"cart-outline"})}),function(){return a.apply(this,arguments)})}]})).present()})()}rateService(){var t=this;return(0,f.A)(function*(){var a;yield(yield t.alertCtrl.create({header:"Calificar Servicio",message:`\xbfDeseas calificar este pedido con ${t.rating} estrellas?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:(a=(0,f.A)(function*(){const r=yield t.utilsSvc.loading();yield r.present();const s=`pedidos/${t.pedido.id}`;try{yield t.firebaseSvc.updateDocumet(s,{rating:t.rating}),t.utilsSvc.presentToast({message:"Calificaci\xf3n guardada con \xe9xito",duration:2500,color:"primary",position:"bottom",icon:"star-outline"})}catch{t.utilsSvc.presentToast({message:"Error al guardar la calificaci\xf3n",duration:2500,color:"danger",position:"bottom",icon:"alert-circle-outline"})}finally{r.dismiss()}}),function(){return a.apply(this,arguments)})}]})).present()})()}getDeliveryTypeIcon(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"home-outline";case"negocio":return"storefront-outline";default:return"location-outline"}}getDeliveryTypeColor(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"primary";case"negocio":return"success";default:return"medium"}}getEffectiveDeliveryType(){var t,n,a,r,s;return!0===(null===(t=this.pedido)||void 0===t?void 0:t.es_recoleccion_negocio)||"negocio"===(null===(n=this.pedido)||void 0===n?void 0:n.metodo_entrega)||"negocio"===(null===(a=this.pedido)||void 0===a?void 0:a.tipo_entrega)||null!==(r=this.pedido)&&void 0!==r&&r.hora_recoleccion?"negocio":this.hasDeliveryLocation()&&"domicilio"===(null===(s=this.pedido)||void 0===s||null===(s=s.tipo_entrega)||void 0===s?void 0:s.toLowerCase())?"domicilio":"negocio"}hasDeliveryLocation(){var t,n,a,r,s;const c=null===(t=this.pedido)||void 0===t?void 0:t.geopoint_entrega,g=c&&"number"==typeof c.latitude&&"number"==typeof c.longitude&&!isNaN(c.latitude)&&!isNaN(c.longitude),h="number"==typeof(null===(n=this.pedido)||void 0===n?void 0:n.lat)&&"number"==typeof(null===(a=this.pedido)||void 0===a?void 0:a.lng)||"number"==typeof(null===(r=this.pedido)||void 0===r||null===(r=r.coordenadas)||void 0===r?void 0:r.lat)&&"number"==typeof(null===(s=this.pedido)||void 0===s||null===(s=s.coordenadas)||void 0===s?void 0:s.lng);return!(!g&&!h)}getScheduledDate(){var t,n,a;return null!==(t=this.pedido)&&void 0!==t&&t.hora_recoleccion?this.toDateTime(this.pedido.hora_recoleccion):null!==(n=this.pedido)&&void 0!==n&&n.fecha_entrega?this.toDateTime(this.pedido.fecha_entrega):null!==(a=this.pedido)&&void 0!==a&&a.fecha?this.toDateTime(this.pedido.fecha):null}getScheduledLabel(){var t,n;return this.isBusinessPickup()?null!==(t=this.pedido)&&void 0!==t&&t.hora_recoleccion?"Horario de recolecci\xf3n":null!==(n=this.pedido)&&void 0!==n&&n.fecha_entrega?"Horario programado":"Fecha del pedido":"Horario de entrega"}toDateTime(t){if(!t)return null;if(null!=t&&t.toDate&&"function"==typeof t.toDate)return t.toDate();if(null!=t&&t.seconds)return new Date(1e3*t.seconds);const n=new Date(t);return isNaN(n.getTime())?null:n}getDeliveryTypeDisplayName(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"Entrega a domicilio";case"negocio":return"Recolecci\xf3n en negocio";default:return"Tipo no especificado"}}getBusinessInfo(){return{name:"Tortiller\xeda Plata Jaimes",address:"Calle Principal #123, Centro, Ciudad",phone:"+52 722 366 4325",hours:"Lunes a Domingo de 9:00 AM a 8:00 PM"}}isHomeDelivery(){return"domicilio"===this.getEffectiveDeliveryType()}isBusinessPickup(){return"negocio"===this.getEffectiveDeliveryType()}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(d.Xi),e.rXU($.OD),e.rXU(d.W3),e.rXU(d.hG))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-detalle-pedido"]],viewQuery:function(t,n){if(1&t&&(e.GBs(H,5),e.GBs(N,5)),2&t){let a;e.mGM(a=e.lsd())&&(n.sliderButton=a.first),e.mGM(a=e.lsd())&&(n.mapContainer=a.first)}},inputs:{pedido:"pedido"},decls:61,vars:29,consts:[["mapContainer",""],["title","Detalles del pedido",3,"isModal","showNombre","showLogo"],[1,"ticket-container"],[1,"ticket-title"],[1,"ticket-section"],["name","storefront-outline"],["name","person-outline"],["name","calendar-outline"],["class","scheduling-info",4,"ngIf"],[3,"name","color"],["mode","ios",3,"color"],["slot","start",3,"name"],["class","ticket-section",4,"ngIf"],[1,"ticket-subtitle"],[4,"ngFor","ngForOf"],["name","cash-outline"],["name","card-outline"],["slot","start",2,"margin-left","0.5rem",3,"color","name"],[1,"rating-section"],["min","1","max","5","step","1","snaps","true",3,"ngModelChange","ngModel"],["slot","start","name","star-outline"],["slot","end","name","star"],["expand","block","color","primary",3,"click"],[1,"segment-content"],["id","qrImage"],[1,"d-flex-center"],[1,"d-flex-center","qr-wrapper"],["size","190","errorCorrectionLevel","M",3,"value",4,"ngIf"],["class","qr-placeholder","src","../../../../../assets/img/qr.webp","alt","",4,"ngIf"],["class","submit ion-margin-top","expand","block",3,"click",4,"ngIf"],[1,"scheduling-info"],["name","map-outline","color","primary"],[1,"map-controls"],["fill","outline","size","small","class","map-preview-btn",3,"click",4,"ngIf"],["fill","outline","size","small",1,"external-maps-btn",3,"click"],["name","navigate-outline","slot","start"],["class","map-container",4,"ngIf"],[1,"delivery-info"],["name","location-outline","color","primary"],[4,"ngIf"],["fill","outline","size","small",1,"map-preview-btn",3,"click"],["name","map-outline","slot","start"],[1,"map-container"],["class","map-canvas",4,"ngIf"],["class","map-loading",4,"ngIf"],["class","map-error",4,"ngIf"],[1,"map-canvas"],[1,"map-loading"],["name","circles"],[1,"map-error"],["name","warning-outline","color","warning"],["size","small","fill","clear",3,"click"],["name","truck-outline","color","primary"],["name","storefront-outline","color","success"],["class","pickup-schedule",4,"ngIf"],[1,"pickup-info"],["name","location-outline"],["name","call-outline"],["name","time-outline"],[1,"pickup-instructions"],["lines","none"],["name","person-outline","slot","start","color","medium"],[1,"ion-text-wrap"],["name","time-outline","slot","start","color","medium"],["name","checkmark-circle-outline","slot","start","color","success"],[1,"pickup-schedule"],[1,"schedule-highlight"],["name","alarm-outline","color","success"],[1,"schedule-time"],["name","cash-outline","slot","start","color","warning"],["slot","start",1,"avatar-icon"],[3,"src","alt"],[1,"subtotal"],["slot","end","color","tertiary"],["name","cube-outline"],["size","190","errorCorrectionLevel","M",3,"value"],["src","../../../../../assets/img/qr.webp","alt","",1,"qr-placeholder"],["expand","block",1,"submit","ion-margin-top",3,"click"],["slot","end","name","share-social-outline"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",1),e.j41(1,"ion-content")(2,"div",2)(3,"h2",3),e.EFF(4,"Ticket de Pedido"),e.k0s(),e.j41(5,"div",4)(6,"p"),e.nrm(7,"ion-icon",5),e.EFF(8," Nombre del negocio: Tortilleria Plata Jaimes"),e.k0s(),e.j41(9,"p"),e.nrm(10,"ion-icon",6),e.EFF(11),e.k0s(),e.j41(12,"p"),e.nrm(13,"ion-icon",7),e.EFF(14),e.nI1(15,"date"),e.k0s(),e.DNE(16,z,5,7,"div",8),e.j41(17,"p"),e.nrm(18,"ion-icon",9),e.EFF(19," Tipo de entrega: "),e.j41(20,"ion-chip",10),e.nrm(21,"ion-icon",11),e.j41(22,"ion-label"),e.EFF(23),e.k0s()()()(),e.DNE(24,q,17,11,"div",12)(25,Z,40,4,"div",12),e.j41(26,"h3",13),e.EFF(27,"Productos Comprados"),e.k0s(),e.j41(28,"ion-list"),e.DNE(29,ee,17,15,"ion-item",14),e.k0s(),e.j41(30,"div",4)(31,"p"),e.nrm(32,"ion-icon",15),e.EFF(33),e.nI1(34,"number"),e.k0s(),e.j41(35,"p"),e.nrm(36,"ion-icon",16),e.EFF(37),e.k0s(),e.j41(38,"p"),e.EFF(39),e.nrm(40,"ion-icon",17),e.k0s()(),e.j41(41,"div",18)(42,"h3"),e.EFF(43,"Calificar Pedido"),e.k0s(),e.j41(44,"ion-item")(45,"ion-label"),e.EFF(46,"Calificaci\xf3n:"),e.k0s(),e.j41(47,"ion-range",19),e.mxI("ngModelChange",function(r){return e.DH7(n.rating,r)||(n.rating=r),r}),e.nrm(48,"ion-icon",20)(49,"ion-icon",21),e.k0s()(),e.j41(50,"ion-button",22),e.bIt("click",function(){return n.rateService()}),e.EFF(51,"Guardar Calificaci\xf3n"),e.k0s()(),e.j41(52,"ion-button",22),e.bIt("click",function(){return n.reorderProducts()}),e.EFF(53,"Pedir de nuevo"),e.k0s()(),e.j41(54,"div",23)(55,"div",24)(56,"div",25)(57,"div",26),e.DNE(58,te,1,1,"qr-code",27)(59,ne,1,0,"img",28),e.k0s()()(),e.DNE(60,oe,3,0,"ion-button",29),e.k0s()()),2&t&&(e.Y8G("isModal",!0)("showNombre",!1)("showLogo",!1),e.R7$(11),e.SpI(" Cliente: ",n.pedido.nombre_cliente,""),e.R7$(3),e.SpI(" Fecha: ",e.i5U(15,23,null==n.pedido.fecha?null:n.pedido.fecha.toDate(),"dd/MM/yyyy"),""),e.R7$(2),e.Y8G("ngIf",n.getScheduledDate()),e.R7$(2),e.Y8G("name",n.getDeliveryTypeIcon())("color",n.getDeliveryTypeColor()),e.R7$(2),e.Y8G("color",n.getDeliveryTypeColor()),e.R7$(),e.Y8G("name",n.getDeliveryTypeIcon()),e.R7$(2),e.JRh(n.getDeliveryTypeDisplayName()),e.R7$(),e.Y8G("ngIf",n.isHomeDelivery()&&n.pedido.geopoint_entrega),e.R7$(),e.Y8G("ngIf",n.isBusinessPickup()),e.R7$(4),e.Y8G("ngForOf",n.pedido.detalle_pedido),e.R7$(4),e.SpI(" Total: ",e.i5U(34,26,n.pedido.total,"1.2-2"),""),e.R7$(4),e.SpI(" Tipo de Pago: ",n.pedido.tipo_pago,""),e.R7$(2),e.SpI("Estatus: ",n.pedido.estatus," "),e.R7$(),e.Y8G("color",n.getColorIcon(n.pedido.estatus))("name",n.getStatusIcon(n.pedido.estatus)),e.R7$(7),e.R50("ngModel",n.rating),e.R7$(11),e.Y8G("ngIf",n.qrText),e.R7$(),e.Y8G("ngIf",!n.qrText),e.R7$(),e.Y8G("ngIf",n.qrText))},dependencies:[_.Sq,_.bT,d.mC,d.In,d.Jm,d.ZB,d.W9,d.iq,d.uz,d.he,d.nf,d.Ob,d.w2,d.Gw,P.BC,P.vS,G.Um,E.l,_.QX,_.oe,_.vh],styles:['@charset "UTF-8";.ticket-container[_ngcontent-%COMP%]{padding:16px;background-color:#f7f7f7;border-radius:8px;margin:20px;box-shadow:0 4px 8px #0003}.ticket-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;text-align:center;color:#333;margin-bottom:1rem}.ticket-section[_ngcontent-%COMP%]{background-color:#fff;padding:12px;border-radius:8px;margin-bottom:1rem;box-shadow:0 2px 6px #0000001a}.ticket-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:#444;margin:.5rem 0;display:flex;align-items:center}.ticket-section[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}.ticket-subtitle[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:500;margin-top:1rem;margin-bottom:.5rem;color:#666}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{background-color:#fafafa;border-radius:6px;margin:4px 0;box-shadow:0 1px 3px #0000001a}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1rem;color:#555}.ticket-section[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#28a745}ion-content[_ngcontent-%COMP%]{--ion-background-color: #e9ecef}.assign-slider-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:50px;text-align:center}.assign-slider[_ngcontent-%COMP%]{width:80%;--knob-size: 36px;--bar-height: 24px;--knob-background: var(--ion-color-primary);--bar-background-active: var(--ion-color-primary);--bar-background: #ddd;--bar-border-radius: 50px}.success-animation[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:20px;animation:_ngcontent-%COMP%_fadeInScale .5s ease forwards}.success-animation[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:50px;color:var(--ion-color-primary);animation:_ngcontent-%COMP%_scaleUp .5s ease forwards}.success-animation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-primary);margin-top:8px}@keyframes _ngcontent-%COMP%_fadeInScale{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_scaleUp{0%{transform:scale(.5)}to{transform:scale(1)}}ion-item[_ngcontent-%COMP%]{--inner-padding-start: 10px;border-bottom:1px solid var(--ion-color-light)}.avatar-icon[_ngcontent-%COMP%]{background-color:var(--ion-color-light);display:flex;align-items:center;justify-content:center;border-radius:50%;height:40px;width:40px}.avatar-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;font-size:16px;margin:0;color:var(--ion-color-dark)}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--ion-color-medium)}.subtotal[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-success)}ion-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;padding:5px;border-radius:10px;font-size:14px}ion-segment[_ngcontent-%COMP%]{margin-top:20px}.segment[_ngcontent-%COMP%]{padding:30px 5px}.submit[_ngcontent-%COMP%]{height:44px;--border-radius: 10px;--background: var(--ion-color-tertiary)}.scan-label[_ngcontent-%COMP%]{margin:25px 0}img[_ngcontent-%COMP%]{width:200px}.result[_ngcontent-%COMP%]{color:#000;border:1px dashed var(--ion-color-medium);border-radius:10px;margin:30px 0}.result[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-tertiary);margin-bottom:5px;font-size:11px}.result[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:0}ion-button[_ngcontent-%COMP%]{text-transform:none}ion-textarea[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-tertiary);text-align:start}#qrImage[_ngcontent-%COMP%]{padding:20px 0}.qr-wrapper[_ngcontent-%COMP%]{width:230px;min-height:230px;background:var(--ion-color-tertiary);border-radius:20px}.qr-placeholder[_ngcontent-%COMP%]{width:60px}.d-flex-center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.rating-section[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 6px #0000001a;text-align:center}.rating-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#333}.map-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{--border-width: 1px;--border-style: solid;--border-color: var(--ion-color-primary);height:32px}.map-container[_ngcontent-%COMP%]{position:relative;width:100%;height:250px;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026;margin:1rem 0;border:1px solid #e0e0e0}.map-canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:8px}.map-loading[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#f8f9fa;color:#6c757d;border-radius:8px}.map-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:1rem;--color: var(--ion-color-primary)}.map-error[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#fff8e1;color:#f57c00;border-radius:8px;text-align:center}.map-error[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.map-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:.9rem}.scheduling-info[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:8px;padding:12px;margin:8px 0;border-left:4px solid var(--ion-color-primary)}.scheduling-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;color:var(--ion-color-primary)}.pickup-schedule[_ngcontent-%COMP%]{margin-bottom:20px}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e8f5e8,#c8e6c8);border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;border-left:4px solid var(--ion-color-success)}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;color:var(--ion-color-success);font-size:16px;font-weight:600}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   .schedule-time[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:700;color:var(--ion-color-success-shade)}.pickup-info[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:8px;padding:16px;margin:16px 0}.pickup-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:var(--ion-color-success);font-size:16px;font-weight:600;border-bottom:1px solid var(--ion-color-success);padding-bottom:8px}.pickup-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;display:flex;align-items:center;gap:8px}.pickup-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-success);min-width:20px}.pickup-instructions[_ngcontent-%COMP%]{background:#f2f295;border-radius:8px;padding:16px;margin:16px 0;border-left:4px solid var(--ion-color-warning)}.pickup-instructions[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:var(--ion-color-warning-shade);font-size:16px;font-weight:600}.pickup-instructions[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent}.pickup-instructions[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--inner-padding-end: 0;--padding-start: 0}.pickup-instructions[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.4}.pickup-instructions[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--ion-color-warning-shade)}.delivery-info[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:8px;padding:12px;margin:12px 0}.delivery-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;display:flex;align-items:center;gap:8px;font-size:14px}.delivery-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{min-width:20px}[_ngcontent-%COMP%]:global(.custom-div-icon){background:#fff;border:2px solid #ddd;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px #0003}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:200px;margin:.75rem 0}.map-controls[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.delivery-info[_ngcontent-%COMP%]{padding:.5rem;font-size:.85rem}}@media (max-width: 480px){.map-container[_ngcontent-%COMP%]{height:180px}.ticket-container[_ngcontent-%COMP%]{margin:10px;padding:12px}}']}),l})();var re=m(421);const ae=o=>[o,"MXN","symbol-narrow","1.2-2","en-US"],se=()=>[1,1,1,1,1,1,1,1];function ce(o,l){if(1&o){const i=e.RV6();e.j41(0,"ion-button",8),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.clearFilters())}),e.EFF(1," Quitar Filtros "),e.nrm(2,"ion-icon",4),e.k0s()}}function le(o,l){if(1&o&&(e.j41(0,"div",13)(1,"strong"),e.nrm(2,"ion-icon",22),e.EFF(3),e.nI1(4,"date"),e.k0s()()),2&o){const i=e.XpG().$implicit;e.R7$(3),e.SpI(" Fecha de entrega: ",e.i5U(4,1,null!=i.fecha_entrega&&i.fecha_entrega.toDate?i.fecha_entrega.toDate():i.fecha_entrega,"dd/MM/yyyy HH:mm")," ")}}function de(o,l){if(1&o){const i=e.RV6();e.j41(0,"ion-item-option",23),e.bIt("click",function(){e.eBV(i);const n=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.cancelarPedido(n))}),e.nrm(1,"ion-icon",24),e.EFF(2," Cancelar "),e.k0s()}}function pe(o,l){if(1&o){const i=e.RV6();e.j41(0,"ion-list")(1,"ion-item-sliding",10)(2,"ion-item")(3,"ion-label")(4,"div",11)(5,"h2"),e.nrm(6,"ion-icon",12),e.EFF(7),e.nI1(8,"currency"),e.k0s()(),e.j41(9,"div",13)(10,"strong"),e.nrm(11,"ion-icon",14),e.EFF(12),e.k0s(),e.j41(13,"strong",15),e.nrm(14,"ion-icon",16),e.EFF(15),e.k0s()(),e.DNE(16,le,5,4,"div",17),e.j41(17,"ion-chip",18)(18,"ion-label"),e.EFF(19),e.k0s()()()(),e.j41(20,"ion-item-options")(21,"ion-item-option",19),e.bIt("click",function(){const n=e.eBV(i).$implicit,a=e.XpG(2);return e.Njj(a.openPedidoDetalle(n))}),e.nrm(22,"ion-icon",20),e.EFF(23," Ver Detalle "),e.k0s(),e.DNE(24,de,3,0,"ion-item-option",21),e.k0s()()()}if(2&o){const i=l.$implicit,t=e.XpG(2);e.R7$(7),e.SpI(" ",e.iJd(8,8,e.eq3(14,ae,i.total))," MXN "),e.R7$(5),e.SpI(" Cliente: ",i.nombre_cliente,""),e.R7$(2),e.Y8G("color",t.getColorIcon(i.estatus))("name",t.getStatusIcon(i.estatus)),e.R7$(),e.SpI(" ",i.estatus," "),e.R7$(),e.Y8G("ngIf","en espera de recolecci\xf3n"===i.estatus.toLowerCase()),e.R7$(3),e.JRh(i.tipo_pago),e.R7$(5),e.Y8G("ngIf","cancelado"!==i.estatus.toLowerCase()&&"entregado"!==i.estatus.toLowerCase())}}function ue(o,l){if(1&o&&(e.qex(0),e.DNE(1,pe,25,16,"ion-list",9),e.bVm()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.pedidosFiltrados)}}function ge(o,l){1&o&&(e.j41(0,"ion-item",10)(1,"ion-avatar",26),e.nrm(2,"ion-skeleton-text",27),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",28),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",29),e.k0s()()())}function me(o,l){1&o&&(e.j41(0,"ion-list"),e.DNE(1,ge,8,0,"ion-item",25),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,se)))}function fe(o,l){1&o&&(e.j41(0,"div",30),e.nrm(1,"ion-icon",31),e.j41(2,"h3"),e.EFF(3,"No hay pedidos disponibles"),e.k0s()())}const he=[{path:"",component:(()=>{var o;class l{constructor(t,n){this.modalCtrl=t,this.alertController=n,this.showModal=!1,this.isEditing=!1,this.pedidos=[],this.detalle_pedido=[],this.loading=!1,this.searchTerm="",this.filtersApplied=!1,this.pedidosFiltrados=[],this.utilsSvc=(0,e.WQX)(k.T),this.firebaseSvc=(0,e.WQX)(I.f),this.fecha=(new Date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}ngOnInit(){this.fecha=this.fecha.charAt(0).toUpperCase()+this.fecha.slice(1),this.getPedidos()}user(){return this.utilsSvc.getFromLocalStorage("user")}doRefresh(t){setTimeout(()=>{this.getPedidos(),t.target.complete()},1e3)}getPedidos(){var t=this;this.loading=!0;let a=new Date;a.setHours(0,0,0,0);let r=this.firebaseSvc.getCollectionData("pedidos",[]).subscribe({next:(s=(0,f.A)(function*(c){if(Array.isArray(c)){t.pedidos=c;const h=(yield Promise.all(t.pedidos.map(function(){var p=(0,f.A)(function*(u){u.nombre_cliente=t.user().name+" "+t.user().mother_Last_Name+" "+t.user().father_Last_Name;const C=`pedidos/${u.id}/detalle_pedido`;return yield new Promise(y=>{var M;t.firebaseSvc.getCollectionData(C,[]).subscribe({next:(M=(0,f.A)(function*(w){u.detalle_pedido=w,yield Promise.all(u.detalle_pedido.map(function(){var T=(0,f.A)(function*(x){const Ce=`productos/${x.uid_producto}`;try{let F=yield t.firebaseSvc.getDocument(Ce);x.producto=F,x.producto.imagen=F.imagen}catch{}});return function(x){return T.apply(this,arguments)}}())),y()}),function(T){return M.apply(this,arguments)}),error:M=>{console.error("Error al obtener datos:",M),y()}})}),u});return function(u){return p.apply(this,arguments)}}()))).filter(p=>{if(p.uid_cliente!==t.user().uid||!p.fecha_entrega)return!1;const u=p.fecha_entrega.toDate?p.fecha_entrega.toDate():new Date(p.fecha_entrega);return u.setHours(0,0,0,0),u.getTime()===a.getTime()});t.pedidosFiltrados=h.sort((p,u)=>{var v,C;const y=null!==(v=p.fecha_entrega)&&void 0!==v&&v.toDate?p.fecha_entrega.toDate():new Date(p.fecha_entrega);return(null!==(C=u.fecha_entrega)&&void 0!==C&&C.toDate?u.fecha_entrega.toDate():new Date(u.fecha_entrega)).getTime()-y.getTime()}),t.loading=!1}else t.pedidos=[],t.pedidosFiltrados=[],t.loading=!1;r.unsubscribe()}),function(g){return s.apply(this,arguments)}),error:s=>{this.loading=!1}});var s}closeModal(){this.showModal=!1}refreshOrders(){this.getPedidos()}openFilterModal(){var t=this;return(0,f.A)(function*(){const a=yield t.modalCtrl.create({component:re.w,componentProps:{estatus:!0}});yield a.present();const{data:r}=yield a.onDidDismiss();r&&t.applyFilter(r)})()}applyFilter(t){this.filtersApplied=!0,this.pedidosFiltrados=this.pedidos.filter(n=>{if(n.uid_cliente!==this.user().uid||t.selectedStatus&&t.selectedStatus.length&&!t.selectedStatus.includes(n.estatus))return!1;if(t.fechaInicio||t.fechaFin){var a;const s=(null!==(a=n.fecha_entrega)&&void 0!==a&&a.toDate?n.fecha_entrega.toDate():new Date(n.fecha_entrega)).toISOString().slice(0,10);if(t.fechaInicio&&s<t.fechaInicio||t.fechaFin&&s>t.fechaFin)return!1}return!(null!=t.precioMin&&n.total<t.precioMin||null!=t.precioMax&&n.total>t.precioMax)}),this.loading=!1}clearFilters(){const t=new Date;t.setHours(0,0,0,0);const n=this.pedidos.filter(r=>{if(r.uid_cliente!==this.user().uid||!r.fecha_entrega)return!1;const s=r.fecha_entrega.toDate?r.fecha_entrega.toDate():new Date(r.fecha_entrega);return s.setHours(0,0,0,0),s.getTime()===t.getTime()});this.pedidosFiltrados=n.sort((r,s)=>{var c,g;const h=null!==(c=r.fecha_entrega)&&void 0!==c&&c.toDate?r.fecha_entrega.toDate():new Date(r.fecha_entrega);return(null!==(g=s.fecha_entrega)&&void 0!==g&&g.toDate?s.fecha_entrega.toDate():new Date(s.fecha_entrega)).getTime()-h.getTime()});const a=this.pedidosFiltrados.map(r=>this.firebaseSvc.getDocument(`users/${r.uid_cliente}`).then(c=>(r.nombre_cliente=c.name+" "+c.mother_Last_Name+" "+c.father_Last_Name,r)));Promise.all(a).then(r=>{this.pedidosFiltrados=r,this.filtersApplied=!1}).catch(r=>{console.error("Error al obtener nombres de clientes:",r),this.filtersApplied=!1})}filterPedidos(){const t=this.searchTerm.toLowerCase();this.pedidosFiltrados=this.pedidos.filter(n=>n.nombre_cliente.toLowerCase().includes(t)||n.total.toFixed(2).includes(t)||n.id.toLowerCase().includes(t)||n.estatus.toLowerCase().includes(t))}getStatusIcon(t){switch(t.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}cancelarPedido(t){var n=this;return(0,f.A)(function*(){var r;yield(yield n.alertController.create({header:"Cancelar Pedido",mode:"ios",message:"\xbfRealmente deseas cancelar el pedido?",cssClass:"custom-alert",buttons:[{text:"Cancelar",role:"cancel",cssClass:"alert-cancel",handler:()=>{}},{text:"Confirmar",cssClass:"alert-confirm",handler:(r=(0,f.A)(function*(){let s=`pedidos/${t.id}`;const c=yield n.utilsSvc.loading();yield c.present(),t.estatus="Cancelado",n.firebaseSvc.updateDocumet(s,{estatus:t.estatus}).then(function(){var g=(0,f.A)(function*(h){n.utilsSvc.presentToast({message:"Pedido cancelado",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"})});return function(h){return g.apply(this,arguments)}}()).catch(g=>{n.utilsSvc.presentToast({message:g.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{c.dismiss()})}),function(){return r.apply(this,arguments)})}],backdropDismiss:!1})).present()})()}getColorIcon(t){switch(t.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}openPedidoDetalle(t){var n=this;return(0,f.A)(function*(){console.log("------------------"),console.log(t),(yield n.utilsSvc.presentModal({component:ie,componentProps:{pedido:t}}))&&n.utilsSvc.presentToast({message:"Pedido en preparaci\xf3n",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"}),n.getPedidos()})()}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(d.W3),e.rXU(d.hG))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-historial-pedidos"]],decls:12,vars:6,consts:[["title","Historial pedidos",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","animated","true","placeholder","Cliente, productos, precio o c\xf3digo",3,"ngModelChange","ionInput","ngModel"],["expand","block","color","primary",3,"click"],["name","filter-outline",2,"margin-left","0.5rem"],["expand","block","color","light",3,"click",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["expand","block","color","light",3,"click"],[4,"ngFor","ngForOf"],[1,"product-item"],[1,"name"],["slot","start","color","danger","name","cash-outline",2,"margin-right","2rem"],[1,"data"],["slot","start","name","person-outline"],[2,"margin-left","3rem"],["slot","start",3,"color","name"],["class","data",4,"ngIf"],["color","primary","mode","ios","outline","true"],["color","secondary",3,"click"],["name","eye-outline",1,"option-btn",2,"margin-right","0.5rem"],["color","danger",3,"click",4,"ngIf"],["slot","start","name","calendar-outline"],["color","danger",3,"click"],["name","close-circle-outline",1,"option-btn",2,"margin-right","0.5rem"],["class","product-item",4,"ngFor","ngForOf"],["slot","start"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(r){return n.doRefresh(r)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"ion-searchbar",2),e.mxI("ngModelChange",function(r){return e.DH7(n.searchTerm,r)||(n.searchTerm=r),r}),e.bIt("ionInput",function(){return n.filterPedidos()}),e.k0s(),e.j41(5,"ion-button",3),e.bIt("click",function(){return n.openFilterModal()}),e.EFF(6,"Filtros "),e.nrm(7,"ion-icon",4),e.k0s(),e.DNE(8,ce,3,0,"ion-button",5)(9,ue,2,1,"ng-container",6)(10,me,2,2,"ion-list",6)(11,fe,4,0,"div",7),e.k0s()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.R50("ngModel",n.searchTerm),e.R7$(4),e.Y8G("ngIf",n.filtersApplied),e.R7$(),e.Y8G("ngIf",n.pedidosFiltrados.length>0),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.pedidosFiltrados.length))},dependencies:[_.Sq,_.bT,P.BC,P.vS,d.mC,d.Jm,d.ZB,d.W9,d.iq,d.uz,d.LU,d.CE,d.A7,d.he,d.nf,d.To,d.Ki,d.S1,d.ds,d.Gw,E.l,_.oe,_.vh]}),l})()}];let _e=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[O.iI.forChild(he),O.iI]}),l})();var ve=m(7383);let Pe=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[_.MD,P.YN,d.bv,_e,ve.G]}),l})()}}]);