"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7007],{7007:(ie,k,u)=>{u.r(k),u.d(k,{SignUpPageModule:()=>ne});var P=u(177),a=u(9417),d=u(5933),S=u(8265),p=u(467),e=u(4438),x=u(1471),U=u(1626),N=u(8663),T=u(2723),L=u(1876),F=u(7157),j=u(8827),G=u(5621);function R(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function C(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"Ingrese un nombre con al menos 4 caracteres"),e.k0s())}function D(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"El nombre no puede exceder 30 caracteres"),e.k0s())}function $(n,l){if(1&n&&(e.j41(0,"div",18),e.DNE(1,R,2,0,"div",13)(2,C,2,0,"div",13)(3,D,2,0,"div",13),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.minLenght),e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.maxlength)}}function M(n,l){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function A(n,l){1&n&&(e.j41(0,"div"),e.EFF(1," No puede exceder 30 caracteres "),e.k0s())}function Y(n,l){if(1&n&&(e.j41(0,"div",18),e.DNE(1,M,2,0,"div",13)(2,A,2,0,"div",13),e.k0s()),2&n){const i=e.XpG(2);e.R7$(),e.Y8G("ngIf",null==i.form.controls.father_Last_Name.errors?null:i.form.controls.father_Last_Name.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.father_Last_Name.errors?null:i.form.controls.father_Last_Name.errors.maxlength)}}function B(n,l){1&n&&(e.j41(0,"div"),e.EFF(1," Este campo es requerido "),e.k0s())}function V(n,l){1&n&&(e.j41(0,"div"),e.EFF(1," No puede exceder 30 caracteres "),e.k0s())}function J(n,l){if(1&n&&(e.j41(0,"div",18),e.DNE(1,B,2,0,"div",13)(2,V,2,0,"div",13),e.k0s()),2&n){const i=e.XpG(2);e.R7$(),e.Y8G("ngIf",null==i.form.controls.mother_Last_Name.errors?null:i.form.controls.mother_Last_Name.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.mother_Last_Name.errors?null:i.form.controls.mother_Last_Name.errors.maxlength)}}function z(n,l){if(1&n){const i=e.RV6();e.j41(0,"div")(1,"app-custom-input",19),e.bIt("ionInput",function(r){e.eBV(i);const t=e.XpG();return e.Njj(t.onLastNameInput(r,"father_Last_Name"))})("keydown",function(r){e.eBV(i);const t=e.XpG();return e.Njj(t.preventExtraInput(r,30))}),e.k0s(),e.DNE(2,Y,3,2,"div",12),e.j41(3,"app-custom-input",20),e.bIt("ionInput",function(r){e.eBV(i);const t=e.XpG();return e.Njj(t.onLastNameInput(r,"mother_Last_Name"))})("keydown",function(r){e.eBV(i);const t=e.XpG();return e.Njj(t.preventExtraInput(r,30))}),e.k0s(),e.DNE(4,J,3,2,"div",12),e.k0s()}if(2&n){const i=e.XpG();e.R7$(),e.Y8G("control",i.form.controls.father_Last_Name),e.R7$(),e.Y8G("ngIf",i.form.controls.father_Last_Name.errors&&i.form.controls.father_Last_Name.dirty),e.R7$(),e.Y8G("control",i.form.controls.mother_Last_Name),e.R7$(),e.Y8G("ngIf",i.form.controls.mother_Last_Name.errors&&i.form.controls.mother_Last_Name.dirty)}}function W(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"El correo es requerido"),e.k0s())}function X(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"Ingrese un correo valido"),e.k0s())}function q(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"El correo no puede exceder 30 caracteres"),e.k0s())}function Z(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"Este correo electr\xf3nico no existe"),e.k0s())}function K(n,l){if(1&n&&(e.j41(0,"div",18),e.DNE(1,W,2,0,"div",13)(2,X,2,0,"div",13)(3,q,2,0,"div",13)(4,Z,2,0,"div",13),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.email.errors?null:i.form.controls.email.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.email.errors?null:i.form.controls.email.errors.email),e.R7$(),e.Y8G("ngIf",null==i.form.controls.email.errors?null:i.form.controls.email.errors.maxlength),e.R7$(),e.Y8G("ngIf",null==i.form.controls.email.errors?null:i.form.controls.email.errors.emailNotExists)}}function Q(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"La contrase\xf1a es requerida"),e.k0s())}function H(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"La contrase\xf1a debe tener por lo menos 6 caracteres"),e.k0s())}function O(n,l){1&n&&(e.j41(0,"div"),e.EFF(1,"La contrase\xf1a no puede exceder 30 caracteres"),e.k0s())}function ee(n,l){if(1&n&&(e.j41(0,"div",18),e.DNE(1,Q,2,0,"div",13)(2,H,2,0,"div",13)(3,O,2,0,"div",13),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.password.errors?null:i.form.controls.password.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.password.errors?null:i.form.controls.password.errors.minLength),e.R7$(),e.Y8G("ngIf",null==i.form.controls.password.errors?null:i.form.controls.password.errors.maxlength)}}const re=[{path:"",component:(()=>{var n;class l{constructor(o){this.navCtrl=o,this.firebaseSvc=(0,e.WQX)(N.f),this.utilsSvc=(0,e.WQX)(T.T),this.emailSvc=(0,e.WQX)(L._),this.http=(0,e.WQX)(U.Qq),this.consultory=[],this.isTaqueriaChecked=!1,this.nameLabel="Nombre",this.form=new a.gE({uid:new a.MJ(""),email:new a.MJ("",[a.k0.required,a.k0.email,a.k0.maxLength(30)]),password:new a.MJ("",[a.k0.required,a.k0.minLength(6),a.k0.maxLength(30)]),name:new a.MJ(null,[a.k0.required,a.k0.maxLength(30)]),mother_Last_Name:new a.MJ("",[a.k0.maxLength(30)]),father_Last_Name:new a.MJ("",[a.k0.maxLength(30)]),email_verified:new a.MJ(""),password_Change:new a.MJ(""),image:new a.MJ(""),type_profile:new a.MJ,active_user:new a.MJ("1"),isBusiness:new a.MJ(!1)}),this.form_carrito=new a.gE({total:new a.MJ(0)}),this.form_carrito_eventos=new a.gE({total:new a.MJ(0)}),this.form_carrito_negocio=new a.gE({total:new a.MJ(0)})}ngOnInit(){}preventExtraInput(o,r){if(!o||!o.target)return!0;const t=o.target.value?o.target.value.length:0;return!(!(o.ctrlKey&&o.key&&["a","c","v","x","z"].includes(o.key.toLowerCase()))&&!["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(o.key)&&t>=r&&(o.preventDefault(),1))}onIsBusinessChange(o){this.isTaqueriaChecked=o.detail.checked,this.nameLabel=this.isTaqueriaChecked?"Nombre del negocio":"Nombre"}onNameInput(o){if(!o||!o.target)return;let r=o.target.value||"";r.length>30&&(r=r.substring(0,30),o.target.value=r),r=r.replace(/[^a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]/g,""),r.length>30&&(r=r.substring(0,30)),this.form&&this.form.controls&&this.form.controls.name&&this.form.controls.name.setValue(r),o.target.value=r}onLastNameInput(o,r){if(!o||!o.target||!r)return;let t=o.target.value||"";t.length>30&&(t=t.substring(0,30),o.target.value=t),t=t.replace(/[^a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]/g,""),t.length>30&&(t=t.substring(0,30)),this.form&&this.form.controls&&this.form.controls[r]&&this.form.controls[r].setValue(t),o.target.value=t}onEmailInput(o){var r=this;return(0,p.A)(function*(){if(!o||!o.target)return;let t=o.target.value||"";if(t.length>30)return t=t.substring(0,30),o.target.value=t,void(r.form&&r.form.controls&&r.form.controls.email&&r.form.controls.email.setValue(t));if(t=t.replace(/[^a-zA-Z0-9@._-]/g,""),t.length>30&&(t=t.substring(0,30)),r.form&&r.form.controls&&r.form.controls.email&&r.form.controls.email.setValue(t),o.target.value=t,t.includes("@")&&t.includes(".")&&t.length>5)try{yield r.verifyEmailExists(t)}catch(s){console.error("Error verifying email:",s)}})()}onPasswordInput(o){if(!o||!o.target)return;let r=o.target.value||"";r.length>30&&(r=r.substring(0,30),o.target.value=r),r=r.replace(/\s/g,""),r.length>30&&(r=r.substring(0,30)),this.form&&this.form.controls&&this.form.controls.password&&this.form.controls.password.setValue(r),o.target.value=r}verifyEmailExists(o){var r=this;return(0,p.A)(function*(){try{if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o))return!1;const f=`https://api.hunter.io/v2/email-verifier?email=${o}&api_key=your-api-key`,g=yield r.http.get(f).toPromise();if(g.data&&g.data.result){const _="deliverable"===g.data.result;if(_){const m=r.form.controls.email.errors;m&&m.emailNotExists&&(delete m.emailNotExists,r.form.controls.email.setErrors(Object.keys(m).length?m:null))}else r.form.controls.email.setErrors({emailNotExists:!0});return _}return!1}catch(t){return console.error("Error verifying email:",t),yield r.validateEmailWithSimpleAPI(o)}})()}validateEmailWithSimpleAPI(o){var r=this;return(0,p.A)(function*(){try{var t;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o))return r.form.controls.email.setErrors({emailNotExists:!0}),!1;const f=["gmail.com","yahoo.com","hotmail.com","outlook.com","live.com","icloud.com","protonmail.com","aol.com"],y=null===(t=o.split("@")[1])||void 0===t?void 0:t.toLowerCase();if(!f.includes(y))return r.form.controls.email.setErrors({emailNotExists:!0}),!1;const g=o.split("@")[0];if(g.length<3||g.length>25)return r.form.controls.email.setErrors({emailNotExists:!0}),!1;const _=[/^[a-z]{8,}$/i,/^[0-9]{4,}$/,/^(.)\1{3,}/,/test|fake|dummy|example/i];for(const b of _)if(b.test(g))return r.form.controls.email.setErrors({emailNotExists:!0}),!1;const m=r.form.controls.email.errors;return m&&m.emailNotExists&&(delete m.emailNotExists,r.form.controls.email.setErrors(Object.keys(m).length?m:null)),!0}catch(s){return console.error("Error in simple email validation:",s),!1}})()}checkEmailExists(o){var r=this;return(0,p.A)(function*(){try{return yield r.firebaseSvc.checkEmailExists(o)}catch(t){return console.error("Error checking email:",t),!1}})()}validateEmailWithAPI(o){var r=this;return(0,p.A)(function*(){return yield r.verifyEmailExists(o)})()}encryptPassword(o){const t=x.lib.WordArray.random(16),s=x.PBKDF2("MiTortilleria2024#SecureKey!@#$",t,{keySize:8,iterations:1e3}),f=x.AES.encrypt(o,s.toString()).toString();return t.toString()+":"+f}submit(){var o=this;return(0,p.A)(function*(){if(o.form.valid){const t=yield o.utilsSvc.loading();yield t.present();try{const s=o.form.value.email;if(!(yield o.validateEmailWithAPI(s)))throw new Error("El correo electr\xf3nico no es v\xe1lido o no existe");if(yield o.checkEmailExists(s))throw new Error("Este correo electr\xf3nico ya est\xe1 registrado. Por favor, usa otro correo");const _=o.encryptPassword(o.form.value.password),m=yield o.firebaseSvc.signUp(o.form.value);yield o.firebaseSvc.updateUser(o.form.value.name);let b=m.user.uid;o.form.controls.uid.setValue(b),o.form.controls.email_verified.setValue("1"),o.form.controls.password_Change.setValue(_),o.form.controls.type_profile.setValue(3),yield o.sendWelcomeEmail(),yield o.setUserInfo(b),yield o.initializeUserData(b),o.utilsSvc.presentToast({message:`\xa1Bienvenido ${o.form.value.name}! Revisa tu correo`,duration:2500,color:"success",icon:"person-outline"}),o.navCtrl.navigateForward("/main/productos")}catch(s){let f="Error en el registro";s.message?f=s.message:"auth/email-already-in-use"===s.code?f="Este correo electr\xf3nico ya est\xe1 registrado":"auth/weak-password"===s.code?f="La contrase\xf1a es muy d\xe9bil":"auth/invalid-email"===s.code&&(f="El formato del correo electr\xf3nico no es v\xe1lido"),o.utilsSvc.presentToast({message:f,duration:3e3,color:"danger",icon:"alert-circle-outline"})}finally{t.dismiss()}}else{var r;null!==(r=o.form.controls.email.errors)&&void 0!==r&&r.emailNotExists&&o.utilsSvc.presentToast({message:"Por favor, ingresa un correo electr\xf3nico v\xe1lido y existente",duration:3e3,color:"warning",icon:"mail-outline"})}})()}sendWelcomeEmail(){var o=this;return(0,p.A)(function*(){try{const r={customerName:o.form.controls.name.value,customerEmail:o.form.controls.email.value,registrationDate:new Date,isBusiness:o.form.controls.isBusiness.value};console.log("Enviando email de bienvenida:",r),yield o.emailSvc.sendWelcomeEmail(r)}catch(r){console.error("Error sending welcome email:",r)}})()}initializeUserData(o){var r=this;return(0,p.A)(function*(){if(o)try{let s=r.firebaseSvc.obtenerColeccion(`users/${o}/terms`).subscribe({next:c=>{r.utilsSvc.saveInLocalStorage("terms",c),s.unsubscribe()},error:c=>{console.error("Error getting terms:",c),s.unsubscribe()}}),y=r.firebaseSvc.getCollectionData(`users/${o}/Address`,[]).subscribe({next:c=>{r.direccion=c,r.utilsSvc.setElementInLocalstorage("direccion",r.direccion),y.unsubscribe()},error:c=>{console.error("Error getting address:",c),y.unsubscribe()}}),g=`users/${o}/carrito`;yield r.firebaseSvc.addDocument(g,r.form_carrito.value);let _=r.firebaseSvc.getCollectionData(g,[]).subscribe({next:c=>{if(r.carrito=c,r.carrito&&r.carrito.length>0&&r.carrito[0].id){let v=r.firebaseSvc.obtenerColeccion(`users/${o}/carrito/${r.carrito[0].id}/detalle_carrito`).subscribe({next:h=>{r.carrito[0].detalle_carrito=h,r.utilsSvc.setElementInLocalstorage("carrito",r.carrito),v.unsubscribe()},error:h=>{console.error("Error getting carrito details:",h),v.unsubscribe()}})}_.unsubscribe()},error:c=>{console.error("Error getting carrito:",c),_.unsubscribe()}}),m=`users/${o}/carrito_eventos`;yield r.firebaseSvc.addDocument(m,r.form_carrito_eventos.value);let b=r.firebaseSvc.getCollectionData(m,[]).subscribe({next:c=>{if(r.carrito_eventos=c,r.carrito_eventos&&r.carrito_eventos.length>0&&r.carrito_eventos[0].id){let v=r.firebaseSvc.obtenerColeccion(`users/${o}/carrito_eventos/${r.carrito_eventos[0].id}/detalle_carrito`).subscribe({next:h=>{r.carrito_eventos[0].detalle_carrito=h,r.utilsSvc.setElementInLocalstorage("carrito_eventos",r.carrito_eventos),v.unsubscribe()},error:h=>{console.error("Error getting carrito eventos details:",h),v.unsubscribe()}})}b.unsubscribe()},error:c=>{console.error("Error getting carrito eventos:",c),b.unsubscribe()}});if(r.form.value.isBusiness){let c=`users/${o}/carrito_negocio`;yield r.firebaseSvc.addDocument(c,r.form_carrito_negocio.value);let E=r.firebaseSvc.getCollectionData(c,[]).subscribe({next:v=>{if(r.carrito_negocio=v,r.carrito_negocio&&r.carrito_negocio.length>0&&r.carrito_negocio[0].id){let w=r.firebaseSvc.obtenerColeccion(`users/${o}/carrito_negocio/${r.carrito_negocio[0].id}/detalle_carrito`).subscribe({next:I=>{r.carrito_negocio[0].detalle_carrito=I,r.utilsSvc.setElementInLocalstorage("carrito_negocio",r.carrito_negocio),w.unsubscribe()},error:I=>{console.error("Error getting carrito negocio details:",I),w.unsubscribe()}})}E.unsubscribe()},error:v=>{console.error("Error getting carrito negocio:",v),E.unsubscribe()}})}}catch(t){console.error("Error initializing user data:",t)}else console.error("UID is required for initializing user data")})()}setUserInfo(o){var r=this;return(0,p.A)(function*(){if(o){if(r.form&&r.form.valid)try{let t=`users/${o}`,s={...r.form.value};delete s.password,yield r.firebaseSvc.setDocument(t,s),r.utilsSvc.saveInLocalStorage("user",s),r.form.reset()}catch(t){console.error("Error setting user info:",t)}}else console.error("UID is required for setting user info")})()}}return(n=l).\u0275fac=function(o){return new(o||n)(e.rXU(F.q9))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-sign-up"]],decls:29,vars:11,consts:[[1,"ion-no-border"],["color","primary"],["slot","start"],["defaultHref","/inicio","routerLink","/inicio","routerDirection","root"],[2,"display","inline-flex"],["src","../../../../assets/img/Logo.png","alt","",2,"width","85px","margin-top","10px","margin-bottom","10px","margin-left","10px","border-radius","50%"],[1,"admin"],[1,"d-flex-center"],[1,"auth-form",3,"ngSubmit","keypress.enter","formGroup"],["slot","start",2,"white-space","nowrap"],["slot","end","mode","ios","formControlName","isBusiness",3,"ngModelChange","ionChange","ngModel"],["autocomplete","name","icon","person-circle-outline","type","text","maxlength","30",3,"ionInput","keydown","control","label"],["class","validators",4,"ngIf"],[4,"ngIf"],["autocomplete","email","icon","mail-outline","type","email","label","Correo","maxlength","30",3,"ionInput","keydown","control"],["icon","lock-closed-outline","type","password","label","Contrase\xf1a","maxlength","30",3,"ionInput","keydown","control"],["expand","block","mode","ios","type","submit",1,"submit",3,"disabled"],["slot","end","name","person-add-outline"],[1,"validators"],["autocomplete","family-name","icon","person-circle-outline","type","text","label","Apellido Paterno","maxlength","30",3,"ionInput","keydown","control"],["autocomplete","family-name","icon","person-circle-outline","type","text","label","Apellido Materno","maxlength","30",3,"ionInput","keydown","control"]],template:function(o,r){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"div",4),e.nrm(5,"img",5),e.j41(6,"ion-title")(7,"strong"),e.EFF(8,"Registrar"),e.k0s(),e.j41(9,"div",6),e.EFF(10,"Tortilleria Plata Jaimes"),e.k0s()()()()(),e.j41(11,"ion-content")(12,"div",7)(13,"form",8),e.bIt("ngSubmit",function(){return r.submit()})("keypress.enter",function(){return r.submit()}),e.nrm(14,"app-logo"),e.j41(15,"ion-item")(16,"ion-label",9),e.EFF(17,"\xbfEs una taquer\xeda o negocio?"),e.k0s(),e.j41(18,"ion-checkbox",10),e.mxI("ngModelChange",function(s){return e.DH7(r.isTaqueriaChecked,s)||(r.isTaqueriaChecked=s),s}),e.bIt("ionChange",function(s){return r.onIsBusinessChange(s)}),e.k0s()(),e.j41(19,"app-custom-input",11),e.bIt("ionInput",function(s){return r.onNameInput(s)})("keydown",function(s){return r.preventExtraInput(s,30)}),e.k0s(),e.DNE(20,$,4,3,"div",12)(21,z,5,4,"div",13),e.j41(22,"app-custom-input",14),e.bIt("ionInput",function(s){return r.onEmailInput(s)})("keydown",function(s){return r.preventExtraInput(s,30)}),e.k0s(),e.DNE(23,K,5,4,"div",12),e.j41(24,"app-custom-input",15),e.bIt("ionInput",function(s){return r.onPasswordInput(s)})("keydown",function(s){return r.preventExtraInput(s,30)}),e.k0s(),e.DNE(25,ee,4,3,"div",12),e.j41(26,"ion-button",16),e.EFF(27," Registrar "),e.nrm(28,"ion-icon",17),e.k0s()()()()),2&o&&(e.R7$(13),e.Y8G("formGroup",r.form),e.R7$(5),e.R50("ngModel",r.isTaqueriaChecked),e.R7$(),e.Y8G("control",r.form.controls.name)("label",r.nameLabel),e.R7$(),e.Y8G("ngIf",r.form.controls.name.errors&&r.form.controls.name.touched),e.R7$(),e.Y8G("ngIf",!r.isTaqueriaChecked),e.R7$(),e.Y8G("control",r.form.controls.email),e.R7$(),e.Y8G("ngIf",r.form.controls.email.errors&&r.form.controls.email.touched),e.R7$(),e.Y8G("control",r.form.controls.password),e.R7$(),e.Y8G("ngIf",r.form.controls.password.errors&&r.form.controls.password.touched),e.R7$(),e.Y8G("disabled",r.form.invalid))},dependencies:[P.bT,a.qT,a.BC,a.cb,d.Jm,d.QW,d.eY,d.W9,d.eU,d.iq,d.uz,d.he,d.BC,d.ai,d.hB,d.el,d.N7,S.Wk,j.H,G.Z,a.j4,a.JD],styles:["h1[_ngcontent-%COMP%]{color:#fff}"]}),l})()}];let oe=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[S.iI.forChild(re),S.iI]}),l})();var te=u(7383);let ne=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[P.MD,a.YN,d.bv,oe,te.G]}),l})()}}]);