"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5285],{5285:(G,P,d)=>{d.r(P),d.d(P,{HomePageModule:()=>E});var g=d(177),c=d(9417),a=d(5933),y=d(8265),p=d(467),e=d(4438),_=d(7517),k=d(2723);let F=(()=>{var i;class s{constructor(){this.product=null,this.form=new c.gE({id:new c.MJ(""),image:new c.MJ("",[c.k0.required]),name:new c.MJ("",[c.k0.required,c.k0.minLength(4)]),price:new c.MJ(null,[c.k0.required,c.k0.min(0)]),soldUnits:new c.MJ(null,[c.k0.required,c.k0.min(0)])}),this.firebaseSvc=(0,e.WQX)(_.f),this.utilSvc=(0,e.WQX)(k.T)}ngOnInit(){this.product&&this.form.patchValue({...this.product})}takePicture(){var t=this;return(0,p.A)(function*(){const o=(yield t.utilSvc.takePicture("Imagen del producto")).dataUrl;t.form.controls.image.setValue(o)})()}submit(){var t=this;return(0,p.A)(function*(){t.form.valid&&(t.product?yield t.updateProduct():yield t.createProduct())})()}createProduct(){var t=this;return(0,p.A)(function*(){const o=yield t.utilSvc.loading();yield o.present();try{const r="productos";let l="";if(t.form.value.image){const u=`productos/${Date.now()}`;l=yield t.firebaseSvc.uploadImage(u,t.form.value.image),t.form.controls.image.setValue(l)}const m={...t.form.value,image:l};yield t.firebaseSvc.addDocumentWithUid(r,m),t.utilSvc.presentToast({message:"Usuario creado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),t.utilSvc.dismissModal({success:!0})}catch(r){t.utilSvc.presentToast({message:r.message,duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}finally{o.dismiss()}})()}updateProduct(){var t=this;return(0,p.A)(function*(){const o=yield t.utilSvc.loading();yield o.present();try{var r,l;const m=`productos/${null===(r=t.product)||void 0===r?void 0:r.id}`;if(console.log("Ruta para actualizar usuario:",m),t.form.value.image&&t.form.value.image!==(null===(l=t.product)||void 0===l?void 0:l.image)){const h=`prodcutos/${Date.now()}`,v=yield t.firebaseSvc.uploadImage(h,t.form.value.image);t.form.controls.image.setValue(v)}const u={...t.form.value};delete u.id,console.log("Datos a actualizar:",u),yield t.firebaseSvc.updateDocumet(m,u),t.utilSvc.presentToast({message:"Producto actualizado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),t.utilSvc.dismissModal({success:!0,data:u})}catch(m){t.utilSvc.presentToast({message:`Error al actualizar usuario: ${m.message}`,duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"}),console.error("Error al actualizar usuario:",m)}finally{o.dismiss()}})()}}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-add-update-product"]],inputs:{product:"product"},decls:0,vars:0,template:function(t,o){},styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),s})();var S=d(2784),b=d(8461);const f=i=>[i,"MXN","symbol","1.2-2","en-US"],x=()=>[1,1,1,1,1,1,1,1];function R(i,s){if(1&i&&(e.j41(0,"ion-card",8)(1,"div")(2,"h5"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5,"Productos"),e.k0s()(),e.j41(6,"div")(7,"h5"),e.EFF(8),e.nI1(9,"currency"),e.k0s(),e.j41(10,"p"),e.EFF(11,"Ganancias"),e.k0s()()()),2&i){const n=e.XpG();e.R7$(3),e.JRh(n.products.length),e.R7$(5),e.JRh(e.iJd(9,2,e.eq3(8,f,n.getProfits())))}}function j(i,s){if(1&i){const n=e.RV6();e.j41(0,"ion-item-sliding",10)(1,"ion-item")(2,"ion-avatar",11),e.nrm(3,"img",12),e.k0s(),e.j41(4,"ion-label")(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14)(8,"strong"),e.EFF(9,"Precio:"),e.k0s(),e.EFF(10),e.nI1(11,"currency"),e.nrm(12,"br"),e.j41(13,"strong"),e.EFF(14,"Unidades Vendidas:"),e.k0s(),e.EFF(15),e.k0s(),e.j41(16,"ion-chip",15)(17,"ion-label"),e.EFF(18),e.nI1(19,"currency"),e.k0s()()()(),e.j41(20,"ion-item-options")(21,"ion-item-option",6),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.addUpdateProduct(o))}),e.nrm(22,"ion-icon",16),e.k0s(),e.j41(23,"ion-item-option",17),e.bIt("click",function(){const o=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.confirmDeleteProduct(o))}),e.nrm(24,"ion-icon",18),e.k0s()()()}if(2&i){const n=s.$implicit;e.R7$(3),e.Y8G("src",n.image,e.B4B),e.R7$(3),e.JRh(n.name),e.R7$(4),e.SpI("",e.iJd(11,5,e.eq3(17,f,n.price))," "),e.R7$(5),e.SpI(" ",n.soldUnits," "),e.R7$(3),e.SpI("Ganancia: ",e.iJd(19,11,e.eq3(19,f,n.price*n.soldUnits)),"")}}function M(i,s){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,j,25,21,"ion-item-sliding",9),e.k0s()),2&i){const n=e.XpG();e.R7$(),e.Y8G("ngForOf",n.products)}}function H(i,s){1&i&&(e.j41(0,"ion-item",10)(1,"ion-avatar",11),e.nrm(2,"ion-skeleton-text",19),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",20),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",21),e.k0s()()())}function I(i,s){1&i&&(e.j41(0,"ion-list"),e.DNE(1,H,8,0,"ion-item",9),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,x)))}function T(i,s){1&i&&(e.j41(0,"div",22),e.nrm(1,"ion-icon",23),e.j41(2,"h3"),e.EFF(3,"No hay productos disponibles"),e.k0s()())}const U=[{path:"",component:(()=>{var i;class s{constructor(){this.firebaseSvc=(0,e.WQX)(_.f),this.utilSvc=(0,e.WQX)(k.T),this.products=[],this.loading=!1}ngOnInit(){}user(){return this.utilSvc.getFromLocalStorage("user")}ionViewWillEnter(){}doRefresh(t){setTimeout(()=>{this.getproducts(),t.target.complete()},1e3)}getProfits(){return this.products.reduce((t,o)=>t+o.price*o.soldUnits,0)}getproducts(){let t=`users/${this.user().uid}/products`;this.loading=!0;let o=[(0,S.My)("soldUnits","desc")],r=this.firebaseSvc.getCollectionData(t,o).subscribe({next:l=>{this.products=l,this.loading=!1,r.unsubscribe()}})}addUpdateProduct(t){var o=this;return(0,p.A)(function*(){(yield o.utilSvc.presentModal({component:F,cssClass:"add-update-modal",componentProps:{product:t}}))&&o.getproducts()})()}confirmDeleteProduct(t){var o=this;return(0,p.A)(function*(){yield o.utilSvc.presentAlert({header:"Eliminar Producto",message:"\xbfQuieres eliminar este producto?",mode:"ios",buttons:[{text:"Cancelar"},{text:"Confirmar",handler:()=>{o.deleteProduct(t)}}]})})()}deleteProduct(t){var o=this;return(0,p.A)(function*(){let r=`users/${o.user().uid}/products/${t.id}`;const l=yield o.utilSvc.loading();yield l.present();let m=yield o.firebaseSvc.getFilePath(t.image);yield o.firebaseSvc.deleteFile(m),o.firebaseSvc.deleteDocumet(r).then(function(){var u=(0,p.A)(function*(h){o.products=o.products.filter(v=>v.id!==t.id),o.utilSvc.presentToast({message:"Producto eliminado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(h){return u.apply(this,arguments)}}()).catch(u=>{o.utilSvc.presentToast({message:u.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{l.dismiss()})})()}}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-home"]],decls:11,vars:5,consts:[["title","Inicio",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","color","primary","class","d-flex-center ion-text-center",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["mode","ios","color","primary",1,"d-flex-center","ion-text-center"],["class","product-item",4,"ngFor","ngForOf"],[1,"product-item"],["slot","start"],[3,"src"],[1,"name"],[1,"data"],["color","primary","mode","ios","outline","true"],["name","create-outline",1,"option-btn"],["color","danger",3,"click"],["name","trash-outline",1,"option-btn"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(t,o){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(l){return o.doRefresh(l)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.DNE(4,R,12,10,"ion-card",2)(5,M,2,1,"ion-list",3)(6,I,2,2,"ion-list",3)(7,T,4,0,"div",4),e.j41(8,"ion-fab",5)(9,"ion-fab-button",6),e.bIt("click",function(){return o.addUpdateProduct()}),e.nrm(10,"ion-icon",7),e.k0s()()()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.Y8G("ngIf",!o.loading&&o.products.length),e.R7$(),e.Y8G("ngIf",!o.loading),e.R7$(),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",!o.loading&&!o.products.length))},dependencies:[g.Sq,g.bT,a.mC,a.b_,a.ZB,a.W9,a.Q8,a.YW,a.iq,a.uz,a.LU,a.CE,a.A7,a.he,a.nf,a.To,a.Ki,a.ds,b.l,g.oe],styles:["ion-card[_ngcontent-%COMP%]{gap:100px;padding:20px 0;border-radius:15px}ion-content[_ngcontent-%COMP%]{--padding-bottom: 70px}"]}),s})()}];let $=(()=>{var i;class s{}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[y.iI.forChild(U),y.iI]}),s})();var C=d(7383);let E=(()=>{var i;class s{}return(i=s).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[g.MD,c.YN,a.bv,$,C.G]}),s})()}}]);