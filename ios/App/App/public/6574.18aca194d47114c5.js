"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6574],{6574:(R,u,c)=>{c.r(u),c.d(u,{AdministracionPageModule:()=>G});var g=c(177),d=c(9417),l=c(5933),h=c(8265),_=c(467),e=c(4438),p=c(7517),P=c(2723),f=c(1517),b=c(8461);function k(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-col",12),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.sortTable("email"))}),e.EFF(1,"Correo"),e.k0s()}}function w(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-col",12),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.sortTable("image"))}),e.EFF(1,"Imagen"),e.k0s()}}function C(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-input",30),e.mxI("ngModelChange",function(i){e.eBV(a);const o=e.XpG(2).$implicit,r=e.XpG().$implicit;return e.DH7(r[o.key],i)||(r[o.key]=i),e.Njj(i)}),e.bIt("keyup.enter",function(){e.eBV(a);const i=e.XpG(4);return e.Njj(i.finishEditing())})("blur",function(){e.eBV(a);const i=e.XpG(4);return e.Njj(i.finishEditing())}),e.k0s()}if(2&n){const a=e.XpG(2).$implicit,t=e.XpG().$implicit;e.R50("ngModel",t[a.key])}}function A(n,s){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const a=e.XpG(2).$implicit,t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t[a.key]," ")}}function F(n,s){if(1&n&&(e.j41(0,"ion-col",27),e.DNE(1,C,1,1,"ion-input",28)(2,A,2,1,"span",29),e.k0s()),2&n){const a=e.XpG().$implicit,t=e.XpG().$implicit,i=e.XpG();e.R7$(),e.Y8G("ngIf",i.editingFieldKey===a.key&&i.editingField===t),e.R7$(),e.Y8G("ngIf",!(i.editingFieldKey===a.key&&i.editingField===t))}}function M(n,s){if(1&n&&(e.qex(0),e.DNE(1,F,3,2,"ion-col",26),e.bVm()),2&n){const a=s.$implicit,t=e.XpG(2);e.R7$(),e.Y8G("ngIf",t.shouldShowField(a.key)&&"image"!==a.key)}}function I(n,s){if(1&n&&(e.j41(0,"ion-col",31),e.nrm(1,"ion-img",32),e.k0s()),2&n){const a=e.XpG().$implicit;e.R7$(),e.Y8G("src",a.image)}}function y(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-button",33),e.bIt("click",function(){e.eBV(a);const i=e.XpG().$implicit,o=e.XpG();return e.Njj(o.deleteItem(i))}),e.nrm(1,"ion-icon",34),e.k0s()}}function T(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-row",20),e.DNE(1,M,2,1,"ng-container",21)(2,I,2,1,"ion-col",22),e.j41(3,"ion-col")(4,"ion-button",23),e.bIt("click",function(){const i=e.eBV(a).$implicit,o=e.XpG();return e.Njj(o.editItem(i))}),e.nrm(5,"ion-icon",24),e.k0s(),e.DNE(6,y,2,0,"ion-button",25),e.k0s()()}if(2&n){const a=s.$implicit,t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.fields),e.R7$(),e.Y8G("ngIf",t.showImage),e.R7$(4),e.Y8G("ngIf","cliente"===a.type_profile)}}const x=[{path:"",component:(()=>{var n;class s{constructor(t,i,o,r,m){this.modalCtrl=t,this.formBuilder=i,this.cdr=o,this.firebaseService=r,this.alertController=m,this.data=[],this.isModalOpen=!1,this.filteredData=[...this.data],this.editingField=null,this.editingFieldKey="",this.searchTerm="",this.utilsSvc=(0,e.WQX)(P.T),this.areColumnsVisible=!1,this.paginatedData=[],this.currentPage=1,this.itemsPerPage=10,this.totalPages=0,this.showNombre=!1,this.showTipoUsuario=!1,this.showApellidoPaterno=!1,this.showApellidoMaterno=!1,this.showEmail=!1,this.showImage=!1,this.firebaseSvc=(0,e.WQX)(p.f),this.fields=[{key:"name",label:"Nombre"},{key:"father_Last_Name",label:"Apellido paterno"},{key:"mother_Last_Name",label:"Apellido materno"},{key:"type_profile",label:"Tipo de usuario"},{key:"email",label:"Correo"},{key:"image",label:"Imagen"}],this.setPage(1),this.userForm=this.formBuilder.group({name:[""],father_Last_Name:[""],mother_Last_Name:[""],email:[""],image:[""],type_profile:[""],password_Change:[""]})}ngOnInit(){this.getUsers()}doRefresh(t){setTimeout(()=>{t.target.complete()},1e3)}filterItems(t){const i=t.target.value.toLowerCase();this.paginatedData=this.data.filter(o=>Object.values(o).some(r=>r.toString().toLowerCase().includes(i))),this.cdr.detectChanges()}sortTable(t){this.paginatedData.sort((i,o)=>i[t]<o[t]?-1:i[t]>o[t]?1:0),this.cdr.detectChanges()}editField(t,i){this.editingField=t,this.editingFieldKey=i}finishEditing(){this.editingField=null,this.editingFieldKey=null}deleteItem(t){"cliente"===t.type_profile?this.presentConfirmDeleteAlert(t):this.utilsSvc.presentToast({message:"Solo se pueden eliminar clientes de perfil 3.",duration:2e3,color:"warning",position:"middle",icon:"alert-circle-outline"})}presentConfirmDeleteAlert(t){var i=this;return(0,_.A)(function*(){yield(yield i.alertController.create({header:"Confirmaci\xf3n",message:`\xbfEst\xe1s seguro de que deseas eliminar al usuario ${t.name}?`,buttons:[{text:"Cancelar",role:"cancel",handler:()=>{i.utilsSvc.presentToast({message:"Eliminaci\xf3n cancelada.",duration:1500,color:"warning",position:"middle",icon:"alert-circle-outline"})}},{text:"Eliminar",role:"destructive",handler:()=>{i.confirmDeleteItem(t)}}]})).present()})()}confirmDeleteItem(t){const i=this.data.findIndex(o=>o.uid===t.uid);i>-1?(this.data.splice(i,1),this.paginatedData=[...this.data],this.setPage(1),this.cdr.detectChanges(),this.firebaseSvc.deleteDocumet(`users/${t.uid}`).then(()=>{this.utilsSvc.presentToast({message:"Usuario eliminado exitosamente.",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),console.log("Documento eliminado de Firestore")}).catch(r=>{this.utilsSvc.presentToast({message:"Error al eliminar el usuario.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"}),console.error("Error al eliminar el documento: ",r)})):this.utilsSvc.presentToast({message:"Usuario no encontrado en la lista.",duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}editItem(t){var i=this;return(0,_.A)(function*(){try{const o=yield i.modalCtrl.create({component:f.r,componentProps:{user:t}});o.onDidDismiss().then(r=>{if(r.data){const m=i.data.findIndex(E=>E.uid===r.data.uid);m>-1&&(i.data[m]=r.data),i.paginatedData=[...i.data],i.cdr.detectChanges()}}),yield o.present()}catch{}})()}openAddUserModal(){var t=this;return(0,_.A)(function*(){const i=yield t.modalCtrl.create({component:f.r,componentProps:{userForm:t.userForm}});return i.onDidDismiss().then(o=>{o.data&&(t.paginatedData=[...t.data],t.cdr.detectChanges())}),yield i.present()})()}closeModal(){this.modalCtrl.dismiss()}submitProduct(){this.userForm.valid&&(this.data.push(this.userForm.value),this.paginatedData=[...this.data],this.userForm.reset(),this.closeModal(),this.cdr.detectChanges())}addProduct(){this.userForm.valid&&(this.data.push(this.userForm.value),this.paginatedData=[...this.data],this.userForm.reset(),this.closeModal(),this.cdr.detectChanges())}setPage(t){this.currentPage=t;const i=(t-1)*this.itemsPerPage;this.paginatedData=this.data.slice(i,i+this.itemsPerPage),this.totalPages=Math.ceil(this.data.length/this.itemsPerPage)}previousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}toggleColumns(){this.showNombre=!this.showNombre,this.showApellidoPaterno=!this.showApellidoPaterno,this.showApellidoMaterno=!this.showApellidoMaterno,this.showEmail=!this.showEmail,this.showTipoUsuario=!this.showTipoUsuario,this.showImage=!this.showImage,this.areColumnsVisible=!this.areColumnsVisible}shouldShowField(t){switch(t){case"image":return this.showImage;case"email":return this.showEmail;default:return!0}}getUsers(){this.firebaseService.obtenerColeccion("users").subscribe(t=>{this.data=t.map(i=>({uid:i.uid,name:i.name,father_Last_Name:i.father_Last_Name,mother_Last_Name:i.mother_Last_Name,email:i.email,type_profile:this.getPermissions(i.type_profile),image:i.image,password_Change:i.password_Change})),this.paginatedData=[...this.data],this.setPage(1)})}getPermissions(t){switch(t){case 1:return"Super administrador";case 2:return"Administrador";default:return"cliente"}}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(l.W3),e.rXU(d.ok),e.rXU(e.gRc),e.rXU(p.f),e.rXU(l.hG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-administracion"]],decls:43,vars:11,consts:[["title","Usuarios",3,"showMenu"],[1,"ion-padding-top","ion-text-center"],["slot","fixed",3,"ionRefresh"],["size","8"],["placeholder","Buscar usuarios...",3,"ngModelChange","ionInput","ngModel"],["size","4",1,"ion-text-right"],["color","success",3,"click"],["name","add-circle-outline"],[1,"table-header"],["color","light",1,"toggle-columns-button",3,"click"],["slot","start",3,"name"],[1,"header-row"],[3,"click"],[3,"click",4,"ngIf"],["class","data-row",4,"ngFor","ngForOf"],[1,"pagination"],["color","light","expand","full",1,"pagination-button",3,"click","disabled"],["slot","start","name","arrow-back"],[1,"pagination-info"],["slot","end","name","arrow-forward"],[1,"data-row"],[4,"ngFor","ngForOf"],["style","display: flex; justify-content: center; align-items: center;",4,"ngIf"],["color","warning",3,"click"],["name","create"],["color","danger",3,"click",4,"ngIf"],["class","pointer-on",4,"ngIf"],[1,"pointer-on"],["class","cololetra",3,"ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[4,"ngIf"],[1,"cololetra",3,"ngModelChange","keyup.enter","blur","ngModel"],[2,"display","flex","justify-content","center","align-items","center"],[2,"width","50px","height","auto",3,"src"],["color","danger",3,"click"],["name","trash"]],template:function(t,i){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"ion-refresher",2),e.bIt("ionRefresh",function(r){return i.doRefresh(r)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"h2"),e.EFF(5,"Administraci\xf3n de usuarios"),e.k0s(),e.j41(6,"ion-grid")(7,"ion-row")(8,"ion-col",3)(9,"ion-searchbar",4),e.mxI("ngModelChange",function(r){return e.DH7(i.searchTerm,r)||(i.searchTerm=r),r}),e.bIt("ionInput",function(r){return i.filterItems(r)}),e.k0s()(),e.j41(10,"ion-col",5)(11,"ion-button",6),e.bIt("click",function(){return i.openAddUserModal()}),e.nrm(12,"ion-icon",7),e.EFF(13," Agregar Usuario "),e.k0s()()()(),e.j41(14,"div",8),e.nrm(15,"h2"),e.j41(16,"ion-button",9),e.bIt("click",function(){return i.toggleColumns()}),e.nrm(17,"ion-icon",10),e.EFF(18),e.k0s()(),e.j41(19,"ion-grid")(20,"ion-row",11)(21,"ion-col",12),e.bIt("click",function(){return i.sortTable("name")}),e.EFF(22,"Nombre"),e.k0s(),e.j41(23,"ion-col",12),e.bIt("click",function(){return i.sortTable("father_Last_Name")}),e.EFF(24,"Apellido Paterno"),e.k0s(),e.j41(25,"ion-col",12),e.bIt("click",function(){return i.sortTable("mother_Last_Name")}),e.EFF(26,"Apellido Materno"),e.k0s(),e.j41(27,"ion-col",12),e.bIt("click",function(){return i.sortTable("type_profile")}),e.EFF(28,"Tipo de Perfil"),e.k0s(),e.DNE(29,k,2,0,"ion-col",13)(30,w,2,0,"ion-col",13),e.j41(31,"ion-col"),e.EFF(32,"Acciones"),e.k0s()(),e.DNE(33,T,7,3,"ion-row",14),e.k0s(),e.j41(34,"div",15)(35,"ion-button",16),e.bIt("click",function(){return i.previousPage()}),e.nrm(36,"ion-icon",17),e.EFF(37," Anterior "),e.k0s(),e.j41(38,"span",18),e.EFF(39),e.k0s(),e.j41(40,"ion-button",16),e.bIt("click",function(){return i.nextPage()}),e.EFF(41," Siguiente "),e.nrm(42,"ion-icon",19),e.k0s()()()),2&t&&(e.Y8G("showMenu",!0),e.R7$(9),e.R50("ngModel",i.searchTerm),e.R7$(8),e.Y8G("name",i.areColumnsVisible?"eye-off":"eye"),e.R7$(),e.SpI(" ",i.areColumnsVisible?"Ocultar tabla completa":"Mostrar tabla completa"," "),e.R7$(11),e.Y8G("ngIf",i.showEmail),e.R7$(),e.Y8G("ngIf",i.showImage),e.R7$(3),e.Y8G("ngForOf",i.paginatedData),e.R7$(2),e.Y8G("disabled",1===i.currentPage),e.R7$(4),e.Lme("P\xe1gina ",i.currentPage," de ",i.totalPages,""),e.R7$(),e.Y8G("disabled",i.currentPage===i.totalPages))},dependencies:[g.Sq,g.bT,d.BC,d.vS,l.Jm,l.hU,l.W9,l.lO,l.iq,l.KW,l.$w,l.To,l.Ki,l.ln,l.S1,l.Gw,b.l],styles:['@charset "UTF-8";ion-grid[_ngcontent-%COMP%]{border-radius:15px;overflow:hidden;margin-top:20px;padding-left:3rem;padding-right:3rem}.header-row[_ngcontent-%COMP%]{background-color:#1ad436;color:#fff;font-weight:700;text-align:center;border-top-left-radius:15px;border-top-right-radius:15px;cursor:pointer}.data-row[_ngcontent-%COMP%]{background-color:#f9f9f9;border-bottom:1px solid #1ad436;text-align:center}.data-row[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:15px;border-bottom-right-radius:15px}ion-col[_ngcontent-%COMP%]{padding:10px}ion-button[_ngcontent-%COMP%]{margin-top:10px}ion-searchbar[_ngcontent-%COMP%]{margin-top:10px}.cololetra[_ngcontent-%COMP%]{background-color:#d4fcd8;border-radius:5px;padding:8px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;margin-bottom:3rem;flex-wrap:wrap}.pagination-button[_ngcontent-%COMP%]{margin:0 5px;flex:1;max-width:150px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;margin-right:4rem}.toggle-columns-button[_ngcontent-%COMP%]{font-size:14px;padding:0}.toggle-columns-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}@media (max-width: 768px){ion-grid[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}ion-col[_ngcontent-%COMP%]{font-size:12px;padding:5px}.header-row[_ngcontent-%COMP%]{font-size:14px}.data-row[_ngcontent-%COMP%]{font-size:12px}ion-searchbar[_ngcontent-%COMP%]{width:100%}.pagination[_ngcontent-%COMP%]{flex-direction:column}}@media (max-width: 480px){.header-row[_ngcontent-%COMP%], .data-row[_ngcontent-%COMP%]{font-size:10px}ion-button[_ngcontent-%COMP%]{font-size:10px;padding:5px}ion-searchbar[_ngcontent-%COMP%]{width:100%;margin-top:5px}}']}),s})()}];let j=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.iI.forChild(x),h.iI]}),s})();var v=c(7383);let G=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.MD,d.YN,l.bv,j,v.G]}),s})()}}]);