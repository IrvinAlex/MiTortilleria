"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[386],{386:(_e,O,g)=>{g.r(O),g.d(O,{PedidosPageModule:()=>ue});var h=g(177),P=g(9417),l=g(5933),w=g(8265),m=g(467),e=g(4438),k=g(7517),M=g(2723),T=g(421),_=g(9969),D=(g(4511),g(1876)),E=g(7157),F=g(8461);const I=["sliderButton"],j=["mapContainer"],R=i=>[i,"MXN","symbol-narrow","1.2-2","en-US"];function S(i,c){if(1&i&&(e.j41(0,"div",20)(1,"p"),e.nrm(2,"ion-icon",9),e.EFF(3),e.nI1(4,"date"),e.k0s()()),2&i){const o=e.XpG();e.R7$(2),e.Y8G("name",o.isBusinessPickup()?"time-outline":"truck-outline")("color",o.getDeliveryTypeColor()),e.R7$(),e.Lme(" ",o.getScheduledLabel(),": ",e.i5U(4,4,o.getScheduledDate(),"dd/MM/yyyy HH:mm")," ")}}function A(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-button",30),e.bIt("click",function(){e.eBV(o);const t=e.XpG(2);return e.Njj(t.loadMapPreview())}),e.nrm(1,"ion-icon",31),e.EFF(2," Ver mapa "),e.k0s()}}function $(i,c){1&i&&e.nrm(0,"div",36,0)}function z(i,c){1&i&&(e.j41(0,"div",37),e.nrm(1,"ion-spinner",38),e.j41(2,"p"),e.EFF(3,"Cargando mapa..."),e.k0s()())}function G(i,c){if(1&i){const o=e.RV6();e.j41(0,"div",39),e.nrm(1,"ion-icon",40),e.j41(2,"p"),e.EFF(3,"No se pudo cargar el mapa"),e.k0s(),e.j41(4,"ion-button",41),e.bIt("click",function(){e.eBV(o);const t=e.XpG(3);return e.Njj(t.openLocationInMaps())}),e.EFF(5," Ver en Google Maps "),e.k0s()()}}function N(i,c){if(1&i&&(e.j41(0,"div",32),e.DNE(1,$,2,0,"div",33)(2,z,4,0,"div",34)(3,G,6,0,"div",35),e.k0s()),2&i){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",!o.mapLoadError),e.R7$(),e.Y8G("ngIf",o.showMapPreview&&!o.isMapReady&&!o.mapLoadError),e.R7$(),e.Y8G("ngIf",o.mapLoadError)}}function Y(i,c){if(1&i&&(e.j41(0,"p"),e.nrm(1,"ion-icon",42),e.EFF(2),e.nI1(3,"date"),e.k0s()),2&i){const o=e.XpG(2);e.R7$(2),e.SpI(" Entrega programada: ",e.i5U(3,1,o.getScheduledDate(),"EEEE, dd 'de' MMMM 'a las' HH:mm")," ")}}function B(i,c){if(1&i){const o=e.RV6();e.j41(0,"div",4)(1,"h3",13),e.nrm(2,"ion-icon",21),e.EFF(3," Ubicaci\xf3n de Entrega "),e.k0s(),e.j41(4,"div",22),e.DNE(5,A,3,0,"ion-button",23),e.j41(6,"ion-button",24),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.openLocationInMaps())}),e.nrm(7,"ion-icon",25),e.EFF(8," Abrir en Maps "),e.k0s()(),e.DNE(9,N,4,3,"div",26),e.j41(10,"div",27)(11,"p"),e.nrm(12,"ion-icon",28),e.EFF(13),e.nI1(14,"number"),e.nI1(15,"number"),e.k0s(),e.DNE(16,Y,4,4,"p",29),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(5),e.Y8G("ngIf",!o.showMapPreview),e.R7$(4),e.Y8G("ngIf",o.showMapPreview),e.R7$(4),e.Lme(" Coordenadas: ",e.i5U(14,5,o.pedido.geopoint_entrega.latitude,"1.6-6"),", ",e.i5U(15,8,o.pedido.geopoint_entrega.longitude,"1.6-6")," "),e.R7$(3),e.Y8G("ngIf",o.getScheduledDate())}}function X(i,c){if(1&i&&(e.j41(0,"div",49)(1,"div",50),e.nrm(2,"ion-icon",51),e.j41(3,"div")(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"p",52),e.EFF(7),e.nI1(8,"date"),e.k0s()()()()),2&i){const o=e.XpG(2);e.R7$(5),e.JRh(o.getScheduledLabel()),e.R7$(2),e.JRh(e.i5U(8,2,o.getScheduledDate(),"EEEE, dd 'de' MMMM 'a las' HH:mm"))}}function V(i,c){if(1&i&&(e.j41(0,"div",4)(1,"h3",13),e.nrm(2,"ion-icon",43),e.EFF(3," Informaci\xf3n de Recolecci\xf3n "),e.k0s(),e.DNE(4,X,9,5,"div",44),e.j41(5,"div",45)(6,"h4"),e.EFF(7,"Datos del Negocio"),e.k0s(),e.j41(8,"p"),e.nrm(9,"ion-icon",5),e.EFF(10),e.k0s(),e.j41(11,"p"),e.nrm(12,"ion-icon",46),e.EFF(13," Avenida Benito No.103B colonia M\xe9xico 68, c\xf3digo postal o C.P: 51412"),e.k0s(),e.j41(14,"p"),e.nrm(15,"ion-icon",47),e.EFF(16," 722 366 4325 "),e.k0s(),e.j41(17,"p"),e.nrm(18,"ion-icon",48),e.EFF(19),e.k0s()()()),2&i){const o=e.XpG();e.R7$(4),e.Y8G("ngIf",o.getScheduledDate()),e.R7$(6),e.SpI(" ",o.getBusinessInfo().name,""),e.R7$(9),e.SpI(" ",o.getBusinessInfo().hours,"")}}function U(i,c){if(1&i&&(e.j41(0,"p"),e.EFF(1,"Tama\xf1o de tortilla: "),e.j41(2,"span",55),e.EFF(3),e.k0s()()),2&i){const o=e.XpG().$implicit;e.R7$(3),e.JRh(o.tamano_tortilla)}}function H(i,c){if(1&i&&(e.j41(0,"ion-item")(1,"ion-avatar",53),e.nrm(2,"img",54),e.k0s(),e.j41(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.DNE(6,U,4,1,"p",29),e.j41(7,"p"),e.EFF(8),e.k0s(),e.j41(9,"p"),e.EFF(10,"Subtotal: "),e.j41(11,"span",55),e.EFF(12),e.nI1(13,"currency"),e.k0s()()(),e.j41(14,"ion-badge",56),e.nrm(15,"ion-icon",57),e.EFF(16),e.k0s()()),2&i){const o=c.$implicit;e.R7$(2),e.FS9("alt",o.producto.nombre),e.Y8G("src",o.producto.imagen,e.B4B),e.R7$(3),e.JRh(o.producto.nombre),e.R7$(),e.Y8G("ngIf",o.tamano_tortilla),e.R7$(2),e.SpI("Cantidad: ",o.cantidad,""),e.R7$(4),e.SpI("",e.iJd(13,7,e.eq3(13,R,o.subtotal))," MXN"),e.R7$(4),e.SpI(" ",o.cantidad," ")}}function J(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-button",66),e.bIt("click",function(){e.eBV(o);const t=e.XpG(2);return e.Njj(t.cancelAutoAssign())}),e.nrm(1,"ion-icon",67),e.EFF(2," Cancelar asignaci\xf3n "),e.k0s()}}function Q(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-button",68),e.bIt("click",function(){e.eBV(o);const t=e.XpG(2);return e.Njj(t.restartAutoAssign())}),e.nrm(1,"ion-icon",69),e.EFF(2," Reiniciar asignaci\xf3n autom\xe1tica "),e.k0s()}}function W(i,c){if(1&i&&(e.j41(0,"div",58)(1,"div",59),e.nrm(2,"ion-icon",60),e.j41(3,"div")(4,"h4"),e.EFF(5,"Asignaci\xf3n autom\xe1tica en:"),e.k0s(),e.j41(6,"div",61),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9,"Se asignar\xe1: Preparando tu pedido \u2022 Tiempo: 3-5 min"),e.k0s()()(),e.nrm(10,"ion-progress-bar",62),e.j41(11,"div",63),e.DNE(12,J,3,0,"ion-button",64)(13,Q,3,0,"ion-button",65),e.k0s()()),2&i){const o=e.XpG();e.R7$(7),e.JRh(o.countdown),e.R7$(3),e.Y8G("value",o.autoAssignProgress/100),e.R7$(2),e.Y8G("ngIf",o.isAutoAssigning),e.R7$(),e.Y8G("ngIf",!o.isAutoAssigning)}}function Z(i,c){1&i&&(e.j41(0,"div",75),e.nrm(1,"ion-icon",76),e.j41(2,"p"),e.EFF(3,"Pedido en preparaci\xf3n"),e.k0s()())}function K(i,c){if(1&i){const o=e.RV6();e.j41(0,"div",70)(1,"ion-label"),e.EFF(2,"Desliza para asignar en preparaci\xf3n"),e.k0s(),e.j41(3,"ion-range",71),e.mxI("ngModelChange",function(t){e.eBV(o);const r=e.XpG();return e.DH7(r.sliderValue,t)||(r.sliderValue=t),e.Njj(t)}),e.bIt("ionChange",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.onSliderChange())}),e.nrm(4,"ion-icon",72)(5,"ion-icon",73),e.k0s(),e.DNE(6,Z,4,0,"div",74),e.k0s()}if(2&i){const o=e.XpG();e.R7$(3),e.R50("ngModel",o.sliderValue),e.R7$(3),e.Y8G("ngIf",o.showAnimation)}}let q=(()=>{var i;class c{constructor(n){this.platform=n,this.sliderValue=0,this.showAnimation=!1,this.firebaseSvc=(0,e.WQX)(k.f),this.utilSvc=(0,e.WQX)(M.T),this.emailSvc=(0,e.WQX)(D._),this.utilsSvc=(0,e.WQX)(M.T),this.isMapReady=!1,this.businessLocation=null,this.mapLoadError=!1,this.showMapPreview=!1,this.countdownStart=5,this.countdown=5,this.autoAssignInterval=null,this.isAutoAssigning=!1,this.autoAssignProgress=0}ngOnInit(){var n,t;"domicilio"===(null===(n=this.pedido.tipo_entrega)||void 0===n?void 0:n.toLowerCase())&&this.loadBusinessLocation(),"pedido confirmado"===(null===(t=this.pedido)||void 0===t||null===(t=t.estatus)||void 0===t?void 0:t.toLowerCase())&&this.restartAutoAssign()}ngAfterViewInit(){}ngOnDestroy(){this.clearAutoAssignTimer()}loadBusinessLocation(){var n=this;return(0,m.A)(function*(){try{n.firebaseSvc.getCollectionData("direccionNegocio").subscribe(t=>{t&&t.length>0&&(n.businessLocation=t[0])})}catch(t){console.error("Error loading business location:",t)}})()}loadMapPreview(){var n=this;return(0,m.A)(function*(){n.showMapPreview||!n.pedido.geopoint_entrega||(n.showMapPreview=!0,setTimeout(()=>{n.loadLeafletMap()},100))})()}loadLeafletMap(){var n;if(null!==(n=this.mapContainer)&&void 0!==n&&n.nativeElement&&this.pedido.geopoint_entrega)try{this.loadLeafletAssets().then(()=>{this.initializeLeafletMap()}).catch(t=>{console.error("Error loading Leaflet:",t),this.mapLoadError=!0})}catch(t){console.error("Error initializing map:",t),this.mapLoadError=!0}else this.mapLoadError=!0}loadLeafletAssets(){return new Promise((n,t)=>{if(typeof L<"u")return void n();const r=document.createElement("link");r.rel="stylesheet",r.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(r);const a=document.createElement("script");a.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",a.onload=()=>n(),a.onerror=()=>t(new Error("Failed to load Leaflet")),document.head.appendChild(a)})}initializeLeafletMap(){try{var n;const t=[this.pedido.geopoint_entrega.latitude,this.pedido.geopoint_entrega.longitude];this.map=L.map(this.mapContainer.nativeElement,{center:t,zoom:15,zoomControl:!0,attributionControl:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map);const r=L.divIcon({html:'<ion-icon name="home" style="color: #3880ff; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});if(L.marker(t,{icon:r}).addTo(this.map).bindPopup("Direcci\xf3n de entrega"),null!==(n=this.businessLocation)&&void 0!==n&&n.geopoint){const a=[this.businessLocation.geopoint.latitude,this.businessLocation.geopoint.longitude],s=L.divIcon({html:'<ion-icon name="storefront" style="color: #10dc60; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});L.marker(a,{icon:s}).addTo(this.map).bindPopup("Tortiller\xeda Plata Jaimes");const d=L.featureGroup([L.marker(t),L.marker(a)]);this.map.fitBounds(d.getBounds().pad(.1))}setTimeout(()=>{this.map.invalidateSize(),this.isMapReady=!0},200)}catch(t){console.error("Error initializing Leaflet map:",t),this.mapLoadError=!0}}openLocationInMaps(){if(!this.pedido.geopoint_entrega)return;const r=`https://www.google.com/maps?q=${this.pedido.geopoint_entrega.latitude},${this.pedido.geopoint_entrega.longitude}`;this.platform.is("capacitor")?window.open(r,"_system"):window.open(r,"_blank")}getEffectiveDeliveryType(){var n,t,r,a,s;return!0===(null===(n=this.pedido)||void 0===n?void 0:n.es_recoleccion_negocio)||"negocio"===(null===(t=this.pedido)||void 0===t?void 0:t.metodo_entrega)||"negocio"===(null===(r=this.pedido)||void 0===r?void 0:r.tipo_entrega)||null!==(a=this.pedido)&&void 0!==a&&a.hora_recoleccion?"negocio":this.hasDeliveryLocation()&&"domicilio"===(null===(s=this.pedido)||void 0===s||null===(s=s.tipo_entrega)||void 0===s?void 0:s.toLowerCase())?"domicilio":"negocio"}hasDeliveryLocation(){var n,t,r,a,s;const d=null===(n=this.pedido)||void 0===n?void 0:n.geopoint_entrega,f=d&&"number"==typeof d.latitude&&"number"==typeof d.longitude&&!isNaN(d.latitude)&&!isNaN(d.longitude),u="number"==typeof(null===(t=this.pedido)||void 0===t?void 0:t.lat)&&"number"==typeof(null===(r=this.pedido)||void 0===r?void 0:r.lng)||"number"==typeof(null===(a=this.pedido)||void 0===a||null===(a=a.coordenadas)||void 0===a?void 0:a.lat)&&"number"==typeof(null===(s=this.pedido)||void 0===s||null===(s=s.coordenadas)||void 0===s?void 0:s.lng);return!(!f&&!u)}getDeliveryTypeIcon(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"home-outline";case"negocio":return"storefront-outline";default:return"location-outline"}}getDeliveryTypeColor(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"primary";case"negocio":return"success";default:return"medium"}}isHomeDelivery(){return"domicilio"===this.getEffectiveDeliveryType()}isBusinessPickup(){return"negocio"===this.getEffectiveDeliveryType()}getScheduledDate(){var n,t,r;return null!==(n=this.pedido)&&void 0!==n&&n.hora_recoleccion?this.toDateTime(this.pedido.hora_recoleccion):null!==(t=this.pedido)&&void 0!==t&&t.fecha_entrega?this.toDateTime(this.pedido.fecha_entrega):null!==(r=this.pedido)&&void 0!==r&&r.fecha?this.toDateTime(this.pedido.fecha):null}getScheduledLabel(){var n,t;return this.isBusinessPickup()?null!==(n=this.pedido)&&void 0!==n&&n.hora_recoleccion?"Horario de recolecci\xf3n":null!==(t=this.pedido)&&void 0!==t&&t.fecha_entrega?"Horario programado":"Fecha del pedido":"Horario de entrega"}toDateTime(n){if(!n)return null;if(null!=n&&n.toDate&&"function"==typeof n.toDate)return n.toDate();if(null!=n&&n.seconds)return new Date(1e3*n.seconds);const t=new Date(n);return isNaN(t.getTime())?null:t}getDeliveryTypeDisplayName(){switch(this.getEffectiveDeliveryType()){case"domicilio":return"Entrega a domicilio";case"negocio":return"Recolecci\xf3n en negocio";default:return"Tipo no especificado"}}getBusinessInfo(){return{name:"Tortiller\xeda Plata Jaimes",address:"Calle Principal #123, Centro, Ciudad",phone:"+52 722 366 4325",hours:"Lunes a Domingo de 9:00 AM a 8:00 PM"}}sendStatusUpdateEmail(n){var t=this;return(0,m.A)(function*(){try{const r=yield t.firebaseSvc.getDocument(`users/${t.pedido.uid_cliente}`),a={orderId:n,customerEmail:r.email,customerName:r.name||r.email,fecha:t.pedido.fecha.toDate?t.pedido.fecha.toDate():new Date(t.pedido.fecha),estatus:"En preparaci\xf3n",tipo_pago:t.pedido.tipo_pago,items:t.pedido.detalle_pedido,subtotal:t.pedido.total,discountAmount:0,discountPercent:0,transportFee:0,total:t.pedido.total};yield t.emailSvc.sendStatusUpdateEmail(a),console.log("Email de actualizaci\xf3n de estatus enviado exitosamente")}catch(r){console.error("Error al enviar email de actualizaci\xf3n:",r)}})()}onSliderChange(){var n=this;return(0,m.A)(function*(){100===n.sliderValue&&(n.clearAutoAssignTimer(),n.isAutoAssigning=!1,yield n.assignOrderAndNotify("manual"))})()}restartAutoAssign(){this.clearAutoAssignTimer(),this.countdown=this.countdownStart,this.autoAssignProgress=0,this.isAutoAssigning=!0;const n=this.countdownStart;this.autoAssignInterval=setInterval(()=>{this.countdown=Math.max(0,this.countdown-1),this.autoAssignProgress=Math.min(100,Math.round((n-this.countdown)/n*100)),this.countdown<=0&&(this.clearAutoAssignTimer(),this.assignOrderAndNotify("auto"))},1e3)}cancelAutoAssign(){this.clearAutoAssignTimer(),this.isAutoAssigning=!1}clearAutoAssignTimer(){this.autoAssignInterval&&(clearInterval(this.autoAssignInterval),this.autoAssignInterval=null)}sendRealtimeNotification(){var n=this;return(0,m.A)(function*(){try{const t=yield n.firebaseSvc.getDocument(`users/${n.pedido.uid_cliente}`),r=(null==t?void 0:t.fcmToken)||(null==t?void 0:t.pushToken)||(null==t?void 0:t.token)||null,a={uid:n.pedido.uid_cliente,orderId:n.pedido.id,title:"Pedido en preparaci\xf3n",body:"Tu pedido est\xe1 siendo preparado. Te avisaremos cuando est\xe9 listo.",status:"En preparaci\xf3n",token:r,createdAt:new Date,type:"ORDER_STATUS"},s=n.firebaseSvc;"function"==typeof s.sendPushNotification&&r?yield s.sendPushNotification(r,a.title,a.body,{orderId:n.pedido.id,status:"En preparaci\xf3n"}):"function"==typeof s.addDocument?yield s.addDocument("notificaciones",a):"function"==typeof s.createDocument?yield s.createDocument("notificaciones",a):console.warn("No push method available; notification enqueued skipped")}catch(t){console.error("Error enviando notificaci\xf3n en tiempo real:",t)}})()}assignOrderAndNotify(n){var t=this;return(0,m.A)(function*(){const r=yield t.utilsSvc.loading();yield r.present(),t.showAnimation=!0,t.firebaseSvc.updateDocumet(`pedidos/${t.pedido.id}`,{estatus:"En preparaci\xf3n"}).then((0,m.A)(function*(){yield t.sendStatusUpdateEmail(t.pedido.id),yield t.sendRealtimeNotification(),setTimeout(()=>{t.showAnimation=!1,t.sliderValue=0,t.pedido.estatus="En preparaci\xf3n",t.utilsSvc.dismissModal({success:!0,source:n})},1200)})).catch(s=>{t.utilSvc.presentToast({message:s.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"}),t.isAutoAssigning=!1}).finally(()=>{r.dismiss()})})()}getColorIcon(n){switch(n.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}getStatusIcon(n){switch(n.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(E.OD))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-pedido-modal"]],viewQuery:function(n,t){if(1&n&&(e.GBs(I,5),e.GBs(j,5)),2&n){let r;e.mGM(r=e.lsd())&&(t.sliderButton=r.first),e.mGM(r=e.lsd())&&(t.mapContainer=r.first)}},inputs:{pedido:"pedido"},decls:43,vars:27,consts:[["mapContainer",""],["title","Detalles del pedido",3,"isModal","showNombre","showLogo"],[1,"ticket-container"],[1,"ticket-title"],[1,"ticket-section"],["name","storefront-outline"],["name","person-outline"],["name","calendar-outline"],["class","scheduling-info",4,"ngIf"],[3,"name","color"],["mode","ios",3,"color"],["slot","start",3,"name"],["class","ticket-section",4,"ngIf"],[1,"ticket-subtitle"],[4,"ngFor","ngForOf"],["name","cash-outline"],["name","card-outline"],["slot","start",2,"margin-left","0.5rem",3,"color","name"],["class","auto-assign-card",4,"ngIf"],["class","assign-slider-container",4,"ngIf"],[1,"scheduling-info"],["name","map-outline","color","primary"],[1,"map-controls"],["fill","outline","size","small","class","map-preview-btn",3,"click",4,"ngIf"],["fill","outline","size","small",1,"external-maps-btn",3,"click"],["name","navigate-outline","slot","start"],["class","map-container",4,"ngIf"],[1,"delivery-info"],["name","location-outline","color","primary"],[4,"ngIf"],["fill","outline","size","small",1,"map-preview-btn",3,"click"],["name","map-outline","slot","start"],[1,"map-container"],["class","map-canvas",4,"ngIf"],["class","map-loading",4,"ngIf"],["class","map-error",4,"ngIf"],[1,"map-canvas"],[1,"map-loading"],["name","circles"],[1,"map-error"],["name","warning-outline","color","warning"],["size","small","fill","clear",3,"click"],["name","truck-outline","color","primary"],["name","storefront-outline","color","success"],["class","pickup-schedule",4,"ngIf"],[1,"pickup-info"],["name","location-outline"],["name","call-outline"],["name","time-outline"],[1,"pickup-schedule"],[1,"schedule-highlight"],["name","alarm-outline","color","success"],[1,"schedule-time"],["slot","start",1,"avatar-icon"],[3,"src","alt"],[1,"subtotal"],["slot","end","color","tertiary"],["name","cube-outline"],[1,"auto-assign-card"],[1,"auto-assign-header"],["name","alarm-outline","color","warning"],[1,"auto-assign-timer"],[3,"value"],[1,"auto-assign-actions"],["size","small","color","danger",3,"click",4,"ngIf"],["size","small","color","success","fill","outline",3,"click",4,"ngIf"],["size","small","color","danger",3,"click"],["name","close-circle-outline","slot","start"],["size","small","color","success","fill","outline",3,"click"],["name","refresh-outline","slot","start"],[1,"assign-slider-container"],["min","0","max","100","step","1","pin","false","color","primary",1,"assign-slider",3,"ngModelChange","ionChange","ngModel"],["slot","start","name","arrow-forward","color","primary"],["slot","end","name","checkmark-circle","color","primary"],["class","success-animation",4,"ngIf"],[1,"success-animation"],["name","checkmark-circle","color","primary"]],template:function(n,t){1&n&&(e.nrm(0,"app-header",1),e.j41(1,"ion-content")(2,"div",2)(3,"h2",3),e.EFF(4,"Ticket de Pedido"),e.k0s(),e.j41(5,"div",4)(6,"p"),e.nrm(7,"ion-icon",5),e.EFF(8," Nombre del negocio: Tortilleria Plata Jaimes"),e.k0s(),e.j41(9,"p"),e.nrm(10,"ion-icon",6),e.EFF(11),e.k0s(),e.j41(12,"p"),e.nrm(13,"ion-icon",7),e.EFF(14),e.nI1(15,"date"),e.k0s(),e.DNE(16,S,5,7,"div",8),e.j41(17,"p"),e.nrm(18,"ion-icon",9),e.EFF(19," Tipo de entrega: "),e.j41(20,"ion-chip",10),e.nrm(21,"ion-icon",11),e.j41(22,"ion-label"),e.EFF(23),e.k0s()()()(),e.DNE(24,B,17,11,"div",12)(25,V,20,3,"div",12),e.j41(26,"h3",13),e.EFF(27,"Productos Comprados"),e.k0s(),e.j41(28,"ion-list"),e.DNE(29,H,17,15,"ion-item",14),e.k0s(),e.j41(30,"div",4)(31,"p"),e.nrm(32,"ion-icon",15),e.EFF(33),e.nI1(34,"number"),e.k0s(),e.j41(35,"p"),e.nrm(36,"ion-icon",16),e.EFF(37),e.k0s(),e.j41(38,"p"),e.EFF(39),e.nrm(40,"ion-icon",17),e.k0s()(),e.DNE(41,W,14,4,"div",18)(42,K,7,2,"div",19),e.k0s()()),2&n&&(e.Y8G("isModal",!0)("showNombre",!1)("showLogo",!1),e.R7$(11),e.SpI(" Cliente: ",t.pedido.nombre_cliente,""),e.R7$(3),e.SpI(" Fecha: ",e.i5U(15,21,null==t.pedido.fecha?null:t.pedido.fecha.toDate(),"dd/MM/yyyy"),""),e.R7$(2),e.Y8G("ngIf",t.getScheduledDate()),e.R7$(2),e.Y8G("name",t.getDeliveryTypeIcon())("color",t.getDeliveryTypeColor()),e.R7$(2),e.Y8G("color",t.getDeliveryTypeColor()),e.R7$(),e.Y8G("name",t.getDeliveryTypeIcon()),e.R7$(2),e.JRh(t.getDeliveryTypeDisplayName()),e.R7$(),e.Y8G("ngIf",t.isHomeDelivery()&&t.pedido.geopoint_entrega),e.R7$(),e.Y8G("ngIf",t.isBusinessPickup()),e.R7$(4),e.Y8G("ngForOf",t.pedido.detalle_pedido),e.R7$(4),e.SpI(" Total: ",e.i5U(34,24,t.pedido.total,"1.2-2"),""),e.R7$(4),e.SpI(" Tipo de Pago: ",t.pedido.tipo_pago,""),e.R7$(2),e.SpI("Estatus: ",t.pedido.estatus," "),e.R7$(),e.Y8G("color",t.getColorIcon(t.pedido.estatus))("name",t.getStatusIcon(t.pedido.estatus)),e.R7$(),e.Y8G("ngIf","pedido confirmado"===t.pedido.estatus.toLowerCase()),e.R7$(),e.Y8G("ngIf","pedido confirmado"===t.pedido.estatus.toLowerCase()))},dependencies:[h.Sq,h.bT,l.mC,l.In,l.Jm,l.ZB,l.W9,l.iq,l.uz,l.he,l.nf,l.FH,l.Ob,l.w2,l.Gw,P.BC,P.vS,F.l,h.QX,h.oe,h.vh],styles:['@charset "UTF-8";.ticket-container[_ngcontent-%COMP%]{padding:16px;background-color:#f7f7f7;border-radius:8px;margin:20px;box-shadow:0 4px 8px #0003}.ticket-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;text-align:center;color:#333;margin-bottom:1rem}.ticket-section[_ngcontent-%COMP%]{background-color:#fff;padding:12px;border-radius:8px;margin-bottom:1rem;box-shadow:0 2px 6px #0000001a}.ticket-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:#444;margin:.5rem 0;display:flex;align-items:center}.ticket-section[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}.ticket-subtitle[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:500;margin-top:1rem;margin-bottom:.5rem;color:#666}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{background-color:#fafafa;border-radius:6px;margin:4px 0;box-shadow:0 1px 3px #0000001a}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1rem;color:#555}.ticket-section[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#28a745}ion-content[_ngcontent-%COMP%]{--ion-background-color: #e9ecef}.assign-slider-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:50px;text-align:center}.assign-slider[_ngcontent-%COMP%]{width:80%;--knob-size: 36px;--bar-height: 24px;--knob-background: var(--ion-color-primary);--bar-background-active: var(--ion-color-primary);--bar-background: #ddd;--bar-border-radius: 50px}.success-animation[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:20px;animation:_ngcontent-%COMP%_fadeInScale .5s ease forwards}.success-animation[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:50px;color:var(--ion-color-primary);animation:_ngcontent-%COMP%_scaleUp .5s ease forwards}.success-animation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-primary);margin-top:8px}@keyframes _ngcontent-%COMP%_fadeInScale{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_scaleUp{0%{transform:scale(.5)}to{transform:scale(1)}}ion-item[_ngcontent-%COMP%]{--inner-padding-start: 10px;border-bottom:1px solid var(--ion-color-light)}.avatar-icon[_ngcontent-%COMP%]{background-color:var(--ion-color-light);display:flex;align-items:center;justify-content:center;border-radius:50%;height:40px;width:40px}.avatar-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;font-size:16px;margin:0;color:var(--ion-color-dark)}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--ion-color-medium)}.subtotal[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-success)}ion-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;padding:5px;border-radius:10px;font-size:14px}.map-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{--border-width: 1px;--border-style: solid;--border-color: var(--ion-color-primary);height:32px}.map-container[_ngcontent-%COMP%]{position:relative;width:100%;height:250px;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026;margin:1rem 0;border:1px solid #e0e0e0}.map-canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:8px}.map-loading[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#f8f9fa;color:#6c757d;border-radius:8px}.map-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:1rem;--color: var(--ion-color-primary)}.map-error[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#fff8e1;color:#f57c00;border-radius:8px;text-align:center}.map-error[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.map-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:.9rem}.delivery-info[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:.75rem;border-radius:6px;margin-top:.5rem;border-left:3px solid var(--ion-color-primary)}.delivery-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0;font-size:.9rem;color:#666;display:flex;align-items:center}.delivery-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:.5rem}.pickup-info[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:8px;padding:16px;margin:16px 0}.pickup-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:var(--ion-color-success);font-size:16px;font-weight:600;border-bottom:1px solid var(--ion-color-success);padding-bottom:8px}.pickup-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;display:flex;align-items:center;gap:8px}.pickup-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-success);min-width:20px}.scheduling-info[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:8px;padding:12px;margin:8px 0;border-left:4px solid var(--ion-color-primary)}.scheduling-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;color:var(--ion-color-primary)}.pickup-schedule[_ngcontent-%COMP%]{margin-bottom:20px}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e8f5e8,#c8e6c8);border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;border-left:4px solid var(--ion-color-success)}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;color:var(--ion-color-success);font-size:16px;font-weight:600}.pickup-schedule[_ngcontent-%COMP%]   .schedule-highlight[_ngcontent-%COMP%]   .schedule-time[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:700;color:var(--ion-color-success-shade)}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:200px;margin:.75rem 0}.map-controls[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.delivery-info[_ngcontent-%COMP%]{padding:.5rem;font-size:.85rem}}@media (max-width: 480px){.map-container[_ngcontent-%COMP%]{height:180px}.ticket-container[_ngcontent-%COMP%]{margin:10px;padding:12px}}.auto-assign-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:12px;margin:0 0 1rem;border:1px solid #e7e7e7;box-shadow:0 2px 6px #0000000f}.auto-assign-header[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center;margin-bottom:.5rem}.auto-assign-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.auto-assign-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#555}.auto-assign-header[_ngcontent-%COMP%]   .auto-assign-timer[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:var(--ion-color-warning);line-height:1.2}.auto-assign-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px 0 0;color:#6c757d;font-size:.9rem}.auto-assign-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap}ion-progress-bar[_ngcontent-%COMP%]{--progress-background: var(--ion-color-warning);margin-top:.25rem}'],data:{animation:[(0,_.hZ)("slideButton",[(0,_.wk)("start",(0,_.iF)({transform:"translateX(0)"})),(0,_.wk)("end",(0,_.iF)({transform:"translateX(100%)"})),(0,_.kY)("start => end",(0,_.i0)("0.3s ease-out")),(0,_.kY)("end => start",(0,_.i0)("0.3s ease-in"))])]}}),c})();const ee=i=>[i,"MXN","symbol-narrow","1.2-2","en-US"],ne=()=>[1,1,1,1,1,1,1,1];function te(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-button",8),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.clearFilters())}),e.j41(1,"span"),e.EFF(2,"Quitar Filtros"),e.k0s(),e.nrm(3,"ion-icon",4),e.k0s()}}function oe(i,c){if(1&i&&(e.j41(0,"div",18),e.nrm(1,"ion-icon",32),e.j41(2,"span",33)(3,"strong"),e.EFF(4),e.k0s(),e.nrm(5,"br"),e.EFF(6),e.nI1(7,"date"),e.k0s()()),2&i){const o=e.XpG().$implicit,n=e.XpG(2);e.R7$(),e.Y8G("name","negocio"===n.getEffectiveDeliveryType(o)?"time-outline":"truck-outline")("color",n.getDeliveryTypeColor(n.getEffectiveDeliveryType(o))),e.R7$(3),e.SpI("",n.getScheduledLabel(o),":"),e.R7$(2),e.SpI(" ",e.i5U(7,4,n.getScheduledDate(o),"dd/MM/yyyy HH:mm")," ")}}function ie(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-item-option",34),e.bIt("click",function(){e.eBV(o);const t=e.XpG().$implicit,r=e.XpG(2);return e.Njj(r.cancelarPedido(t))}),e.nrm(1,"ion-icon",35),e.j41(2,"div",30),e.EFF(3,"Cancelar"),e.k0s()()}}function re(i,c){if(1&i){const o=e.RV6();e.j41(0,"ion-list")(1,"ion-item-sliding",10)(2,"ion-item",11)(3,"ion-label",12)(4,"div",13),e.nrm(5,"ion-icon",14),e.j41(6,"h2",15),e.EFF(7),e.nI1(8,"currency"),e.k0s()(),e.j41(9,"div",16)(10,"div",17)(11,"div",18),e.nrm(12,"ion-icon",19),e.j41(13,"span",20),e.EFF(14),e.k0s()(),e.j41(15,"div",18),e.nrm(16,"ion-icon",21),e.j41(17,"span",20),e.EFF(18),e.k0s()()(),e.j41(19,"div",22)(20,"div",18),e.nrm(21,"ion-icon",21),e.j41(22,"span",20),e.EFF(23),e.k0s()(),e.DNE(24,oe,8,7,"div",23),e.k0s()(),e.j41(25,"div",24)(26,"ion-chip",25)(27,"ion-label"),e.EFF(28),e.k0s()(),e.j41(29,"ion-chip",26),e.nrm(30,"ion-icon",27),e.j41(31,"ion-label"),e.EFF(32),e.k0s()()()()(),e.j41(33,"ion-item-options")(34,"ion-item-option",28),e.bIt("click",function(){const t=e.eBV(o).$implicit,r=e.XpG(2);return e.Njj(r.openPedidoDetalle(t))}),e.nrm(35,"ion-icon",29),e.j41(36,"div",30),e.EFF(37,"Ver Detalle"),e.k0s()(),e.DNE(38,ie,4,0,"ion-item-option",31),e.k0s()()()}if(2&i){const o=c.$implicit,n=e.XpG(2);e.R7$(7),e.SpI(" ",e.iJd(8,14,e.eq3(20,ee,o.total))," MXN "),e.R7$(7),e.SpI(" ","Tarjeta"===o.tipo_pago&&o.nombre_tarjeta?o.nombre_tarjeta:o.nombre_cliente," "),e.R7$(2),e.Y8G("color",n.getColorIcon(o.estatus))("name",n.getStatusIcon(o.estatus)),e.R7$(2),e.JRh(n.getDisplayStatus(o)),e.R7$(3),e.Y8G("color",n.getDeliveryTypeColor(n.getEffectiveDeliveryType(o)))("name",n.getDeliveryTypeIcon(n.getEffectiveDeliveryType(o))),e.R7$(2),e.SpI(" ","domicilio"===n.getEffectiveDeliveryType(o)?"Entrega a domicilio":"Recolecci\xf3n en negocio"," "),e.R7$(),e.Y8G("ngIf",n.getScheduledDate(o)),e.R7$(4),e.JRh(o.tipo_pago),e.R7$(),e.Y8G("color",n.getDeliveryTypeColor(n.getEffectiveDeliveryType(o))),e.R7$(),e.Y8G("name",n.getDeliveryTypeIcon(n.getEffectiveDeliveryType(o))),e.R7$(2),e.JRh("domicilio"===n.getEffectiveDeliveryType(o)?"Domicilio":"Negocio"),e.R7$(6),e.Y8G("ngIf","cancelado"!==o.estatus.toLowerCase()&&"entregado"!==o.estatus.toLowerCase())}}function ae(i,c){if(1&i&&(e.qex(0),e.DNE(1,re,39,22,"ion-list",9),e.bVm()),2&i){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.pedidosFiltrados)}}function se(i,c){1&i&&(e.j41(0,"ion-item",10)(1,"ion-avatar",37),e.nrm(2,"ion-skeleton-text",38),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",39),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",40),e.k0s()()())}function ce(i,c){1&i&&(e.j41(0,"ion-list"),e.DNE(1,se,8,0,"ion-item",36),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,ne)))}function le(i,c){1&i&&(e.j41(0,"div",41),e.nrm(1,"ion-icon",42),e.j41(2,"h3"),e.EFF(3,"No hay pedidos disponibles"),e.k0s()())}const de=[{path:"",component:(()=>{var i;class c{constructor(n,t){this.modalCtrl=n,this.alertController=t,this.showModal=!1,this.isEditing=!1,this.pedidos=[],this.detalle_pedido=[],this.loading=!1,this.searchTerm="",this.filtersApplied=!1,this.pedidosFiltrados=[],this.utilsSvc=(0,e.WQX)(M.T),this.firebaseSvc=(0,e.WQX)(k.f),this.fecha=(new Date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}ngOnInit(){this.fecha=this.fecha.charAt(0).toUpperCase()+this.fecha.slice(1),this.getPedidos()}normalizeDateLike(n){if(!n)return null;if(null!=n&&n.toDate&&"function"==typeof n.toDate){const r=n.toDate();return new Date(r.getFullYear(),r.getMonth(),r.getDate())}if(null!=n&&n.seconds){const r=new Date(1e3*n.seconds);return new Date(r.getFullYear(),r.getMonth(),r.getDate())}const t=new Date(n);return isNaN(t.getTime())?null:new Date(t.getFullYear(),t.getMonth(),t.getDate())}isTodayDateLike(n){const t=this.normalizeDateLike(n);if(!t)return!1;const r=new Date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());return t.getTime()===a.getTime()}getPedidos(){var n=this;this.loading=!0;let r=this.firebaseSvc.getCollectionData("pedidos",[]).subscribe({next:(a=(0,m.A)(function*(s){if(Array.isArray(s)){n.pedidos=s;const d=n.pedidos.map(function(){var u=(0,m.A)(function*(p){var y;let me=`users/${p.uid_cliente}`;try{const v=yield n.firebaseSvc.getDocument(me);p.nombre_cliente="Tarjeta"===p.tipo_pago&&v.name?v.name:v.name+" "+v.mother_Last_Name+" "+v.father_Last_Name}catch{p.nombre_cliente=""}return n.isTodayDateLike(null!==(y=null==p?void 0:p.fecha_entrega)&&void 0!==y?y:null==p?void 0:p.fecha)&&n.firebaseSvc.getCollectionData(`pedidos/${p.id}/detalle_pedido`,[]).subscribe({next:v=>{p.detalle_pedido=v,p.detalle_pedido.forEach(function(){var fe=(0,m.A)(function*(C){const he=`productos/${C.uid_producto}`;try{let b=yield n.firebaseSvc.getDocument(he);C.producto=b,C.producto.imagen=b.imagen}catch{}});return function(C){return fe.apply(this,arguments)}}())},error:v=>console.error("Error al obtener datos:",v)}),p});return function(p){return u.apply(this,arguments)}}());yield Promise.all(d);const f=n.pedidos.filter(u=>{var p;return n.isTodayDateLike(null!==(p=null==u?void 0:u.fecha_entrega)&&void 0!==p?p:null==u?void 0:u.fecha)});n.pedidosFiltrados=n.sortOrdersByPriority(f),n.loading=!1}else n.pedidos=[],n.pedidosFiltrados=[],n.loading=!1;r.unsubscribe()}),function(d){return a.apply(this,arguments)}),error:a=>{console.error("Error al obtener pedidos:",a),this.loading=!1}});var a}sortOrdersByPriority(n){return n.sort((t,r)=>{const a=this.getOrderPriority(t.estatus),s=this.getOrderPriority(r.estatus);if(a===s){var d,f;const u=this.toDateTime(null!==(d=null==t?void 0:t.fecha_entrega)&&void 0!==d?d:null==t?void 0:t.fecha)||new Date(0);return(this.toDateTime(null!==(f=null==r?void 0:r.fecha_entrega)&&void 0!==f?f:null==r?void 0:r.fecha)||new Date(0)).getTime()-u.getTime()}return a-s})}getOrderPriority(n){const t=this.normalizeText(n);return t.includes("pedido confirmado")?1:t.includes("en preparacion")||t.includes("en preparaci\xf3n")?2:t.includes("en espera de recoleccion")||t.includes("en espera de recolecci\xf3n")||t.includes("en proceso de entrega")?3:t.includes("entregado")?4:t.includes("cancelado")?5:6}closeModal(){this.showModal=!1}refreshOrders(){this.getPedidos()}openFilterModal(){var n=this;return(0,m.A)(function*(){const r=yield n.modalCtrl.create({component:T.w,componentProps:{estatus:!0}});yield r.present();const{data:a}=yield r.onDidDismiss();a&&n.applyFilter(a)})()}applyFilter(n){this.filtersApplied=!0;const t=d=>this.normalizeDateLike(d),r=n.fechaInicio?t(n.fechaInicio):null,a=n.fechaFin?t(n.fechaFin):null,s=this.pedidos.filter(d=>{var f;if(n.selectedStatus&&n.selectedStatus.length&&!n.selectedStatus.includes(d.estatus))return!1;const u=this.normalizeDateLike(null!==(f=null==d?void 0:d.fecha_entrega)&&void 0!==f?f:null==d?void 0:d.fecha);return!(r&&a&&(!u||u<r||u>a)||null!==n.precioMin&&null!==n.precioMax&&(d.total<n.precioMin||d.total>n.precioMax))});this.pedidosFiltrados=this.sortOrdersByPriority(s)}clearFilters(){const n=this.pedidos.filter(t=>{var r;return this.isTodayDateLike(null!==(r=null==t?void 0:t.fecha_entrega)&&void 0!==r?r:null==t?void 0:t.fecha)});this.pedidosFiltrados=this.sortOrdersByPriority(n),this.filtersApplied=!1}filterPedidos(){const n=(this.searchTerm||"").toLowerCase(),r=this.pedidos.filter(a=>{var s;return this.isTodayDateLike(null!==(s=null==a?void 0:a.fecha_entrega)&&void 0!==s?s:null==a?void 0:a.fecha)}).filter(a=>(a.nombre_cliente||"").toLowerCase().includes(n)||(Number.isFinite(a.total)?a.total.toFixed(2):"").includes(n)||(a.id||"").toLowerCase().includes(n)||(a.estatus||"").toLowerCase().includes(n));this.pedidosFiltrados=this.sortOrdersByPriority(r)}getStatusIcon(n){switch(n.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}cancelarPedido(n){var t=this;return(0,m.A)(function*(){var a;yield(yield t.alertController.create({header:"Cancelar Pedido",mode:"ios",message:"\xbfRealmente deseas cancelar el pedido?",cssClass:"custom-alert",buttons:[{text:"Cancelar",role:"cancel",cssClass:"alert-cancel",handler:()=>{}},{text:"Confirmar",cssClass:"alert-confirm",handler:(a=(0,m.A)(function*(){let s=`pedidos/${n.id}`;const d=yield t.utilsSvc.loading();yield d.present(),n.estatus="Cancelado",t.firebaseSvc.updateDocumet(s,{estatus:n.estatus}).then(function(){var f=(0,m.A)(function*(u){t.utilsSvc.presentToast({message:"Pedido cancelado",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"})});return function(u){return f.apply(this,arguments)}}()).catch(f=>{t.utilsSvc.presentToast({message:f.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{d.dismiss()})}),function(){return a.apply(this,arguments)})}],backdropDismiss:!1})).present()})()}getColorIcon(n){switch(n.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}openPedidoDetalle(n){var t=this;return(0,m.A)(function*(){(yield t.utilsSvc.presentModal({component:q,componentProps:{pedido:n}}))&&(t.utilsSvc.presentToast({message:"Pedido en preparaci\xf3n",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"}),t.getPedidos())})()}openTermsModal(){var n=this;return(0,m.A)(function*(){(yield n.utilsSvc.presentModal({component:(yield g.e(3405).then(g.bind(g,3405))).TermsComponent,componentProps:{}}))&&n.utilsSvc.presentToast({message:"T\xe9rminos aceptados",duration:2e3,color:"primary",position:"bottom",icon:"checkmark-circle-outline"})})()}getDeliveryTypeIcon(n){switch(null==n?void 0:n.toLowerCase()){case"domicilio":return"home-outline";case"negocio":return"storefront-outline";default:return"location-outline"}}getDeliveryTypeColor(n){switch(null==n?void 0:n.toLowerCase()){case"domicilio":return"primary";case"negocio":return"success";default:return"medium"}}doRefresh(n){setTimeout(()=>{this.getPedidos(),n.target.complete()},1e3)}hasUbicacion(n){var t,r;if(!n)return!1;const a=null==n?void 0:n.geopoint_entrega,s=a&&"number"==typeof a.latitude&&"number"==typeof a.longitude&&!isNaN(a.latitude)&&!isNaN(a.longitude),d="number"==typeof(null==n?void 0:n.lat)&&"number"==typeof(null==n?void 0:n.lng)||"number"==typeof(null==n||null===(t=n.coordenadas)||void 0===t?void 0:t.lat)&&"number"==typeof(null==n||null===(r=n.coordenadas)||void 0===r?void 0:r.lng);return!(!s&&!d)}getEffectiveDeliveryType(n){if(!0===(null==n?void 0:n.es_recoleccion_negocio)||"negocio"===(null==n?void 0:n.metodo_entrega)||"negocio"===(null==n?void 0:n.tipo_entrega)||null!=n&&n.hora_recoleccion)return"negocio";const t=((null==n?void 0:n.tipo_entrega)||"").toLowerCase();return t?"domicilio"===t&&this.hasUbicacion(n)?"domicilio":"negocio":this.hasUbicacion(n)?"domicilio":"negocio"}getScheduledDate(n){return null!=n&&n.hora_recoleccion?this.toDateTime(n.hora_recoleccion):null!=n&&n.fecha_entrega?this.toDateTime(n.fecha_entrega):null!=n&&n.fecha?this.toDateTime(n.fecha):null}getScheduledLabel(n){return"negocio"===this.getEffectiveDeliveryType(n)?null!=n&&n.hora_recoleccion?"Horario de recolecci\xf3n":null!=n&&n.fecha_entrega?"Horario programado":"Fecha del pedido":"Horario de entrega"}toDateTime(n){if(!n)return null;if(null!=n&&n.toDate&&"function"==typeof n.toDate)return n.toDate();if(null!=n&&n.seconds)return new Date(1e3*n.seconds);const t=new Date(n);return isNaN(t.getTime())?null:t}normalizeText(n=""){return String(n||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}getDisplayStatus(n){const t=n.estatus;return"domicilio"===this.getEffectiveDeliveryType(n)&&this.normalizeText(t).includes(this.normalizeText("En espera de recolecci\xf3n"))?"En proceso de entrega":t}}return(i=c).\u0275fac=function(n){return new(n||i)(e.rXU(l.W3),e.rXU(l.hG))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-pedidos"]],decls:13,vars:6,consts:[["title","Pedidos",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","animated","true","placeholder","Cliente, productos, precio o c\xf3digo",3,"ngModelChange","ionInput","ngModel"],["expand","block","color","primary",3,"click"],["name","filter-outline",2,"margin-left","0.5rem"],["expand","block","color","light",3,"click",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["expand","block","color","light",3,"click"],[4,"ngFor","ngForOf"],[1,"product-item"],[1,"pedido-item"],[1,"pedido-label"],[1,"pedido-total"],["name","cash-outline","color","danger"],[1,"total-amount"],[1,"pedido-main-info"],[1,"pedido-info"],[1,"info-row"],["name","person-outline"],[1,"info-text"],[3,"color","name"],[1,"pedido-delivery-schedule"],["class","info-row",4,"ngIf"],[1,"pedido-chips"],["color","primary","mode","ios","outline","true"],["mode","ios","outline","true",3,"color"],[3,"name"],["color","secondary",3,"click"],["name","eye-outline"],[1,"option-text"],["color","danger",3,"click",4,"ngIf"],[3,"name","color"],[1,"info-text","schedule-text"],["color","danger",3,"click"],["name","close-circle-outline"],["class","product-item",4,"ngFor","ngForOf"],["slot","start"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(n,t){1&n&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(a){return t.doRefresh(a)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"ion-searchbar",2),e.mxI("ngModelChange",function(a){return e.DH7(t.searchTerm,a)||(t.searchTerm=a),a}),e.bIt("ionInput",function(){return t.filterPedidos()}),e.k0s(),e.j41(5,"ion-button",3),e.bIt("click",function(){return t.openFilterModal()}),e.j41(6,"span"),e.EFF(7,"Filtros"),e.k0s(),e.nrm(8,"ion-icon",4),e.k0s(),e.DNE(9,te,4,0,"ion-button",5)(10,ae,2,1,"ng-container",6)(11,ce,2,2,"ion-list",6)(12,le,4,0,"div",7),e.k0s()),2&n&&(e.Y8G("showMenu",!0),e.R7$(4),e.R50("ngModel",t.searchTerm),e.R7$(5),e.Y8G("ngIf",t.filtersApplied),e.R7$(),e.Y8G("ngIf",t.pedidosFiltrados.length>0),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",!t.loading&&!t.pedidosFiltrados.length))},dependencies:[h.Sq,h.bT,P.BC,P.vS,l.mC,l.Jm,l.ZB,l.W9,l.iq,l.uz,l.LU,l.CE,l.A7,l.he,l.nf,l.To,l.Ki,l.S1,l.ds,l.Gw,F.l,h.oe,h.vh],styles:['@charset "UTF-8";.fecha[_ngcontent-%COMP%]{font-weight:700;color:gray;margin-left:1rem}.empty-state-container[_ngcontent-%COMP%]{display:flex;margin-top:3rem;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;color:#7d7d7d}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;color:#b0b0b0}.empty-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:.5rem 0}.empty-message[_ngcontent-%COMP%]{font-size:1rem;color:#7a7a7a;margin-bottom:1.5rem;padding:0 2rem}.empty-action[_ngcontent-%COMP%]{--border-radius: 8px}.custom-alert[_ngcontent-%COMP%]{--background: #fff;--border-radius: 16px;--width: 90%;--min-height: 200px;--max-width: 500px;--color: #333;text-align:center}.custom-alert[_ngcontent-%COMP%]   .alert-wrapper[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_zoomIn .3s ease forwards}.custom-alert[_ngcontent-%COMP%]   .alert-button[_ngcontent-%COMP%]{--border-radius: 12px;--padding-top: 12px;--padding-bottom: 12px;font-weight:700}.custom-alert[_ngcontent-%COMP%]   .alert-cancel[_ngcontent-%COMP%]{color:#999}.custom-alert[_ngcontent-%COMP%]   .alert-confirm[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-danger)}@keyframes _ngcontent-%COMP%_zoomIn{0%{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}.pedido-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px;--inner-padding-end: 8px;margin-bottom:8px}.pedido-label[_ngcontent-%COMP%]{display:flex!important;flex-direction:column;gap:12px;padding:8px 0;white-space:normal!important;overflow:visible!important;text-overflow:unset!important}.pedido-total[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.pedido-total[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem;min-width:20px}.pedido-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--ion-color-dark);word-break:break-word}.pedido-info[_ngcontent-%COMP%], .pedido-delivery[_ngcontent-%COMP%], .pedido-schedule[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.info-row[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;min-height:24px}.info-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem;min-width:16px;margin-top:2px;flex-shrink:0}.info-row[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{flex:1;font-weight:500;line-height:1.3;word-break:break-word;-webkit-hyphens:auto;hyphens:auto;overflow-wrap:break-word}.info-row[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]{font-size:.9rem}.info-row[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600}.pedido-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin:0;max-width:100%}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:4px}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;align-items:center;min-width:80px}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{font-size:.8rem;margin-top:4px;text-align:center;white-space:nowrap}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem;margin:0}@media (min-width: 768px){.pedido-item[_ngcontent-%COMP%]{--padding-start: 20px;--padding-end: 20px;margin-bottom:12px}.pedido-label[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;align-items:flex-start;gap:16px;padding:12px 0}.pedido-total[_ngcontent-%COMP%]{flex:0 0 auto;margin-bottom:0;min-width:180px}.pedido-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:1.3rem}.pedido-main-info[_ngcontent-%COMP%]{display:flex;flex:1;gap:20px;align-items:flex-start;min-width:0}.pedido-info[_ngcontent-%COMP%]{flex:1;min-width:200px}.pedido-delivery-schedule[_ngcontent-%COMP%]{flex:1;min-width:250px}.pedido-chips[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:0;align-items:flex-start;min-width:200px}.info-row[_ngcontent-%COMP%]{min-height:22px}.info-row[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{font-size:.95rem}.info-row[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]{font-size:.9rem}.info-row[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]   br[_ngcontent-%COMP%]{display:none}.info-row[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:after{content:" "}}@media (min-width: 1024px){.pedido-item[_ngcontent-%COMP%]{--padding-start: 24px;--padding-end: 24px}.pedido-label[_ngcontent-%COMP%]{gap:24px;padding:16px 0}.pedido-total[_ngcontent-%COMP%]{min-width:200px}.pedido-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:1.4rem}.pedido-main-info[_ngcontent-%COMP%]{gap:30px}.pedido-info[_ngcontent-%COMP%]{min-width:220px}.pedido-delivery-schedule[_ngcontent-%COMP%]{min-width:280px}.pedido-chips[_ngcontent-%COMP%]{min-width:220px}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{max-width:140px}}@media (max-width: 480px){.pedido-item[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px}.pedido-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:1.1rem}.info-row[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{font-size:.9rem}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.8rem;max-width:100px}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]{min-width:70px}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{font-size:.7rem}ion-item-options[_ngcontent-%COMP%]   ion-item-option[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}}@media (max-width: 360px){.pedido-label[_ngcontent-%COMP%]{gap:8px}.pedido-total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:1rem}.info-row[_ngcontent-%COMP%]{gap:6px}.info-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.9rem;min-width:14px}.info-row[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{font-size:.85rem}.pedido-chips[_ngcontent-%COMP%]{gap:6px}.pedido-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.75rem;max-width:80px}}']}),c})()}];let pe=(()=>{var i;class c{}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[w.iI.forChild(de),w.iI]}),c})();var ge=g(7383);let ue=(()=>{var i;class c{}return(i=c).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[h.MD,P.YN,l.bv,pe,ge.G]}),c})()}}]);