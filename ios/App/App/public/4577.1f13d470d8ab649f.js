"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4577],{4577:(ue,M,m)=>{m.r(M),m.d(M,{HistorialPedidosPageModule:()=>ce});var _=m(177),b=m(9417),s=m(5933),F=m(8265),g=m(467),e=m(4438),k=m(8663),y=m(2723),w=(m(4511),m(7239)),E=m.n(w),C=m(2739),O=m(2233),D=m(7157),T=m(8288),I=m(8461);const j=["sliderButton"],S=["mapContainer"];function R(n,l){if(1&n&&(e.j41(0,"p"),e.nrm(1,"ion-icon",29),e.EFF(2),e.nI1(3,"date"),e.k0s()),2&n){const i=e.XpG();e.R7$(2),e.SpI(" Fecha de entrega: ",e.i5U(3,1,null==i.pedido.fecha?null:i.pedido.fecha.toDate(),"dd/MM/yyyy HH:mm"),"")}}function $(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-button",38),e.bIt("click",function(){e.eBV(i);const o=e.XpG(2);return e.Njj(o.loadMapPreview())}),e.nrm(1,"ion-icon",39),e.EFF(2," Ver mapa "),e.k0s()}}function G(n,l){1&n&&e.nrm(0,"div",44,0)}function H(n,l){1&n&&(e.j41(0,"div",45),e.nrm(1,"ion-spinner",46),e.j41(2,"p"),e.EFF(3,"Cargando mapa..."),e.k0s()())}function z(n,l){if(1&n){const i=e.RV6();e.j41(0,"div",47),e.nrm(1,"ion-icon",48),e.j41(2,"p"),e.EFF(3,"No se pudo cargar el mapa"),e.k0s(),e.j41(4,"ion-button",49),e.bIt("click",function(){e.eBV(i);const o=e.XpG(3);return e.Njj(o.openLocationInMaps())}),e.EFF(5," Ver en Google Maps "),e.k0s()()}}function A(n,l){if(1&n&&(e.j41(0,"div",40),e.DNE(1,G,2,0,"div",41)(2,H,4,0,"div",42)(3,z,6,0,"div",43),e.k0s()),2&n){const i=e.XpG(2);e.R7$(),e.Y8G("ngIf",!i.mapLoadError),e.R7$(),e.Y8G("ngIf",i.showMapPreview&&!i.isMapReady&&!i.mapLoadError),e.R7$(),e.Y8G("ngIf",i.mapLoadError)}}function N(n,l){if(1&n){const i=e.RV6();e.j41(0,"div",4)(1,"h3",12),e.nrm(2,"ion-icon",30),e.EFF(3," Ubicaci\xf3n de Entrega "),e.k0s(),e.j41(4,"div",31),e.DNE(5,$,3,0,"ion-button",32),e.j41(6,"ion-button",33),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.openLocationInMaps())}),e.nrm(7,"ion-icon",34),e.EFF(8," Abrir en Maps "),e.k0s()(),e.DNE(9,A,4,3,"div",35),e.j41(10,"div",36)(11,"p"),e.nrm(12,"ion-icon",37),e.EFF(13),e.nI1(14,"number"),e.nI1(15,"number"),e.k0s()()()}if(2&n){const i=e.XpG();e.R7$(5),e.Y8G("ngIf",!i.showMapPreview),e.R7$(4),e.Y8G("ngIf",i.showMapPreview),e.R7$(4),e.Lme(" Coordenadas: ",e.i5U(14,4,i.pedido.geopoint_entrega.latitude,"1.6-6"),", ",e.i5U(15,7,i.pedido.geopoint_entrega.longitude,"1.6-6")," ")}}function Y(n,l){1&n&&(e.j41(0,"div",4)(1,"h3",12),e.nrm(2,"ion-icon",50),e.EFF(3," Recolecci\xf3n en Negocio "),e.k0s(),e.j41(4,"div",51)(5,"p"),e.nrm(6,"ion-icon",52),e.EFF(7," Direcci\xf3n: Tortiller\xeda Plata Jaimes"),e.k0s(),e.j41(8,"p"),e.nrm(9,"ion-icon",53),e.EFF(10," Horario de atenci\xf3n: 8:00 AM - 8:00 PM"),e.k0s(),e.j41(11,"p"),e.nrm(12,"ion-icon",54),e.EFF(13," Tel\xe9fono: (555) 123-4567"),e.k0s()()())}function X(n,l){if(1&n&&(e.j41(0,"p"),e.EFF(1,"Tama\xf1o de tortilla: "),e.j41(2,"span",57),e.EFF(3),e.k0s()()),2&n){const i=e.XpG().$implicit;e.R7$(3),e.JRh(i.tamano_tortilla)}}function U(n,l){if(1&n&&(e.j41(0,"ion-item")(1,"ion-avatar",55),e.nrm(2,"img",56),e.k0s(),e.j41(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.DNE(6,X,4,1,"p",8),e.j41(7,"p"),e.EFF(8),e.k0s(),e.j41(9,"p"),e.EFF(10,"Subtotal: "),e.j41(11,"span",57),e.EFF(12),e.nI1(13,"currency"),e.k0s()()(),e.j41(14,"ion-badge",58),e.nrm(15,"ion-icon",59),e.EFF(16),e.k0s()()),2&n){const i=l.$implicit;e.R7$(2),e.FS9("alt",i.producto.nombre),e.Y8G("src",i.producto.imagen,e.B4B),e.R7$(3),e.JRh(i.producto.nombre),e.R7$(),e.Y8G("ngIf",i.tamano_tortilla),e.R7$(2),e.SpI("Cantidad: ",i.cantidad,""),e.R7$(4),e.JRh(e.bMT(13,7,i.subtotal)),e.R7$(4),e.SpI(" ",i.cantidad," ")}}function B(n,l){if(1&n&&e.nrm(0,"qr-code",60),2&n){const i=e.XpG();e.Y8G("value",i.qrText)}}function V(n,l){1&n&&e.nrm(0,"img",61)}function J(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-button",62),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.captureScreen())}),e.EFF(1," Compartir "),e.nrm(2,"ion-icon",63),e.k0s()}}let Q=(()=>{var n;class l{constructor(t,o,a,r){this.loadingController=t,this.platform=o,this.modalCtrl=a,this.alertCtrl=r,this.qrText="",this.sliderValue=0,this.showAnimation=!1,this.firebaseSvc=(0,e.WQX)(k.f),this.utilSvc=(0,e.WQX)(y.T),this.rating=3,this.isMapReady=!1,this.businessLocation=null,this.mapLoadError=!1,this.showMapPreview=!1,this.utilsSvc=(0,e.WQX)(y.T)}ngOnInit(){var o,t=this;console.log(this.pedido),this.qrText=JSON.stringify({uid_pedido:this.pedido.id}),this.pedido.detalle_pedido||(this.pedido.detalle_pedido=[]);const p=this.pedido.detalle_pedido.map(function(){var c=(0,g.A)(function*(u){const f=`productos/${u.uid_producto}`;try{let d=yield t.firebaseSvc.getDocument(f);u.producto=d}catch(d){console.error("Error al obtener detalles del producto:",d)}});return function(u){return c.apply(this,arguments)}}());Promise.all(p).then(()=>{console.log("Todos los detalles de productos han sido obtenidos:",this.pedido.detalle_pedido)}).catch(c=>{console.error("Error al obtener detalles de productos:",c)}),this.pedido.rating&&(this.rating=this.pedido.rating),"domicilio"===(null===(o=this.pedido.tipo_entrega)||void 0===o?void 0:o.toLowerCase())&&this.loadBusinessLocation()}ngAfterViewInit(){}loadBusinessLocation(){var t=this;return(0,g.A)(function*(){try{t.firebaseSvc.getCollectionData("direccionNegocio").subscribe(o=>{o&&o.length>0&&(t.businessLocation=o[0])})}catch(o){console.error("Error loading business location:",o)}})()}loadMapPreview(){var t=this;return(0,g.A)(function*(){t.showMapPreview||!t.pedido.geopoint_entrega||(t.showMapPreview=!0,setTimeout(()=>{t.loadLeafletMap()},100))})()}loadLeafletMap(){var t;if(null!==(t=this.mapContainer)&&void 0!==t&&t.nativeElement&&this.pedido.geopoint_entrega)try{this.loadLeafletAssets().then(()=>{this.initializeLeafletMap()}).catch(o=>{console.error("Error loading Leaflet:",o),this.mapLoadError=!0})}catch(o){console.error("Error initializing map:",o),this.mapLoadError=!0}else this.mapLoadError=!0}loadLeafletAssets(){return new Promise((t,o)=>{if(typeof L<"u")return void t();const a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(a);const r=document.createElement("script");r.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",r.onload=()=>t(),r.onerror=()=>o(new Error("Failed to load Leaflet")),document.head.appendChild(r)})}initializeLeafletMap(){try{var t;const o=[this.pedido.geopoint_entrega.latitude,this.pedido.geopoint_entrega.longitude];this.map=L.map(this.mapContainer.nativeElement,{center:o,zoom:15,zoomControl:!0,attributionControl:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map);const a=L.divIcon({html:'<ion-icon name="home" style="color: #3880ff; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});if(L.marker(o,{icon:a}).addTo(this.map).bindPopup("Direcci\xf3n de entrega"),null!==(t=this.businessLocation)&&void 0!==t&&t.geopoint){const r=[this.businessLocation.geopoint.latitude,this.businessLocation.geopoint.longitude],p=L.divIcon({html:'<ion-icon name="storefront" style="color: #10dc60; font-size: 24px;"></ion-icon>',iconSize:[30,30],iconAnchor:[15,15],className:"custom-div-icon"});L.marker(r,{icon:p}).addTo(this.map).bindPopup("Tortiller\xeda Plata Jaimes");const c=L.featureGroup([L.marker(o),L.marker(r)]);this.map.fitBounds(c.getBounds().pad(.1))}setTimeout(()=>{this.map.invalidateSize(),this.isMapReady=!0},200)}catch(o){console.error("Error initializing Leaflet map:",o),this.mapLoadError=!0}}openLocationInMaps(){if(!this.pedido.geopoint_entrega)return;const a=`https://www.google.com/maps?q=${this.pedido.geopoint_entrega.latitude},${this.pedido.geopoint_entrega.longitude}`;this.platform.is("capacitor")?window.open(a,"_system"):window.open(a,"_blank")}onSliderChange(){var t=this;return(0,g.A)(function*(){if(100===t.sliderValue){const o=yield t.utilsSvc.loading();yield o.present(),t.showAnimation=!0,t.firebaseSvc.updateDocumet(`pedidos/${t.pedido.id}`,{estatus:"En preparaci\xf3n"}).then(function(){var r=(0,g.A)(function*(p){setTimeout(()=>{t.showAnimation=!1,t.sliderValue=0,t.pedido.estatus="En preparaci\xf3n",t.utilsSvc.dismissModal({success:!0})},3e3)});return function(p){return r.apply(this,arguments)}}()).catch(r=>{t.utilSvc.presentToast({message:r.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{o.dismiss()})}})()}getColorIcon(t){switch(t.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}captureScreen(){const t=document.getElementById("qrImage");E()(t).then(o=>{this.platform.is("capacitor")?this.shareImage(o):this.dowloadImage(o)})}shareImage(t){var o=this;return(0,g.A)(function*(){const a=yield o.loadingController.create({spinner:"crescent"});yield a.present();const r=t.toDataURL(),p="qr.png";yield C.YA.writeFile({path:p,data:r,directory:C.__.Cache}).then(function(){var c=(0,g.A)(function*(u){let f=u.uri;yield O.S.share({url:f}),yield C.YA.deleteFile({path:p,directory:C.__.Cache})});return function(u){return c.apply(this,arguments)}}()).finally(()=>{a.dismiss()})})()}dowloadImage(t){const o=document.createElement("a");o.href=t.toDataURL(),o.download="qr.png",o.click()}getStatusIcon(t){switch(t.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}reorderProducts(){var t=this;return(0,g.A)(function*(){var a;yield(yield t.alertCtrl.create({header:"Confirmar Pedido",message:"\xbfDeseas agregar estos productos al carrito de compras?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:(a=(0,g.A)(function*(){const r=t.utilsSvc.getFromLocalStorage("carrito")||[],p=t.utilsSvc.getFromLocalStorage("user"),c=r[0]||{uid_cliente:p.uid,detalle_carrito:[],total:0};t.pedido.detalle_pedido.forEach(d=>{const h=c.detalle_carrito.findIndex(v=>v.uid_producto===d.uid_producto&&v.uid_opcion===d.uid_opcion);h>-1?(c.detalle_carrito[h].cantidad+=d.cantidad,c.detalle_carrito[h].subtotal+=d.subtotal):c.detalle_carrito.push({uid_producto:d.uid_producto,uid_opcion:d.uid_opcion,nombre:d.producto.nombre,cantidad:d.cantidad,subtotal:d.subtotal})}),c.total+=t.pedido.detalle_pedido.reduce((d,h)=>d+h.subtotal,0),t.utilsSvc.setElementInLocalstorage("carrito",[c]);const u=p.uid,f=c.id||t.firebaseSvc.firestore.createId();c.id=f;try{yield t.firebaseSvc.setDocument(`users/${u}/carrito/${f}`,{total:c.total});for(const d of c.detalle_carrito){const h=d.id||t.firebaseSvc.firestore.createId();d.id=h,yield t.firebaseSvc.setDocument(`users/${u}/carrito/${f}/detalle_carrito/${h}`,d)}console.log("Carrito actualizado en Firebase:",c)}catch(d){console.error("Error al actualizar el carrito en Firebase:",d)}t.utilsSvc.presentToast({message:"Productos agregados al carrito",duration:2500,color:"primary",position:"bottom",icon:"cart-outline"})}),function(){return a.apply(this,arguments)})}]})).present()})()}rateService(){var t=this;return(0,g.A)(function*(){var a;yield(yield t.alertCtrl.create({header:"Calificar Servicio",message:`\xbfDeseas calificar este pedido con ${t.rating} estrellas?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:(a=(0,g.A)(function*(){const r=yield t.utilsSvc.loading();yield r.present();const p=`pedidos/${t.pedido.id}`;try{yield t.firebaseSvc.updateDocumet(p,{rating:t.rating}),t.utilsSvc.presentToast({message:"Calificaci\xf3n guardada con \xe9xito",duration:2500,color:"primary",position:"bottom",icon:"star-outline"})}catch{t.utilsSvc.presentToast({message:"Error al guardar la calificaci\xf3n",duration:2500,color:"danger",position:"bottom",icon:"alert-circle-outline"})}finally{r.dismiss()}}),function(){return a.apply(this,arguments)})}]})).present()})()}getDeliveryTypeIcon(){var t;switch(null===(t=this.pedido.tipo_entrega)||void 0===t?void 0:t.toLowerCase()){case"domicilio":return"home-outline";case"negocio":return"storefront-outline";default:return"location-outline"}}getDeliveryTypeColor(){var t;switch(null===(t=this.pedido.tipo_entrega)||void 0===t?void 0:t.toLowerCase()){case"domicilio":return"primary";case"negocio":return"success";default:return"medium"}}isHomeDelivery(){var t;return"domicilio"===(null===(t=this.pedido.tipo_entrega)||void 0===t?void 0:t.toLowerCase())}}return(n=l).\u0275fac=function(t){return new(t||n)(e.rXU(s.Xi),e.rXU(D.OD),e.rXU(s.W3),e.rXU(s.hG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-detalle-pedido"]],viewQuery:function(t,o){if(1&t&&(e.GBs(j,5),e.GBs(S,5)),2&t){let a;e.mGM(a=e.lsd())&&(o.sliderButton=a.first),e.mGM(a=e.lsd())&&(o.mapContainer=a.first)}},inputs:{pedido:"pedido"},decls:60,vars:28,consts:[["mapContainer",""],["title","Detalles del pedido",3,"isModal","showNombre","showLogo"],[1,"ticket-container"],[1,"ticket-title"],[1,"ticket-section"],["name","storefront-outline"],["name","person-outline"],["name","calendar-outline"],[4,"ngIf"],[3,"name","color"],["mode","ios",3,"color"],["class","ticket-section",4,"ngIf"],[1,"ticket-subtitle"],[4,"ngFor","ngForOf"],["name","cash-outline"],["name","card-outline"],["slot","start",2,"margin-left","0.5rem",3,"color","name"],[1,"rating-section"],["min","1","max","5","step","1","snaps","true",3,"ngModelChange","ngModel"],["slot","start","name","star-outline"],["slot","end","name","star"],["expand","block","color","primary",3,"click"],[1,"segment-content"],["id","qrImage"],[1,"d-flex-center"],[1,"d-flex-center","qr-wrapper"],["size","190","errorCorrectionLevel","M",3,"value",4,"ngIf"],["class","qr-placeholder","src","../../../../../assets/img/qr.webp","alt","",4,"ngIf"],["class","submit ion-margin-top","expand","block",3,"click",4,"ngIf"],["slot","start","name","calendar-outline"],["name","map-outline","color","primary"],[1,"map-controls"],["fill","outline","size","small","class","map-preview-btn",3,"click",4,"ngIf"],["fill","outline","size","small",1,"external-maps-btn",3,"click"],["name","navigate-outline","slot","start"],["class","map-container",4,"ngIf"],[1,"delivery-info"],["name","location-outline","color","primary"],["fill","outline","size","small",1,"map-preview-btn",3,"click"],["name","map-outline","slot","start"],[1,"map-container"],["class","map-canvas",4,"ngIf"],["class","map-loading",4,"ngIf"],["class","map-error",4,"ngIf"],[1,"map-canvas"],[1,"map-loading"],["name","circles"],[1,"map-error"],["name","warning-outline","color","warning"],["size","small","fill","clear",3,"click"],["name","storefront-outline","color","success"],[1,"pickup-info"],["name","location-outline"],["name","time-outline"],["name","call-outline"],["slot","start",1,"avatar-icon"],[3,"src","alt"],[1,"subtotal"],["slot","end","color","tertiary"],["name","cube-outline"],["size","190","errorCorrectionLevel","M",3,"value"],["src","../../../../../assets/img/qr.webp","alt","",1,"qr-placeholder"],["expand","block",1,"submit","ion-margin-top",3,"click"],["slot","end","name","share-social-outline"]],template:function(t,o){1&t&&(e.nrm(0,"app-header",1),e.j41(1,"ion-content")(2,"div",2)(3,"h2",3),e.EFF(4,"Ticket de Pedido"),e.k0s(),e.j41(5,"div",4)(6,"p"),e.nrm(7,"ion-icon",5),e.EFF(8," Nombre del negocio: Tortilleria Plata Jaimes"),e.k0s(),e.j41(9,"p"),e.nrm(10,"ion-icon",6),e.EFF(11),e.k0s(),e.j41(12,"p"),e.nrm(13,"ion-icon",7),e.EFF(14),e.nI1(15,"date"),e.k0s(),e.DNE(16,R,4,4,"p",8),e.j41(17,"p"),e.nrm(18,"ion-icon",9),e.EFF(19," Tipo de entrega: "),e.j41(20,"ion-chip",10)(21,"ion-label"),e.EFF(22),e.k0s()()()(),e.DNE(23,N,16,10,"div",11)(24,Y,14,0,"div",11),e.j41(25,"h3",12),e.EFF(26,"Productos Comprados"),e.k0s(),e.j41(27,"ion-list"),e.DNE(28,U,17,9,"ion-item",13),e.k0s(),e.j41(29,"div",4)(30,"p"),e.nrm(31,"ion-icon",14),e.EFF(32),e.nI1(33,"number"),e.k0s(),e.j41(34,"p"),e.nrm(35,"ion-icon",15),e.EFF(36),e.k0s(),e.j41(37,"p"),e.EFF(38),e.nrm(39,"ion-icon",16),e.k0s()(),e.j41(40,"div",17)(41,"h3"),e.EFF(42,"Calificar Pedido"),e.k0s(),e.j41(43,"ion-item")(44,"ion-label"),e.EFF(45,"Calificaci\xf3n:"),e.k0s(),e.j41(46,"ion-range",18),e.mxI("ngModelChange",function(r){return e.DH7(o.rating,r)||(o.rating=r),r}),e.nrm(47,"ion-icon",19)(48,"ion-icon",20),e.k0s()(),e.j41(49,"ion-button",21),e.bIt("click",function(){return o.rateService()}),e.EFF(50,"Guardar Calificaci\xf3n"),e.k0s()(),e.j41(51,"ion-button",21),e.bIt("click",function(){return o.reorderProducts()}),e.EFF(52,"Pedir de nuevo"),e.k0s()(),e.j41(53,"div",22)(54,"div",23)(55,"div",24)(56,"div",25),e.DNE(57,B,1,1,"qr-code",26)(58,V,1,0,"img",27),e.k0s()()(),e.DNE(59,J,3,0,"ion-button",28),e.k0s()()),2&t&&(e.Y8G("isModal",!0)("showNombre",!1)("showLogo",!1),e.R7$(11),e.SpI(" Cliente: ",o.pedido.nombre_cliente,""),e.R7$(3),e.SpI(" Fecha: ",e.i5U(15,22,null==o.pedido.fecha?null:o.pedido.fecha.toDate(),"dd/MM/yyyy"),""),e.R7$(2),e.Y8G("ngIf","en espera de recolecci\xf3n"===o.pedido.estatus.toLowerCase()),e.R7$(2),e.Y8G("name",o.getDeliveryTypeIcon())("color",o.getDeliveryTypeColor()),e.R7$(2),e.Y8G("color",o.getDeliveryTypeColor()),e.R7$(2),e.JRh(o.pedido.tipo_entrega||"No especificado"),e.R7$(),e.Y8G("ngIf",o.isHomeDelivery()&&o.pedido.geopoint_entrega),e.R7$(),e.Y8G("ngIf","negocio"===(null==o.pedido.tipo_entrega?null:o.pedido.tipo_entrega.toLowerCase())),e.R7$(4),e.Y8G("ngForOf",o.pedido.detalle_pedido),e.R7$(4),e.SpI(" Total: ",e.i5U(33,25,o.pedido.total,"1.2-2"),""),e.R7$(4),e.SpI(" Tipo de Pago: ",o.pedido.tipo_pago,""),e.R7$(2),e.SpI("Estatus: ",o.pedido.estatus," "),e.R7$(),e.Y8G("color",o.getColorIcon(o.pedido.estatus))("name",o.getStatusIcon(o.pedido.estatus)),e.R7$(7),e.R50("ngModel",o.rating),e.R7$(11),e.Y8G("ngIf",o.qrText),e.R7$(),e.Y8G("ngIf",!o.qrText),e.R7$(),e.Y8G("ngIf",o.qrText))},dependencies:[_.Sq,_.bT,s.mC,s.In,s.Jm,s.ZB,s.W9,s.iq,s.uz,s.he,s.nf,s.Ob,s.w2,s.Gw,b.BC,b.vS,T.Um,I.l,_.QX,_.oe,_.vh],styles:['@charset "UTF-8";.ticket-container[_ngcontent-%COMP%]{padding:16px;background-color:#f7f7f7;border-radius:8px;margin:20px;box-shadow:0 4px 8px #0003}.ticket-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;text-align:center;color:#333;margin-bottom:1rem}.ticket-section[_ngcontent-%COMP%]{background-color:#fff;padding:12px;border-radius:8px;margin-bottom:1rem;box-shadow:0 2px 6px #0000001a}.ticket-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;color:#444;margin:.5rem 0;display:flex;align-items:center}.ticket-section[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}.ticket-subtitle[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:500;margin-top:1rem;margin-bottom:.5rem;color:#666}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{background-color:#fafafa;border-radius:6px;margin:4px 0;box-shadow:0 1px 3px #0000001a}.product-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1rem;color:#555}.ticket-section[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#28a745}ion-content[_ngcontent-%COMP%]{--ion-background-color: #e9ecef}.assign-slider-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding-top:50px;text-align:center}.assign-slider[_ngcontent-%COMP%]{width:80%;--knob-size: 36px;--bar-height: 24px;--knob-background: var(--ion-color-primary);--bar-background-active: var(--ion-color-primary);--bar-background: #ddd;--bar-border-radius: 50px}.success-animation[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:20px;animation:_ngcontent-%COMP%_fadeInScale .5s ease forwards}.success-animation[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:50px;color:var(--ion-color-primary);animation:_ngcontent-%COMP%_scaleUp .5s ease forwards}.success-animation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-primary);margin-top:8px}@keyframes _ngcontent-%COMP%_fadeInScale{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_scaleUp{0%{transform:scale(.5)}to{transform:scale(1)}}ion-item[_ngcontent-%COMP%]{--inner-padding-start: 10px;border-bottom:1px solid var(--ion-color-light)}.avatar-icon[_ngcontent-%COMP%]{background-color:var(--ion-color-light);display:flex;align-items:center;justify-content:center;border-radius:50%;height:40px;width:40px}.avatar-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700;font-size:16px;margin:0;color:var(--ion-color-dark)}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px;color:var(--ion-color-medium)}.subtotal[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-success)}ion-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;padding:5px;border-radius:10px;font-size:14px}ion-segment[_ngcontent-%COMP%]{margin-top:20px}.segment[_ngcontent-%COMP%]{padding:30px 5px}.submit[_ngcontent-%COMP%]{height:44px;--border-radius: 10px;--background: var(--ion-color-tertiary)}.scan-label[_ngcontent-%COMP%]{margin:25px 0}img[_ngcontent-%COMP%]{width:200px}.result[_ngcontent-%COMP%]{color:#000;border:1px dashed var(--ion-color-medium);border-radius:10px;margin:30px 0}.result[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-tertiary);margin-bottom:5px;font-size:11px}.result[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:0}ion-button[_ngcontent-%COMP%]{text-transform:none}ion-textarea[_ngcontent-%COMP%]{--highlight-color-valid: var(--ion-color-tertiary);text-align:start}#qrImage[_ngcontent-%COMP%]{padding:20px 0}.qr-wrapper[_ngcontent-%COMP%]{width:230px;min-height:230px;background:var(--ion-color-tertiary);border-radius:20px}.qr-placeholder[_ngcontent-%COMP%]{width:60px}.d-flex-center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.rating-section[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 6px #0000001a;text-align:center}.rating-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#333}.map-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{--border-width: 1px;--border-style: solid;--border-color: var(--ion-color-primary);height:32px}.map-container[_ngcontent-%COMP%]{position:relative;width:100%;height:250px;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000026;margin:1rem 0;border:1px solid #e0e0e0}.map-canvas[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:8px}.map-loading[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#f8f9fa;color:#6c757d;border-radius:8px}.map-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:1rem;--color: var(--ion-color-primary)}.map-error[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#fff8e1;color:#f57c00;border-radius:8px;text-align:center}.map-error[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.map-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:.9rem}.delivery-info[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:.75rem;border-radius:6px;margin-top:.5rem;border-left:3px solid var(--ion-color-primary)}.delivery-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.25rem 0;font-size:.9rem;color:#666;display:flex;align-items:center}.delivery-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:.5rem}[_ngcontent-%COMP%]:global(.custom-div-icon){background:#fff;border:2px solid #ddd;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px #0003}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:200px;margin:.75rem 0}.map-controls[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.map-preview-btn[_ngcontent-%COMP%], .external-maps-btn[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.delivery-info[_ngcontent-%COMP%]{padding:.5rem;font-size:.85rem}}@media (max-width: 480px){.map-container[_ngcontent-%COMP%]{height:180px}.ticket-container[_ngcontent-%COMP%]{margin:10px;padding:12px}}']}),l})();var q=m(421);const W=()=>[1,1,1,1,1,1,1,1];function Z(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-button",8),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.clearFilters())}),e.EFF(1," Quitar Filtros "),e.nrm(2,"ion-icon",4),e.k0s()}}function K(n,l){if(1&n&&(e.j41(0,"div",13)(1,"strong"),e.nrm(2,"ion-icon",22),e.EFF(3),e.nI1(4,"date"),e.k0s()()),2&n){const i=e.XpG().$implicit;e.R7$(3),e.SpI(" Fecha de entrega: ",e.i5U(4,1,null==i.fecha_entrega?null:i.fecha_entrega.toDate(),"dd/MM/yyyy HH:mm"),"")}}function ee(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-item-option",23),e.bIt("click",function(){e.eBV(i);const o=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.cancelarPedido(o))}),e.nrm(1,"ion-icon",24),e.EFF(2," Cancelar "),e.k0s()}}function te(n,l){if(1&n){const i=e.RV6();e.j41(0,"ion-list")(1,"ion-item-sliding",10)(2,"ion-item")(3,"ion-label")(4,"div",11)(5,"h2"),e.nrm(6,"ion-icon",12),e.EFF(7),e.nI1(8,"number"),e.k0s()(),e.j41(9,"div",13)(10,"strong"),e.nrm(11,"ion-icon",14),e.EFF(12),e.k0s(),e.j41(13,"strong",15),e.nrm(14,"ion-icon",16),e.EFF(15),e.k0s()(),e.DNE(16,K,5,4,"div",17),e.j41(17,"ion-chip",18)(18,"ion-label"),e.EFF(19),e.k0s()()()(),e.j41(20,"ion-item-options")(21,"ion-item-option",19),e.bIt("click",function(){const o=e.eBV(i).$implicit,a=e.XpG(2);return e.Njj(a.openPedidoDetalle(o))}),e.nrm(22,"ion-icon",20),e.EFF(23," Ver Detalle "),e.k0s(),e.DNE(24,ee,3,0,"ion-item-option",21),e.k0s()()()}if(2&n){const i=l.$implicit,t=e.XpG(2);e.R7$(7),e.SpI(" $",e.i5U(8,8,i.total,"1.2-2")," "),e.R7$(5),e.SpI(" Cliente: ",i.nombre_cliente,""),e.R7$(2),e.Y8G("color",t.getColorIcon(i.estatus))("name",t.getStatusIcon(i.estatus)),e.R7$(),e.SpI(" ",i.estatus," "),e.R7$(),e.Y8G("ngIf","en espera de recolecci\xf3n"===i.estatus.toLowerCase()),e.R7$(3),e.JRh(i.tipo_pago),e.R7$(5),e.Y8G("ngIf","cancelado"!==i.estatus.toLowerCase()&&"entregado"!==i.estatus.toLowerCase())}}function oe(n,l){if(1&n&&(e.qex(0),e.DNE(1,te,25,11,"ion-list",9),e.bVm()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.pedidosFiltrados)}}function ne(n,l){1&n&&(e.j41(0,"ion-item",10)(1,"ion-avatar",26),e.nrm(2,"ion-skeleton-text",27),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",28),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",29),e.k0s()()())}function ie(n,l){1&n&&(e.j41(0,"ion-list"),e.DNE(1,ne,8,0,"ion-item",25),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,W)))}function re(n,l){1&n&&(e.j41(0,"div",30),e.nrm(1,"ion-icon",31),e.j41(2,"h3"),e.EFF(3,"No hay pedidos disponibles"),e.k0s()())}const ae=[{path:"",component:(()=>{var n;class l{constructor(t,o){this.modalCtrl=t,this.alertController=o,this.showModal=!1,this.isEditing=!1,this.pedidos=[],this.detalle_pedido=[],this.loading=!1,this.searchTerm="",this.filtersApplied=!1,this.pedidosFiltrados=[],this.utilsSvc=(0,e.WQX)(y.T),this.firebaseSvc=(0,e.WQX)(k.f),this.fecha=(new Date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}ngOnInit(){this.fecha=this.fecha.charAt(0).toUpperCase()+this.fecha.slice(1),this.getPedidos()}user(){return this.utilsSvc.getFromLocalStorage("user")}doRefresh(t){setTimeout(()=>{this.getPedidos(),t.target.complete()},1e3)}getPedidos(){var t=this;this.loading=!0,(new Date).setHours(0,0,0,0);let r=this.firebaseSvc.getCollectionData("pedidos",[]).subscribe({next:p=>{if(Array.isArray(p)){this.pedidos=p;const c=this.pedidos.map(u=>this.firebaseSvc.getDocument(`users/${u.uid_cliente}`).then(d=>(u.nombre_cliente=d.name+" "+d.mother_Last_Name+" "+d.father_Last_Name,this.firebaseSvc.getCollectionData(`pedidos/${u.id}/detalle_pedido`,[]).subscribe({next:v=>{u.detalle_pedido=v,u.detalle_pedido.forEach(function(){var de=(0,g.A)(function*(P){const pe=`productos/${P.uid_producto}`;try{let x=yield t.firebaseSvc.getDocument(pe);P.producto=x,P.producto.imagen=x.imagen}catch{}});return function(P){return de.apply(this,arguments)}}())},error:v=>console.error("Error al obtener datos:",v)}),u)));Promise.all(c).then(u=>{const f=u.filter(d=>d.uid_cliente===this.user().uid);this.pedidosFiltrados=f.sort((d,h)=>h.fecha_entrega.toDate()-d.fecha_entrega.toDate()),this.loading=!1}).catch(u=>{this.loading=!1})}else this.pedidos=[],this.pedidosFiltrados=[];r.unsubscribe()},error:p=>{this.loading=!1}})}closeModal(){this.showModal=!1}refreshOrders(){this.getPedidos()}openFilterModal(){var t=this;return(0,g.A)(function*(){const a=yield t.modalCtrl.create({component:q.w,componentProps:{estatus:!0}});yield a.present();const{data:r}=yield a.onDidDismiss();r&&t.applyFilter(r)})()}applyFilter(t){this.filtersApplied=!0,this.pedidosFiltrados=this.pedidos.filter(o=>{if(o.uid_cliente!==this.user().uid||t.selectedStatus&&t.selectedStatus.length&&!t.selectedStatus.includes(o.estatus))return!1;if(t.fechaInicio&&t.fechaFin){const a=new Date(o.fecha_entrega.toDate()),r=new Date(t.fechaInicio),p=new Date(t.fechaFin);if(a<r||a>p)return!1}return!(null!==t.precioMin&&null!==t.precioMax&&(o.total<t.precioMin||o.total>t.precioMax))}),console.log(this.pedidosFiltrados)}clearFilters(){(new Date).setHours(0,0,0,0);const o=this.pedidos.filter(r=>r.uid_cliente===this.user().uid);this.pedidosFiltrados=o.sort((r,p)=>p.fecha_entrega.toDate()-r.fecha_entrega.toDate()),this.pedidosFiltrados=o;const a=this.pedidosFiltrados.map(r=>this.firebaseSvc.getDocument(`users/${r.uid_cliente}`).then(c=>(r.nombre_cliente=c.name+" "+c.mother_Last_Name+" "+c.father_Last_Name,r)));Promise.all(a).then(r=>{this.pedidosFiltrados=r,this.filtersApplied=!1}).catch(r=>{console.error("Error al obtener nombres de clientes:",r),this.filtersApplied=!1})}filterPedidos(){const t=this.searchTerm.toLowerCase();this.pedidosFiltrados=this.pedidos.filter(o=>o.nombre_cliente.toLowerCase().includes(t)||o.total.toFixed(2).includes(t)||o.id.toLowerCase().includes(t)||o.estatus.toLowerCase().includes(t))}getStatusIcon(t){switch(t.toLowerCase()){case"pedido confirmado":return"bag-check-outline";case"en preparaci\xf3n":return"refresh-circle-outline";case"en espera de recolecci\xf3n":return"time-outline";case"entregado":return"checkmark-done-outline";case"cancelado":return"close-circle-outline";default:return"help-circle-outline"}}cancelarPedido(t){var o=this;return(0,g.A)(function*(){var r;yield(yield o.alertController.create({header:"Cancelar Pedido",mode:"ios",message:"\xbfRealmente deseas cancelar el pedido?",cssClass:"custom-alert",buttons:[{text:"Cancelar",role:"cancel",cssClass:"alert-cancel",handler:()=>{}},{text:"Confirmar",cssClass:"alert-confirm",handler:(r=(0,g.A)(function*(){let p=`pedidos/${t.id}`;const c=yield o.utilsSvc.loading();yield c.present(),t.estatus="Cancelado",o.firebaseSvc.updateDocumet(p,{estatus:t.estatus}).then(function(){var u=(0,g.A)(function*(f){o.utilsSvc.presentToast({message:"Pedido cancelado",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"})});return function(f){return u.apply(this,arguments)}}()).catch(u=>{o.utilsSvc.presentToast({message:u.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{c.dismiss()})}),function(){return r.apply(this,arguments)})}],backdropDismiss:!1})).present()})()}getColorIcon(t){switch(t.toLowerCase()){case"cancelado":return"danger";case"entregado":return"primary";default:return"dark"}}openPedidoDetalle(t){var o=this;return(0,g.A)(function*(){console.log("------------------"),console.log(t),(yield o.utilsSvc.presentModal({component:Q,componentProps:{pedido:t}}))&&o.utilsSvc.presentToast({message:"Pedido en preparaci\xf3n",duration:2500,color:"primary",position:"bottom",icon:"refresh-circle-outline"}),o.getPedidos()})()}}return(n=l).\u0275fac=function(t){return new(t||n)(e.rXU(s.W3),e.rXU(s.hG))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-historial-pedidos"]],decls:12,vars:6,consts:[["title","Historial pedidos",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","animated","true","placeholder","Cliente, productos, precio o c\xf3digo",3,"ngModelChange","ionInput","ngModel"],["expand","block","color","primary",3,"click"],["name","filter-outline",2,"margin-left","0.5rem"],["expand","block","color","light",3,"click",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["expand","block","color","light",3,"click"],[4,"ngFor","ngForOf"],[1,"product-item"],[1,"name"],["slot","start","color","danger","name","cash-outline",2,"margin-right","2rem"],[1,"data"],["slot","start","name","person-outline"],[2,"margin-left","3rem"],["slot","start",3,"color","name"],["class","data",4,"ngIf"],["color","primary","mode","ios","outline","true"],["color","secondary",3,"click"],["name","eye-outline",1,"option-btn",2,"margin-right","0.5rem"],["color","danger",3,"click",4,"ngIf"],["slot","start","name","calendar-outline"],["color","danger",3,"click"],["name","close-circle-outline",1,"option-btn",2,"margin-right","0.5rem"],["class","product-item",4,"ngFor","ngForOf"],["slot","start"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(t,o){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(r){return o.doRefresh(r)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"ion-searchbar",2),e.mxI("ngModelChange",function(r){return e.DH7(o.searchTerm,r)||(o.searchTerm=r),r}),e.bIt("ionInput",function(){return o.filterPedidos()}),e.k0s(),e.j41(5,"ion-button",3),e.bIt("click",function(){return o.openFilterModal()}),e.EFF(6,"Filtros "),e.nrm(7,"ion-icon",4),e.k0s(),e.DNE(8,Z,3,0,"ion-button",5)(9,oe,2,1,"ng-container",6)(10,ie,2,2,"ion-list",6)(11,re,4,0,"div",7),e.k0s()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.R50("ngModel",o.searchTerm),e.R7$(4),e.Y8G("ngIf",o.filtersApplied),e.R7$(),e.Y8G("ngIf",o.pedidosFiltrados.length>0),e.R7$(),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",!o.loading&&!o.pedidosFiltrados.length))},dependencies:[_.Sq,_.bT,b.BC,b.vS,s.mC,s.Jm,s.ZB,s.W9,s.iq,s.uz,s.LU,s.CE,s.A7,s.he,s.nf,s.To,s.Ki,s.S1,s.ds,s.Gw,I.l,_.QX,_.vh]}),l})()}];let se=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[F.iI.forChild(ae),F.iI]}),l})();var le=m(7383);let ce=(()=>{var n;class l{}return(n=l).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[_.MD,b.YN,s.bv,se,le.G]}),l})()}}]);