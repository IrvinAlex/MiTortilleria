"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6574],{6574:($,u,c)=>{c.r(u),c.d(u,{AdministracionPageModule:()=>R});var p=c(177),m=c(9417),l=c(5933),h=c(8265),_=c(467),e=c(4438),f=c(7517),x=c(2723),b=c(1517),P=c(1626),w=c(8461);function C(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-col",12),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.sortTable("email"))}),e.EFF(1,"Correo"),e.k0s()}}function k(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-col",12),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.sortTable("image"))}),e.EFF(1,"Imagen"),e.k0s()}}function M(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-input",30),e.mxI("ngModelChange",function(t){e.eBV(a);const o=e.XpG(2).$implicit,r=e.XpG().$implicit;return e.DH7(r[o.key],t)||(r[o.key]=t),e.Njj(t)}),e.bIt("keyup.enter",function(){e.eBV(a);const t=e.XpG(4);return e.Njj(t.finishEditing())})("blur",function(){e.eBV(a);const t=e.XpG(4);return e.Njj(t.finishEditing())}),e.k0s()}if(2&n){const a=e.XpG(2).$implicit,i=e.XpG().$implicit;e.R50("ngModel",i[a.key])}}function A(n,s){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const a=e.XpG(2).$implicit,i=e.XpG().$implicit;e.R7$(),e.SpI(" ",i[a.key]," ")}}function y(n,s){if(1&n&&(e.j41(0,"ion-col",27),e.DNE(1,M,1,1,"ion-input",28)(2,A,2,1,"span",29),e.k0s()),2&n){const a=e.XpG().$implicit,i=e.XpG().$implicit,t=e.XpG();e.R7$(),e.Y8G("ngIf",t.editingFieldKey===a.key&&t.editingField===i),e.R7$(),e.Y8G("ngIf",!(t.editingFieldKey===a.key&&t.editingField===i))}}function I(n,s){if(1&n&&(e.qex(0),e.DNE(1,y,3,2,"ion-col",26),e.bVm()),2&n){const a=s.$implicit,i=e.XpG(2);e.R7$(),e.Y8G("ngIf",i.shouldShowField(a.key)&&"image"!==a.key)}}function F(n,s){if(1&n&&(e.j41(0,"ion-col",31),e.nrm(1,"ion-img",32),e.k0s()),2&n){const a=e.XpG().$implicit;e.R7$(),e.Y8G("src",a.image)}}function T(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-button",33),e.bIt("click",function(){e.eBV(a);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.deleteItem(t))}),e.nrm(1,"ion-icon",34),e.k0s()}}function O(n,s){if(1&n){const a=e.RV6();e.j41(0,"ion-row",20),e.DNE(1,I,2,1,"ng-container",21)(2,F,2,1,"ion-col",22),e.j41(3,"ion-col")(4,"ion-button",23),e.bIt("click",function(){const t=e.eBV(a).$implicit,o=e.XpG();return e.Njj(o.editItem(t))}),e.nrm(5,"ion-icon",24),e.k0s(),e.DNE(6,T,2,0,"ion-button",25),e.k0s()()}if(2&n){const a=s.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.fields),e.R7$(),e.Y8G("ngIf",i.showImage),e.R7$(4),e.Y8G("ngIf","cliente"===a.type_profile)}}const j=[{path:"",component:(()=>{var n;class s{constructor(i,t,o,r,g,d){this.modalCtrl=i,this.formBuilder=t,this.cdr=o,this.firebaseService=r,this.alertController=g,this.http=d,this.data=[],this.isModalOpen=!1,this.filteredData=[...this.data],this.editingField=null,this.editingFieldKey="",this.searchTerm="",this.utilsSvc=(0,e.WQX)(x.T),this.areColumnsVisible=!1,this.paginatedData=[],this.currentPage=1,this.itemsPerPage=10,this.totalPages=0,this.showNombre=!1,this.showTipoUsuario=!1,this.showApellidoPaterno=!1,this.showApellidoMaterno=!1,this.showEmail=!1,this.showImage=!1,this.firebaseSvc=(0,e.WQX)(f.f),this.fields=[{key:"name",label:"Nombre"},{key:"father_Last_Name",label:"Apellido paterno"},{key:"mother_Last_Name",label:"Apellido materno"},{key:"type_profile",label:"Tipo de usuario"},{key:"email",label:"Correo"},{key:"image",label:"Imagen"}],this.setPage(1),this.userForm=this.formBuilder.group({name:[""],father_Last_Name:[""],mother_Last_Name:[""],email:[""],image:[""],type_profile:[""],password_Change:[""]})}ngOnInit(){this.getUsers()}doRefresh(i){setTimeout(()=>{i.target.complete()},1e3)}filterItems(i){const t=i.target.value.toLowerCase();this.paginatedData=this.data.filter(o=>Object.values(o).some(r=>r.toString().toLowerCase().includes(t))),this.cdr.detectChanges()}sortTable(i){this.paginatedData.sort((t,o)=>t[i]<o[i]?-1:t[i]>o[i]?1:0),this.cdr.detectChanges()}editField(i,t){this.editingField=i,this.editingFieldKey=t}finishEditing(){this.editingField=null,this.editingFieldKey=null}deleteItem(i){"cliente"===i.type_profile?this.presentConfirmDeleteAlert(i):this.utilsSvc.presentToast({message:"Solo se pueden eliminar clientes de perfil 3.",duration:2e3,color:"warning",position:"bottom",icon:"alert-circle-outline"})}presentConfirmDeleteAlert(i){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Confirmaci\xf3n",message:`\xbfEst\xe1s seguro de que deseas eliminar al usuario ${i.name}?`,buttons:[{text:"Cancelar",role:"cancel",handler:()=>{}},{text:"Eliminar",role:"destructive",handler:()=>{t.confirmDeleteItem(i)}}]})).present()})()}confirmDeleteItem(i){const t=this.data.findIndex(o=>o.uid===i.uid);if(t>-1){this.data.splice(t,1),this.paginatedData=[...this.data],this.setPage(1),this.cdr.detectChanges();const o=`https://api-tortilleria.onrender.com/deleteUser/${i.uid}`,r=localStorage.getItem("token"),g=new P.Lr({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});this.http.delete(o,{headers:g}).subscribe({next:d=>{this.utilsSvc.presentToast(d.success?{message:`Usuario ${i.name} eliminado correctamente.`,duration:1500,color:"success",position:"bottom",icon:"checkmark-circle-outline"}:{message:`No se pudo eliminar el usuario ${i.name}.`,duration:2500,color:"danger",position:"bottom",icon:"alert-circle-outline"})},error:d=>{this.utilsSvc.presentToast({message:`Error al eliminar el usuario ${i.name}.`,duration:2500,color:"danger",position:"bottom",icon:"alert-circle-outline"}),console.error("Error al eliminar el usuario: ",d)}})}else this.utilsSvc.presentToast({message:"Usuario no encontrado en la lista.",duration:2500,color:"danger",position:"bottom",icon:"alert-circle-outline"})}editItem(i){var t=this;return(0,_.A)(function*(){try{const o=yield t.modalCtrl.create({component:b.r,componentProps:{user:i}});o.onDidDismiss().then(r=>{if(r.data){const g=t.data.findIndex(d=>d.uid===r.data.uid);g>-1&&(t.data[g]=r.data),t.paginatedData=[...t.data],t.cdr.detectChanges()}}),yield o.present()}catch{}})()}openAddUserModal(){var i=this;return(0,_.A)(function*(){const t=yield i.modalCtrl.create({component:b.r,componentProps:{userForm:i.userForm}});return t.onDidDismiss().then(o=>{o.data&&(i.paginatedData=[...i.data],i.cdr.detectChanges())}),yield t.present()})()}closeModal(){this.modalCtrl.dismiss()}submitProduct(){this.userForm.valid&&(this.data.push(this.userForm.value),this.paginatedData=[...this.data],this.userForm.reset(),this.closeModal(),this.cdr.detectChanges())}addProduct(){this.userForm.valid&&(this.data.push(this.userForm.value),this.paginatedData=[...this.data],this.userForm.reset(),this.closeModal(),this.cdr.detectChanges())}setPage(i){this.currentPage=i;const t=(i-1)*this.itemsPerPage;this.paginatedData=this.data.slice(t,t+this.itemsPerPage),this.totalPages=Math.ceil(this.data.length/this.itemsPerPage)}previousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}toggleColumns(){this.showNombre=!this.showNombre,this.showApellidoPaterno=!this.showApellidoPaterno,this.showApellidoMaterno=!this.showApellidoMaterno,this.showEmail=!this.showEmail,this.showTipoUsuario=!this.showTipoUsuario,this.showImage=!this.showImage,this.areColumnsVisible=!this.areColumnsVisible}shouldShowField(i){switch(i){case"image":return this.showImage;case"email":return this.showEmail;default:return!0}}getUsers(){this.firebaseService.obtenerColeccion("users").subscribe(i=>{this.data=i.map(t=>({uid:t.uid,name:t.name,father_Last_Name:t.father_Last_Name,mother_Last_Name:t.mother_Last_Name,email:t.email,type_profile:this.getPermissions(t.type_profile),image:t.image,password_Change:t.password_Change})),this.paginatedData=[...this.data],this.setPage(1)})}getPermissions(i){switch(i){case 1:return"Super administrador";case 2:return"Administrador";default:return"cliente"}}}return(n=s).\u0275fac=function(i){return new(i||n)(e.rXU(l.W3),e.rXU(m.ok),e.rXU(e.gRc),e.rXU(f.f),e.rXU(l.hG),e.rXU(P.Qq))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-administracion"]],decls:43,vars:11,consts:[["title","Usuarios",3,"showMenu"],[1,"ion-padding-top","ion-text-center"],["slot","fixed",3,"ionRefresh"],["size","8"],["placeholder","Buscar usuarios...",3,"ngModelChange","ionInput","ngModel"],["size","4",1,"ion-text-right"],["color","success",3,"click"],["name","add-circle-outline"],[1,"table-header"],["color","light",1,"toggle-columns-button",3,"click"],["slot","start",3,"name"],[1,"header-row"],[3,"click"],[3,"click",4,"ngIf"],["class","data-row",4,"ngFor","ngForOf"],[1,"pagination"],["color","light","expand","full",1,"pagination-button",3,"click","disabled"],["slot","start","name","arrow-back"],[1,"pagination-info"],["slot","end","name","arrow-forward"],[1,"data-row"],[4,"ngFor","ngForOf"],["style","display: flex; justify-content: center; align-items: center;",4,"ngIf"],["color","warning",3,"click"],["name","create"],["color","danger",3,"click",4,"ngIf"],["class","pointer-on",4,"ngIf"],[1,"pointer-on"],["class","cololetra",3,"ngModel","ngModelChange","keyup.enter","blur",4,"ngIf"],[4,"ngIf"],[1,"cololetra",3,"ngModelChange","keyup.enter","blur","ngModel"],[2,"display","flex","justify-content","center","align-items","center"],[2,"width","50px","height","auto",3,"src"],["color","danger",3,"click"],["name","trash"]],template:function(i,t){1&i&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content",1)(2,"ion-refresher",2),e.bIt("ionRefresh",function(r){return t.doRefresh(r)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.j41(4,"h2"),e.EFF(5,"Administraci\xf3n de usuarios"),e.k0s(),e.j41(6,"ion-grid")(7,"ion-row")(8,"ion-col",3)(9,"ion-searchbar",4),e.mxI("ngModelChange",function(r){return e.DH7(t.searchTerm,r)||(t.searchTerm=r),r}),e.bIt("ionInput",function(r){return t.filterItems(r)}),e.k0s()(),e.j41(10,"ion-col",5)(11,"ion-button",6),e.bIt("click",function(){return t.openAddUserModal()}),e.nrm(12,"ion-icon",7),e.EFF(13," Agregar Usuario "),e.k0s()()()(),e.j41(14,"div",8),e.nrm(15,"h2"),e.j41(16,"ion-button",9),e.bIt("click",function(){return t.toggleColumns()}),e.nrm(17,"ion-icon",10),e.EFF(18),e.k0s()(),e.j41(19,"ion-grid")(20,"ion-row",11)(21,"ion-col",12),e.bIt("click",function(){return t.sortTable("name")}),e.EFF(22,"Nombre"),e.k0s(),e.j41(23,"ion-col",12),e.bIt("click",function(){return t.sortTable("father_Last_Name")}),e.EFF(24,"Apellido Paterno"),e.k0s(),e.j41(25,"ion-col",12),e.bIt("click",function(){return t.sortTable("mother_Last_Name")}),e.EFF(26,"Apellido Materno"),e.k0s(),e.j41(27,"ion-col",12),e.bIt("click",function(){return t.sortTable("type_profile")}),e.EFF(28,"Tipo de Perfil"),e.k0s(),e.DNE(29,C,2,0,"ion-col",13)(30,k,2,0,"ion-col",13),e.j41(31,"ion-col"),e.EFF(32,"Acciones"),e.k0s()(),e.DNE(33,O,7,3,"ion-row",14),e.k0s(),e.j41(34,"div",15)(35,"ion-button",16),e.bIt("click",function(){return t.previousPage()}),e.nrm(36,"ion-icon",17),e.EFF(37," Anterior "),e.k0s(),e.j41(38,"span",18),e.EFF(39),e.k0s(),e.j41(40,"ion-button",16),e.bIt("click",function(){return t.nextPage()}),e.EFF(41," Siguiente "),e.nrm(42,"ion-icon",19),e.k0s()()()),2&i&&(e.Y8G("showMenu",!0),e.R7$(9),e.R50("ngModel",t.searchTerm),e.R7$(8),e.Y8G("name",t.areColumnsVisible?"eye-off":"eye"),e.R7$(),e.SpI(" ",t.areColumnsVisible?"Ocultar tabla completa":"Mostrar tabla completa"," "),e.R7$(11),e.Y8G("ngIf",t.showEmail),e.R7$(),e.Y8G("ngIf",t.showImage),e.R7$(3),e.Y8G("ngForOf",t.paginatedData),e.R7$(2),e.Y8G("disabled",1===t.currentPage),e.R7$(4),e.Lme("P\xe1gina ",t.currentPage," de ",t.totalPages,""),e.R7$(),e.Y8G("disabled",t.currentPage===t.totalPages))},dependencies:[p.Sq,p.bT,m.BC,m.vS,l.Jm,l.hU,l.W9,l.lO,l.iq,l.KW,l.$w,l.To,l.Ki,l.ln,l.S1,l.Gw,w.l],styles:["ion-grid[_ngcontent-%COMP%]{border-radius:18px;overflow:hidden;margin-top:24px;padding-left:2rem;padding-right:2rem;box-shadow:0 4px 24px #1eb4501a;background:#fff;transition:box-shadow .2s}ion-grid[_ngcontent-%COMP%]:hover{box-shadow:0 8px 32px #1eb4502e}.header-row[_ngcontent-%COMP%]{background:linear-gradient(90deg,#1ad436 70%,#0fae2a);color:#fff;font-weight:700;text-align:center;border-top-left-radius:18px;border-top-right-radius:18px;cursor:pointer;font-size:17px;letter-spacing:.5px;box-shadow:0 2px 8px #1eb45014;transition:background .2s}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:hover{background:#ffffff14}.data-row[_ngcontent-%COMP%]{background:#f6fff8;border-bottom:1px solid #e0f7e9;text-align:center;transition:background .2s}.data-row[_ngcontent-%COMP%]:hover{background:#e9ffe7}.data-row[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:18px;border-bottom-right-radius:18px}ion-col[_ngcontent-%COMP%]{padding:12px;font-size:15px;transition:background .2s}ion-button[_ngcontent-%COMP%]{margin-top:10px}ion-searchbar[_ngcontent-%COMP%]{margin-top:10px;border-radius:8px;box-shadow:0 2px 8px #1eb45014;background:#f6fff8;transition:box-shadow .2s}ion-searchbar[_ngcontent-%COMP%]:focus-within{box-shadow:0 4px 16px #1eb4502e}.cololetra[_ngcontent-%COMP%]{background:#e0f7e9;border-radius:6px;padding:8px;border:1px solid #1ad436;font-size:15px;transition:border .2s}.cololetra[_ngcontent-%COMP%]:focus{border:2px solid #0fae2a}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:24px;margin-bottom:3rem;flex-wrap:wrap;gap:10px}.pagination-button[_ngcontent-%COMP%]{margin:0 5px;flex:1;max-width:160px;border-radius:8px;font-size:15px;box-shadow:0 2px 8px #1eb45014;transition:background .2s,box-shadow .2s}.pagination-info[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:#1ad436;margin:0 10px}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;margin-right:2rem}.toggle-columns-button[_ngcontent-%COMP%]{font-size:14px;padding:4px 12px;border-radius:6px;background:#e0f7e9;box-shadow:0 2px 8px #1eb45014}.toggle-columns-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px;margin-right:4px}ion-img[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 2px 8px #1eb4501a;border:2px solid #e0f7e9;background:#fff;transition:border .2s}ion-img[_ngcontent-%COMP%]:hover{border:2px solid #1ad436}@keyframes _ngcontent-%COMP%_fadeInRow{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.data-row[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInRow .3s}@media (max-width: 900px){ion-grid[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}.table-header[_ngcontent-%COMP%]{margin-right:.5rem}}@media (max-width: 768px){ion-grid[_ngcontent-%COMP%]{padding-left:.2rem;padding-right:.2rem}ion-col[_ngcontent-%COMP%]{font-size:13px;padding:6px}.header-row[_ngcontent-%COMP%]{font-size:13px}.data-row[_ngcontent-%COMP%]{font-size:12px}ion-searchbar[_ngcontent-%COMP%]{width:100%}.pagination[_ngcontent-%COMP%]{flex-direction:column;gap:6px}.table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;margin-right:0}}@media (max-width: 480px){.header-row[_ngcontent-%COMP%], .data-row[_ngcontent-%COMP%]{font-size:10px}ion-button[_ngcontent-%COMP%]{font-size:10px;padding:5px}ion-searchbar[_ngcontent-%COMP%]{width:100%;margin-top:5px}.pagination-info[_ngcontent-%COMP%]{font-size:12px}}"]}),s})()}];let v=(()=>{var n;class s{}return(n=s).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.iI.forChild(j),h.iI]}),s})();var G=c(7383);let R=(()=>{var n;class s{}return(n=s).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.MD,m.YN,l.bv,v,G.G]}),s})()}}]);