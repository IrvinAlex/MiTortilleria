"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5285],{5285:(E,v,d)=>{d.r(v),d.d(v,{HomePageModule:()=>C});var g=d(177),c=d(9417),a=d(5933),P=d(8265),p=d(467),e=d(4438),y=d(8663),_=d(2723);let k=(()=>{var o;class s{constructor(){this.product=null,this.form=new c.gE({id:new c.MJ(""),image:new c.MJ("",[c.k0.required]),name:new c.MJ("",[c.k0.required,c.k0.minLength(4)]),price:new c.MJ(null,[c.k0.required,c.k0.min(0)]),soldUnits:new c.MJ(null,[c.k0.required,c.k0.min(0)])}),this.firebaseSvc=(0,e.WQX)(y.f),this.utilSvc=(0,e.WQX)(_.T)}ngOnInit(){this.product&&this.form.patchValue({...this.product})}takePicture(){var t=this;return(0,p.A)(function*(){const i=(yield t.utilSvc.takePicture("Imagen del producto")).dataUrl;t.form.controls.image.setValue(i)})()}submit(){var t=this;return(0,p.A)(function*(){t.form.valid&&(t.product?yield t.updateProduct():yield t.createProduct())})()}createProduct(){var t=this;return(0,p.A)(function*(){const i=yield t.utilSvc.loading();yield i.present();try{const r="productos";let l="";if(t.form.value.image){const u=`productos/${Date.now()}`;l=yield t.firebaseSvc.uploadImage(u,t.form.value.image),t.form.controls.image.setValue(l)}const m={...t.form.value,image:l};yield t.firebaseSvc.addDocumentWithUid(r,m),t.utilSvc.presentToast({message:"Usuario creado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),t.utilSvc.dismissModal({success:!0})}catch(r){t.utilSvc.presentToast({message:r.message,duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"})}finally{i.dismiss()}})()}updateProduct(){var t=this;return(0,p.A)(function*(){const i=yield t.utilSvc.loading();yield i.present();try{var r,l;const m=`productos/${null===(r=t.product)||void 0===r?void 0:r.id}`;if(console.log("Ruta para actualizar usuario:",m),t.form.value.image&&t.form.value.image!==(null===(l=t.product)||void 0===l?void 0:l.image)){const f=`prodcutos/${Date.now()}`,h=yield t.firebaseSvc.uploadImage(f,t.form.value.image);t.form.controls.image.setValue(h)}const u={...t.form.value};delete u.id,console.log("Datos a actualizar:",u),yield t.firebaseSvc.updateDocumet(m,u),t.utilSvc.presentToast({message:"Producto actualizado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"}),t.utilSvc.dismissModal({success:!0,data:u})}catch(m){t.utilSvc.presentToast({message:`Error al actualizar usuario: ${m.message}`,duration:2500,color:"danger",position:"middle",icon:"alert-circle-outline"}),console.error("Error al actualizar usuario:",m)}finally{i.dismiss()}})()}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-add-update-product"]],inputs:{product:"product"},decls:0,vars:0,template:function(t,i){},styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),s})();var S=d(2784),F=d(8461);const b=()=>[1,1,1,1,1,1,1,1];function U(o,s){if(1&o&&(e.j41(0,"ion-card",8)(1,"div")(2,"h5"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5,"Productos"),e.k0s()(),e.j41(6,"div")(7,"h5"),e.EFF(8),e.nI1(9,"currency"),e.k0s(),e.j41(10,"p"),e.EFF(11,"Ganancias"),e.k0s()()()),2&o){const n=e.XpG();e.R7$(3),e.JRh(n.products.length),e.R7$(5),e.JRh(e.i5U(9,2,n.getProfits(),"USD"))}}function x(o,s){if(1&o){const n=e.RV6();e.j41(0,"ion-item-sliding",10)(1,"ion-item")(2,"ion-avatar",11),e.nrm(3,"img",12),e.k0s(),e.j41(4,"ion-label")(5,"div",13),e.EFF(6),e.k0s(),e.j41(7,"div",14)(8,"strong"),e.EFF(9,"Precio:"),e.k0s(),e.EFF(10),e.nI1(11,"currency"),e.nrm(12,"br"),e.j41(13,"strong"),e.EFF(14,"Unidades Vendidas:"),e.k0s(),e.EFF(15),e.k0s(),e.j41(16,"ion-chip",15)(17,"ion-label"),e.EFF(18),e.nI1(19,"currency"),e.k0s()()()(),e.j41(20,"ion-item-options")(21,"ion-item-option",6),e.bIt("click",function(){const i=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.addUpdateProduct(i))}),e.nrm(22,"ion-icon",16),e.k0s(),e.j41(23,"ion-item-option",17),e.bIt("click",function(){const i=e.eBV(n).$implicit,r=e.XpG(2);return e.Njj(r.confirmDeleteProduct(i))}),e.nrm(24,"ion-icon",18),e.k0s()()()}if(2&o){const n=s.$implicit;e.R7$(3),e.Y8G("src",n.image,e.B4B),e.R7$(3),e.JRh(n.name),e.R7$(4),e.SpI("",e.i5U(11,5,n.price,"USD")," "),e.R7$(5),e.SpI(" ",n.soldUnits," "),e.R7$(3),e.SpI("Ganancia: ",e.i5U(19,8,n.price*n.soldUnits,"USD"),"")}}function R(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,x,25,11,"ion-item-sliding",9),e.k0s()),2&o){const n=e.XpG();e.R7$(),e.Y8G("ngForOf",n.products)}}function j(o,s){1&o&&(e.j41(0,"ion-item",10)(1,"ion-avatar",11),e.nrm(2,"ion-skeleton-text",19),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",20),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",21),e.k0s()()())}function H(o,s){1&o&&(e.j41(0,"ion-list"),e.DNE(1,j,8,0,"ion-item",9),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,b)))}function I(o,s){1&o&&(e.j41(0,"div",22),e.nrm(1,"ion-icon",23),e.j41(2,"h3"),e.EFF(3,"No hay productos disponibles"),e.k0s()())}const M=[{path:"",component:(()=>{var o;class s{constructor(){this.firebaseSvc=(0,e.WQX)(y.f),this.utilSvc=(0,e.WQX)(_.T),this.products=[],this.loading=!1}ngOnInit(){}user(){return this.utilSvc.getFromLocalStorage("user")}ionViewWillEnter(){}doRefresh(t){setTimeout(()=>{this.getproducts(),t.target.complete()},1e3)}getProfits(){return this.products.reduce((t,i)=>t+i.price*i.soldUnits,0)}getproducts(){let t=`users/${this.user().uid}/products`;this.loading=!0;let i=[(0,S.My)("soldUnits","desc")],r=this.firebaseSvc.getCollectionData(t,i).subscribe({next:l=>{this.products=l,this.loading=!1,r.unsubscribe()}})}addUpdateProduct(t){var i=this;return(0,p.A)(function*(){(yield i.utilSvc.presentModal({component:k,cssClass:"add-update-modal",componentProps:{product:t}}))&&i.getproducts()})()}confirmDeleteProduct(t){var i=this;return(0,p.A)(function*(){yield i.utilSvc.presentAlert({header:"Eliminar Producto",message:"\xbfQuieres eliminar este producto?",mode:"ios",buttons:[{text:"Cancelar"},{text:"Confirmar",handler:()=>{i.deleteProduct(t)}}]})})()}deleteProduct(t){var i=this;return(0,p.A)(function*(){let r=`users/${i.user().uid}/products/${t.id}`;const l=yield i.utilSvc.loading();yield l.present();let m=yield i.firebaseSvc.getFilePath(t.image);yield i.firebaseSvc.deleteFile(m),i.firebaseSvc.deleteDocumet(r).then(function(){var u=(0,p.A)(function*(f){i.products=i.products.filter(h=>h.id!==t.id),i.utilSvc.presentToast({message:"Producto eliminado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(f){return u.apply(this,arguments)}}()).catch(u=>{i.utilSvc.presentToast({message:u.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{l.dismiss()})})()}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-home"]],decls:11,vars:5,consts:[["title","Inicio",3,"showMenu"],["slot","fixed",3,"ionRefresh"],["mode","ios","color","primary","class","d-flex-center ion-text-center",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["mode","ios","color","primary",1,"d-flex-center","ion-text-center"],["class","product-item",4,"ngFor","ngForOf"],[1,"product-item"],["slot","start"],[3,"src"],[1,"name"],[1,"data"],["color","primary","mode","ios","outline","true"],["name","create-outline",1,"option-btn"],["color","danger",3,"click"],["name","trash-outline",1,"option-btn"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(t,i){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(l){return i.doRefresh(l)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.DNE(4,U,12,5,"ion-card",2)(5,R,2,1,"ion-list",3)(6,H,2,2,"ion-list",3)(7,I,4,0,"div",4),e.j41(8,"ion-fab",5)(9,"ion-fab-button",6),e.bIt("click",function(){return i.addUpdateProduct()}),e.nrm(10,"ion-icon",7),e.k0s()()()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.Y8G("ngIf",!i.loading&&i.products.length),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",i.loading),e.R7$(),e.Y8G("ngIf",!i.loading&&!i.products.length))},dependencies:[g.Sq,g.bT,a.mC,a.b_,a.ZB,a.W9,a.Q8,a.YW,a.iq,a.uz,a.LU,a.CE,a.A7,a.he,a.nf,a.To,a.Ki,a.ds,F.l,g.oe],styles:["ion-card[_ngcontent-%COMP%]{gap:100px;padding:20px 0;border-radius:15px}ion-content[_ngcontent-%COMP%]{--padding-bottom: 70px}"]}),s})()}];let T=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[P.iI.forChild(M),P.iI]}),s})();var $=d(7383);let C=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.MD,c.YN,a.bv,T,$.G]}),s})()}}]);