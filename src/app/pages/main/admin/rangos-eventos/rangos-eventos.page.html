<app-header [showMenu]="true" title="Rango de productos para ventas"></app-header>

<ion-content class="modern-content">
  <!-- Ion Refresher -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Administración de Rangos</h1>
      <p class="hero-subtitle">Gestiona los rangos de productos para diferentes tipos de clientes</p>
    </div>
  </div>

  <!-- Control Panel -->
  <div class="control-panel">
    <div class="search-container">
      <ion-searchbar 
        [(ngModel)]="searchTerm" 
        placeholder="Buscar por producto, tipo o rango..." 
        (ionInput)="filterItems($event)"
        class="modern-searchbar">
      </ion-searchbar>
    </div>
    <div class="action-container">
      <ion-button 
        (click)="openAddRangoModal()" 
        class="add-button"
        expand="block">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Nuevo Rango
      </ion-button>
    </div>
  </div>

  <!-- Data Container -->
  <div class="data-container">
    <!-- Desktop Table View -->
    <div class="desktop-table" *ngIf="paginatedData.length > 0">
      <div class="table-card">
        <div class="table-header">
          <div class="header-cell" (click)="sortTable('producto')">
            <span>Producto</span>
            <ion-icon name="swap-vertical-outline"></ion-icon>
          </div>
          <div class="header-cell" (click)="sortTable('tipo')">
            <span>Tipo de Cliente</span>
            <ion-icon name="swap-vertical-outline"></ion-icon>
          </div>
          <div class="header-cell" (click)="sortTable('min_producto')">
            <span>Mínimo (Kg)</span>
            <ion-icon name="swap-vertical-outline"></ion-icon>
          </div>
          <div class="header-cell" (click)="sortTable('max_producto')">
            <span>Máximo (Kg)</span>
            <ion-icon name="swap-vertical-outline"></ion-icon>
          </div>
          <div class="header-cell">
            <span>Acciones</span>
          </div>
        </div>

        <div class="table-body">
          <div *ngFor="let item of paginatedData" class="table-row">
            <div class="table-cell" [attr.data-label]="'Producto'">
              <ion-input 
                *ngIf="editingFieldKey === 'producto' && editingField === item"
                [(ngModel)]="item['producto']" 
                (keyup.enter)="finishEditing()" 
                (blur)="finishEditing()"
                class="editable-input">
              </ion-input>
              <span *ngIf="!(editingFieldKey === 'producto' && editingField === item)" 
                    class="cell-content clickable"
                    (click)="editField(item, 'producto')">
                {{ item['producto'] }}
              </span>
            </div>

            <div class="table-cell" [attr.data-label]="'Tipo'">
              <ion-input 
                *ngIf="editingFieldKey === 'tipo' && editingField === item"
                [(ngModel)]="item['tipo']" 
                (keyup.enter)="finishEditing()" 
                (blur)="finishEditing()"
                class="editable-input">
              </ion-input>
              <span *ngIf="!(editingFieldKey === 'tipo' && editingField === item)" 
                    class="cell-content clickable"
                    (click)="editField(item, 'tipo')">
                {{ item['tipo'] }}
              </span>
            </div>

            <div class="table-cell" [attr.data-label]="'Mínimo'">
              <ion-input 
                *ngIf="editingFieldKey === 'min_producto' && editingField === item"
                [(ngModel)]="item['min_producto']" 
                (keyup.enter)="finishEditing()" 
                (blur)="finishEditing()"
                class="editable-input">
              </ion-input>
              <span *ngIf="!(editingFieldKey === 'min_producto' && editingField === item)" 
                    class="cell-content clickable"
                    (click)="editField(item, 'min_producto')">
                {{ item['min_producto'] }}
              </span>
            </div>

            <div class="table-cell" [attr.data-label]="'Máximo'">
              <ion-input 
                *ngIf="editingFieldKey === 'max_producto' && editingField === item"
                [(ngModel)]="item['max_producto']" 
                (keyup.enter)="finishEditing()" 
                (blur)="finishEditing()"
                class="editable-input">
              </ion-input>
              <span *ngIf="!(editingFieldKey === 'max_producto' && editingField === item)" 
                    class="cell-content clickable"
                    (click)="editField(item, 'max_producto')">
                {{ item['max_producto'] }}
              </span>
            </div>

            <div class="table-cell actions-cell" [attr.data-label]="'Acciones'">
              <div class="action-buttons">
                <ion-button 
                  (click)="editItem(item)" 
                  fill="clear" 
                  class="action-btn edit-btn">
                  <ion-icon name="create-outline"></ion-icon>
                </ion-button>
                <ion-button 
                  (click)="deleteItem(item)" 
                  fill="clear" 
                  class="action-btn delete-btn">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Cards View -->
    <div class="mobile-cards" *ngIf="paginatedData.length > 0">
      <div *ngFor="let item of paginatedData" class="mobile-card">
        <div class="mobile-card-header">
          <h3 class="mobile-card-title">{{ item['producto'] }}</h3>
        </div>
        
        <div class="mobile-card-body">
          <div class="mobile-field">
            <span class="mobile-field-label">Tipo</span>
            <ion-input 
              *ngIf="editingFieldKey === 'tipo' && editingField === item"
              [(ngModel)]="item['tipo']" 
              (keyup.enter)="finishEditing()" 
              (blur)="finishEditing()"
              class="editable-input">
            </ion-input>
            <span *ngIf="!(editingFieldKey === 'tipo' && editingField === item)" 
                  class="mobile-field-value"
                  (click)="editField(item, 'tipo')">
              {{ item['tipo'] }}
            </span>
          </div>
          
          <div class="mobile-field">
            <span class="mobile-field-label">Mínimo</span>
            <ion-input 
              *ngIf="editingFieldKey === 'min_producto' && editingField === item"
              [(ngModel)]="item['min_producto']" 
              (keyup.enter)="finishEditing()" 
              (blur)="finishEditing()"
              class="editable-input">
            </ion-input>
            <span *ngIf="!(editingFieldKey === 'min_producto' && editingField === item)" 
                  class="mobile-field-value"
                  (click)="editField(item, 'min_producto')">
              {{ item['min_producto'] }} Kg
            </span>
          </div>
          
          <div class="mobile-field">
            <span class="mobile-field-label">Máximo</span>
            <ion-input 
              *ngIf="editingFieldKey === 'max_producto' && editingField === item"
              [(ngModel)]="item['max_producto']" 
              (keyup.enter)="finishEditing()" 
              (blur)="finishEditing()"
              class="editable-input">
            </ion-input>
            <span *ngIf="!(editingFieldKey === 'max_producto' && editingField === item)" 
                  class="mobile-field-value"
                  (click)="editField(item, 'max_producto')">
              {{ item['max_producto'] }} Kg
            </span>
          </div>
        </div>
        
        <div class="mobile-actions">
          <ion-button 
            (click)="editItem(item)" 
            fill="outline" 
            color="warning"
            size="small">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar
          </ion-button>
          <ion-button 
            (click)="deleteItem(item)" 
            fill="outline" 
            color="danger"
            size="small">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Eliminar
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="paginatedData.length === 0" class="empty-state">
      <ion-icon name="document-outline" class="empty-icon"></ion-icon>
      <h3>No hay rangos disponibles</h3>
      <p>Comienza agregando tu primer rango de productos</p>
      <ion-button (click)="openAddRangoModal()" class="empty-action-btn">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Crear Primer Rango
      </ion-button>
    </div>
  </div>

  <!-- Modern Pagination -->
  <div class="modern-pagination" *ngIf="paginatedData.length > 0">
    <div class="pagination-container">
      <ion-button 
        fill="outline" 
        [disabled]="currentPage === 1" 
        (click)="previousPage()" 
        class="pagination-btn">
        <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
      </ion-button>
      
      <div class="pagination-info">
        <span class="current-page">{{ currentPage }}</span>
        <span class="separator">de</span>
        <span class="total-pages">{{ totalPages }}</span>
      </div>
      
      <ion-button 
        fill="outline" 
        [disabled]="currentPage === totalPages" 
        (click)="nextPage()" 
        class="pagination-btn">
        <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
    
    <div class="pagination-details">
      Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} - 
      {{ currentPage * itemsPerPage > (filteredData?.length || 0) ? (filteredData?.length || 0) : currentPage * itemsPerPage }} 
      de {{ filteredData?.length || 0 }} elementos
    </div>
  </div>
</ion-content>
